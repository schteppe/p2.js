<!DOCTYPE html>
<html>
<head>
    <title>p2.js</title>
    <script src="../node_modules/gl-matrix/dist/gl-matrix.js"></script>
    <script src="../build/p2.glmatrix.js"></script>
    <script src="demo.js"></script>
    <script src="three.js"></script>
    <link href="demo.css" rel="stylesheet"/>
</head>
<body>
    <script>

        var V = p2.V;

        var demo = new CanvasDemo();

        demo.createScene(function(world){
            var bodies = [];
            var l = 10, N=20, M=20;
            var timeStep = 1/60,
                k=500,
                d=10,
                l=0.2,
                m=1;
            vec2.set(world.gravity,0,-2);

            // Create bodies
            for(var i=0; i<N; i++){
                bodies.push([]);
                for(var j=0; j<M; j++){
                    var p = new p2.Body({
                        mass: j==M-1 ? 0 : m
                    });
                    vec2.set(p.position,i*l*1.05+1,j*l*1.05+1);
                    bodies[i].push(p);
                    world.addBody(p);
                }
            }

            // Vertical
            for(var i=0; i<N; i++){
                for(var j=0; j<M-1; j++){
                    var a = bodies[i][j];
                    var b = bodies[i][j+1];
                    var spring = new p2.Spring(a,b, {
                        stiffness: k,
                        restLength: l
                    });
                    world.addSpring(spring);
                    demo.addVisual(spring);
                }
            }
            // Horizontal
            for(var i=0; i<N-1; i++){
                for(var j=0; j<M; j++){
                    var a = bodies[i][j];
                    var b = bodies[i+1][j];
                    var spring = new p2.Spring(a,b, {
                        stiffness: k,
                        restLength: l
                    });
                    world.addSpring(spring);
                    demo.addVisual(spring);
                }
            }
            // Diagonal right/down
            for(var i=0; i<N-1; i++){
                for(var j=0; j<M-1; j++){
                    var a = bodies[i][j];
                    var b = bodies[i+1][j+1];
                    var spring = new p2.Spring(a,b, {
                        stiffness: k,
                        restLength: Math.sqrt(l*l + l*l)
                    });
                    world.addSpring(spring);
                }
            }
            // Diagonal left/down
            for(var i=0; i<N-1; i++){
                for(var j=0; j<M-1; j++){
                    var a = bodies[i+1][j];
                    var b = bodies[i][j+1];
                    var spring = new p2.Spring(a,b, {
                        stiffness: k,
                        restLength: Math.sqrt(l*l + l*l)
                    });
                    world.addSpring(spring);
                }
            }
        });
    </script>
</body>
</html>
