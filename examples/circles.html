<!DOCTYPE html>
<html>
<head>
    <title>p2.js</title>
    <script src="../build/p2.js"></script>
    <script src="demo.js"></script>
    <script src="three.js"></script>
    <link href="demo.css" rel="stylesheet"/>
</head>
<body>
    <script>

        var V = p2.V;

        var demo = new WebGLDemo();

        var disturb = true;
        var solverIterations = 6;

        demo.createScene(function(world){
            var l = 20, N=20, M=20;
            var timeStep = 1/60,
                r=0.2;
            V.set(world.gravity,0,-15);
            world.solver.setSpookParams(1e50,6);
            world.solver.iterations = solverIterations;
            world.solver.tolerance = 0.001;

            // Create circle bodies
            var shape = new p2.Circle(r);
            for(var i=0; i<N; i++){
                for(var j=0; j<M; j++){
                    var x = i*r*2.05+10*r+(disturb ? Math.random()*r : 0);
                    var y = j*r*2.1+2;
                    var p = new p2.Body({
                        mass: 1,
                        shape: shape,
                        position: V.create(x, y)
                    });
                    world.addBody(p);
                    demo.addVisual(p);
                }
            }

            var xmin=0, xmax=r*60;
            var ymin=0, ymax=M*r*2.1+2+r;

            // Create ground
            var planeShape = new p2.Plane();
            var plane = new p2.Body({
                shape: planeShape
            });
            world.addBody(plane);

            var planeLeft = new p2.Body({
                shape: planeShape,
                angle: -Math.PI/2
            });
            world.addBody(planeLeft);

            var planeRight = new p2.Body({
                shape: planeShape,
                angle: Math.PI/2,
                position: V.create(xmax, 0)
            });
            world.addBody(planeRight);

            world.broadphase = new p2.GridBroadphase(xmin-2*r,xmax+r*2,ymin-2*r,ymax+2*r);

        });
    </script>
</body>
</html>
