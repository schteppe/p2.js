/**
 * The MIT License (MIT)
 *
 * Copyright (c) 2016 p2.js authors
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&false)define(e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.p2=e()}}(function(){return function e(f,n,o){function d(t,l){if(!n[t]){if(!f[t]){var p="function"==typeof require&&require;if(!l&&p)return p(t,!0);if(i)return i(t,!0);throw new Error("Cannot find module '"+t+"'")}var u=n[t]={exports:{}};f[t][0].call(u.exports,function(e){var n=f[t][1][e];return d(n?n:e)},u,u.exports,e,f,n,o)}return n[t].exports}for(var i="function"==typeof require&&require,t=0;t<o.length;t++)d(o[t]);return d}({1:[function(e,f,n){function o(e,f,n){n=n||0;var o,d,i,t,l,p,u,s=[0,0];return o=e[1][1]-e[0][1],d=e[0][0]-e[1][0],i=o*e[0][0]+d*e[0][1],t=f[1][1]-f[0][1],l=f[0][0]-f[1][0],p=t*f[0][0]+l*f[0][1],u=o*l-t*d,B(u,0,n)||(s[0]=(l*i-d*p)/u,s[1]=(o*p-t*i)/u),s}function d(e,f,n,o){var d=f[0]-e[0],i=f[1]-e[1],t=o[0]-n[0],l=o[1]-n[1];if(t*i-l*d===0)return!1;var p=(d*(n[1]-e[1])+i*(e[0]-n[0]))/(t*i-l*d),u=(t*(e[1]-n[1])+l*(n[0]-e[0]))/(l*d-t*i);return p>=0&&1>=p&&u>=0&&1>=u}function i(e,f,n){return(f[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(f[1]-e[1])}function t(e,f,n){return i(e,f,n)>0}function l(e,f,n){return i(e,f,n)>=0}function p(e,f,n){return i(e,f,n)<0}function u(e,f,n){return i(e,f,n)<=0}function s(e,f,n,o){if(o){var d=C,t=D;d[0]=f[0]-e[0],d[1]=f[1]-e[1],t[0]=n[0]-f[0],t[1]=n[1]-f[1];var l=d[0]*t[0]+d[1]*t[1],p=Math.sqrt(d[0]*d[0]+d[1]*d[1]),u=Math.sqrt(t[0]*t[0]+t[1]*t[1]),s=Math.acos(l/(p*u));return o>s}return 0===i(e,f,n)}function c(e,f){var n=f[0]-e[0],o=f[1]-e[1];return n*n+o*o}function y(e,f){var n=e.length;return e[0>f?f%n+n:f%n]}function a(e){e.length=0}function r(e,f,n,o){for(var d=n;o>d;d++)e.push(f[d])}function w(e){for(var f=0,n=e,o=1;o<e.length;++o)(n[o][1]<n[f][1]||n[o][1]===n[f][1]&&n[o][0]>n[f][0])&&(f=o);t(y(e,f-1),y(e,f),y(e,f+1))||b(e)}function b(e){for(var f=[],n=e.length,o=0;o!==n;o++)f.push(e.pop());for(var o=0;o!==n;o++)e[o]=f[o]}function g(e,f){return p(y(e,f-1),y(e,f),y(e,f+1))}function m(e,f,n){var d,i,t=E,p=F;if(l(y(e,f+1),y(e,f),y(e,n))&&u(y(e,f-1),y(e,f),y(e,n)))return!1;i=c(y(e,f),y(e,n));for(var s=0;s!==e.length;++s)if((s+1)%e.length!==f&&s!==f&&l(y(e,f),y(e,n),y(e,s+1))&&u(y(e,f),y(e,n),y(e,s))&&(t[0]=y(e,f),t[1]=y(e,n),p[0]=y(e,s),p[1]=y(e,s+1),d=o(t,p),c(y(e,f),d)<i))return!1;return!0}function x(e,f,n,o){var d=o||[];if(a(d),n>f)for(var i=f;n>=i;i++)d.push(e[i]);else{for(var i=0;n>=i;i++)d.push(e[i]);for(var i=f;i<e.length;i++)d.push(e[i])}return d}function j(e){for(var f=[],n=[],o=[],d=[],i=Number.MAX_VALUE,t=0;t<e.length;++t)if(g(e,t))for(var l=0;l<e.length;++l)if(m(e,t,l)){n=j(x(e,t,l,d)),o=j(x(e,l,t,d));for(var p=0;p<o.length;p++)n.push(o[p]);n.length<i&&(f=n,i=n.length,f.push([y(e,t),y(e,l)]))}return f}function v(e){var f=j(e);return f.length>0?h(e,f):[e]}function h(e,f){if(0===f.length)return[e];if(f instanceof Array&&f.length&&f[0]instanceof Array&&2===f[0].length&&f[0][0]instanceof Array){for(var n=[e],o=0;o<f.length;o++)for(var d=f[o],i=0;i<n.length;i++){var t=n[i],l=h(t,d);if(l){n.splice(i,1),n.push(l[0],l[1]);break}}return n}var d=f,o=e.indexOf(d[0]),i=e.indexOf(d[1]);return-1!==o&&-1!==i?[x(e,o,i),x(e,i,o)]:!1}function k(e){var f,n=e;for(f=0;f<n.length-1;f++)for(var o=0;f-1>o;o++)if(d(n[f],n[f+1],n[o],n[o+1]))return!1;for(f=1;f<n.length-2;f++)if(d(n[0],n[n.length-1],n[f],n[f+1]))return!1;return!0}function q(e,f,n,o,d){d=d||0;var i=f[1]-e[1],t=e[0]-f[0],l=i*e[0]+t*e[1],p=o[1]-n[1],u=n[0]-o[0],s=p*n[0]+u*n[1],c=i*u-p*t;return B(c,0,d)?[0,0]:[(u*l-t*s)/c,(i*s-p*l)/c]}function z(e,f,n,o,d,i,s){i=i||100,s=s||0,d=d||25,f="undefined"!=typeof f?f:[],n=n||[],o=o||[];var a=[0,0],w=[0,0],b=[0,0],m=0,x=0,j=0,v=0,h=0,k=0,A=0,B=[],C=[],D=e,E=e;if(E.length<3)return f;if(s++,s>i)return console.warn("quickDecomp: max level ("+i+") reached."),f;for(var F=0;F<e.length;++F)if(g(D,F)){n.push(D[F]),m=x=Number.MAX_VALUE;for(var G=0;G<e.length;++G)t(y(D,F-1),y(D,F),y(D,G))&&u(y(D,F-1),y(D,F),y(D,G-1))&&(b=q(y(D,F-1),y(D,F),y(D,G),y(D,G-1)),p(y(D,F+1),y(D,F),b)&&(j=c(D[F],b),x>j&&(x=j,w=b,k=G))),t(y(D,F+1),y(D,F),y(D,G+1))&&u(y(D,F+1),y(D,F),y(D,G))&&(b=q(y(D,F+1),y(D,F),y(D,G),y(D,G+1)),t(y(D,F-1),y(D,F),b)&&(j=c(D[F],b),m>j&&(m=j,a=b,h=G)));if(k===(h+1)%e.length)b[0]=(w[0]+a[0])/2,b[1]=(w[1]+a[1])/2,o.push(b),h>F?(r(B,D,F,h+1),B.push(b),C.push(b),0!==k&&r(C,D,k,D.length),r(C,D,0,F+1)):(0!==F&&r(B,D,F,D.length),r(B,D,0,h+1),B.push(b),C.push(b),r(C,D,k,F+1));else{if(k>h&&(h+=e.length),v=Number.MAX_VALUE,k>h)return f;for(var G=k;h>=G;++G)l(y(D,F-1),y(D,F),y(D,G))&&u(y(D,F+1),y(D,F),y(D,G))&&(j=c(y(D,F),y(D,G)),v>j&&(v=j,A=G%e.length));A>F?(r(B,D,F,A+1),0!==A&&r(C,D,A,E.length),r(C,D,0,F+1)):(0!==F&&r(B,D,F,E.length),r(B,D,0,A+1),r(C,D,A,F+1))}return B.length<C.length?(z(B,f,n,o,d,i,s),z(C,f,n,o,d,i,s)):(z(C,f,n,o,d,i,s),z(B,f,n,o,d,i,s)),f}return f.push(e),f}function A(e,f){for(var n=0,o=e.length-1;e.length>3&&o>=0;--o)s(y(e,o-1),y(e,o),y(e,o+1),f)&&(e.splice(o%e.length,1),n++);return n}function B(e,f,n){return n=n||0,Math.abs(e-f)<n}f.exports={decomp:v,quickDecomp:z,isSimple:k,removeCollinearPoints:A,makeCCW:w};var C=[],D=[],E=[],F=[]},{}],2:[function(e,f,n){function o(e){e=e||{},this.lowerBound=e.lowerBound?d.clone(e.lowerBound):d.create(),this.upperBound=e.upperBound?d.clone(e.upperBound):d.create()}var d=e("../math/vec2");f.exports=o;var i=d.create();o.prototype.setFromPoints=function(e,f,n,o){var t=this.lowerBound,l=this.upperBound;n=n||0,0!==n?d.rotate(t,e[0],n):d.copy(t,e[0]),d.copy(l,t);for(var p=Math.cos(n),u=Math.sin(n),s=1;s<e.length;s++){var c=e[s];if(0!==n){var y=c[0],a=c[1];i[0]=p*y-u*a,i[1]=u*y+p*a,c=i}for(var r=0;2>r;r++)c[r]>l[r]&&(l[r]=c[r]),c[r]<t[r]&&(t[r]=c[r])}f&&(d.add(t,t,f),d.add(l,l,f)),o&&(t[0]-=o,t[1]-=o,l[0]+=o,l[1]+=o)},o.prototype.copy=function(e){d.copy(this.lowerBound,e.lowerBound),d.copy(this.upperBound,e.upperBound)},o.prototype.extend=function(e){for(var f=this.lowerBound,n=this.upperBound,o=2;o--;){var d=e.lowerBound[o];f[o]>d&&(f[o]=d);var i=e.upperBound[o];n[o]<i&&(n[o]=i)}},o.prototype.overlaps=function(e){var f=this.lowerBound,n=this.upperBound,o=e.lowerBound,d=e.upperBound;return(o[0]<=n[0]&&n[0]<=d[0]||f[0]<=d[0]&&d[0]<=n[0])&&(o[1]<=n[1]&&n[1]<=d[1]||f[1]<=d[1]&&d[1]<=n[1])},o.prototype.containsPoint=function(e){var f=this.lowerBound,n=this.upperBound;return f[0]<=e[0]&&e[0]<=n[0]&&f[1]<=e[1]&&e[1]<=n[1]},o.prototype.overlapsRay=function(e){var f=1/e.direction[0],n=1/e.direction[1],o=e.from,d=this.lowerBound,i=this.upperBound,t=(d[0]-o[0])*f,l=(i[0]-o[0])*f,p=(d[1]-o[1])*n,u=(i[1]-o[1])*n,s=Math.max(Math.max(Math.min(t,l),Math.min(p,u))),c=Math.min(Math.min(Math.max(t,l),Math.max(p,u)));return 0>c?-1:s>c?-1:s/e.length}},{"../math/vec2":25}],3:[function(e,f,n){function o(e){this.type=e,this.result=[],this.world=null,this.boundingVolumeType=o.AABB}var d=e("../math/vec2"),i=e("../objects/Body");f.exports=o,o.AABB=1,o.BOUNDING_CIRCLE=2,o.prototype.setWorld=function(e){this.world=e},o.prototype.getCollisionPairs=function(){},o.boundingRadiusCheck=function(e,f){var n=d.squaredDistance(e.position,f.position),o=e.boundingRadius+f.boundingRadius;return o*o>=n},o.aabbCheck=function(e,f){return e.getAABB().overlaps(f.getAABB())},o.prototype.boundingVolumeCheck=function(e,f){var n;switch(this.boundingVolumeType){case o.BOUNDING_CIRCLE:n=o.boundingRadiusCheck(e,f);break;case o.AABB:n=o.aabbCheck(e,f);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return n},o.canCollide=function(e,f){var n=i.KINEMATIC,o=i.STATIC,d=e.type,t=f.type;return d===o&&t===o?!1:d===n&&t===o||d===o&&t===n?!1:d===n&&t===n?!1:e.sleepState===i.SLEEPING&&f.sleepState===i.SLEEPING?!1:e.sleepState===i.SLEEPING&&t===o||f.sleepState===i.SLEEPING&&d===o?!1:!0},o.NAIVE=1,o.SAP=2,o.prototype.aabbQuery=function(){}},{"../math/vec2":25,"../objects/Body":26}],4:[function(e,f,n){function o(){d.call(this,d.NAIVE)}var d=e("../collision/Broadphase");f.exports=o,o.prototype=new d,o.prototype.constructor=o,o.prototype.getCollisionPairs=function(e){var f=e.bodies,n=this.result;n.length=0;for(var o=0,i=f.length;o!==i;o++)for(var t=f[o],l=0;o>l;l++){var p=f[l];d.canCollide(t,p)&&this.boundingVolumeCheck(t,p)&&n.push(t,p)}return n},o.prototype.aabbQuery=function(e,f,n){n=n||[];for(var o=e.bodies,d=0;d<o.length;d++){var i=o[d];i.aabbNeedsUpdate&&i.updateAABB(),i.aabb.overlaps(f)&&n.push(i)}return n}},{"../collision/Broadphase":3}],5:[function(e,f,n){function o(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.contactEquationPool=new v({size:32}),this.frictionEquationPool=new h({size:64}),this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new k,this.currentContactMaterial=null}function d(e,f){var n=f.radius,o=.5*f.length,d=e.vertices;c.set(d[0],-o,-n),c.set(d[1],o,-n),c.set(d[2],o,n),c.set(d[3],-o,n)}function i(e,f,n,o){var d=$,i=_,t=ee,l=f.vertices,p=null;c.toLocalFrame(d,e,n,o);for(var u=0,s=l.length;u!==s+1;u++){var a=l[u%s],r=l[(u+1)%s];y(i,a,d),y(t,r,d);var w=c.crossLength(i,t);if(null===p&&(p=w),0>w*p)return!1;p=w}return!0}function t(e,f){for(var n=_,o=ee,d=f.vertices,i=null,t=d.length,l=0;t+1>l;l++){var p=d[l%t],u=d[(l+1)%t];y(n,p,e),y(o,u,e);var s=c.crossLength(n,o);if(null===i&&(i=s),0>s*i)return!1;i=s}return!0}function l(e,f,n,o){e[0]=f[0]+n[0]-o[0],e[1]=f[1]+n[1]-o[1]}function p(e,f,n,o,d,i,t){for(var l=f.vertices.length,p=d.vertices.length,u=f.normals,s=f.vertices,y=d.vertices,a=de,r=ie,w=te,b=le,g=o-t,m=0,x=-Number.MAX_VALUE,j=0;l>j;++j){c.rotate(a,u[j],g),c.toGlobalFrame(b,s[j],n,o),c.toLocalFrame(r,b,i,t);for(var v=Number.MAX_VALUE,h=0;p>h;++h){c.subtract(w,y[h],r);var k=c.dot(a,w);v>k&&(v=k)}v>x&&(x=v,m=j)}return e[0]=x,m}function u(e,f,n,o,d,i,t,l){var p=f.normals,u=i.vertices.length,s=i.vertices,y=i.normals,a=pe;c.rotate(a,p[d],o-l);for(var r=0,w=Number.MAX_VALUE,b=0;u>b;++b){var g=c.dot(a,y[b]);w>g&&(w=g,r=b)}var m=r,x=u>m+1?m+1:0;c.toGlobalFrame(e[0],s[m],t,l),c.toGlobalFrame(e[1],s[x],t,l)}function s(e,f,n,o){var d=0,i=c.dot(n,f[0])-o,t=c.dot(n,f[1])-o;if(0>=i&&c.copy(e[d++],f[0]),0>=t&&c.copy(e[d++],f[1]),0>i*t){var l=i/(i-t),p=e[d];c.subtract(p,f[1],f[0]),c.scale(p,p,l),c.add(p,p,f[0]),++d}return d}var c=e("../math/vec2"),y=c.subtract,a=c.add,r=c.dot,w=c.rotate,b=c.normalize,g=c.copy,m=c.scale,x=c.squaredLength,j=c.create,v=e("../utils/ContactEquationPool"),h=e("../utils/FrictionEquationPool"),k=e("../utils/TupleDictionary"),q=e("../shapes/Circle"),z=e("../shapes/Convex"),A=e("../shapes/Shape"),B=e("../shapes/Box");f.exports=o;var C=c.fromValues(0,1),D=j(),E=j(),F=j(),G=j(),H=j(),I=j(),J=j(),K=j(),L=j(),M=j(),N=j(),O=j(),P=j(),Q=j(),R=j(),S=[],T=j(),U=j();o.prototype.bodiesOverlap=function(e,f,n){for(var o=T,d=U,i=0,t=e.shapes.length;i!==t;i++)for(var l=e.shapes[i],p=0,u=f.shapes.length;p!==u;p++){var s=f.shapes[p];if(n&&(0===(l.collisionGroup&s.collisionMask)||0===(s.collisionGroup&l.collisionMask)))return;if(e.toWorldFrame(o,l.position),f.toWorldFrame(d,s.position),l.type<=s.type){if(this[l.type|s.type](e,l,o,l.angle+e.angle,f,s,d,s.angle+f.angle,!0))return!0}else if(this[l.type|s.type](f,s,d,s.angle+f.angle,e,l,o,l.angle+e.angle,!0))return!0}return!1},o.prototype.collidedLastStep=function(e,f){var n=0|e.id,o=0|f.id;return!!this.collidingBodiesLastStep.get(n,o)},o.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var e=this.contactEquations,f=e.length;f--;){var n=e[f],o=n.bodyA.id,d=n.bodyB.id;this.collidingBodiesLastStep.set(o,d,!0)}for(var i=this.contactEquations,t=this.frictionEquations,l=0;l<i.length;l++)this.contactEquationPool.release(i[l]);for(var l=0;l<t.length;l++)this.frictionEquationPool.release(t[l]);this.contactEquations.length=this.frictionEquations.length=0},o.prototype.createContactEquation=function(e,f,n,o){var d=this.contactEquationPool.get(),i=this.currentContactMaterial;return d.bodyA=e,d.bodyB=f,d.shapeA=n,d.shapeB=o,d.enabled=this.enabledEquations,d.firstImpact=!this.collidedLastStep(e,f),d.restitution=i.restitution,d.stiffness=i.stiffness,d.relaxation=i.relaxation,d.offset=i.contactSkinSize,d.needsUpdate=!0,d},o.prototype.createFrictionEquation=function(e,f,n,o){var d=this.frictionEquationPool.get(),i=this.currentContactMaterial;return d.bodyA=e,d.bodyB=f,d.shapeA=n,d.shapeB=o,d.setSlipForce(this.slipForce),d.enabled=this.enabledEquations,d.frictionCoefficient=i.friction,d.relativeVelocity=i.surfaceVelocity,d.stiffness=i.frictionStiffness,d.relaxation=i.frictionRelaxation,d.needsUpdate=!0,d.contactEquations.length=0,d},o.prototype.createFrictionFromContact=function(e){var f=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB);return g(f.contactPointA,e.contactPointA),g(f.contactPointB,e.contactPointB),c.rotate90cw(f.t,e.normalA),f.contactEquations.push(e),f},o.prototype.createFrictionFromAverage=function(e){var f=this.contactEquations[this.contactEquations.length-1],n=this.createFrictionEquation(f.bodyA,f.bodyB,f.shapeA,f.shapeB),o=f.bodyA;c.set(n.contactPointA,0,0),c.set(n.contactPointB,0,0),c.set(n.t,0,0);for(var d=0;d!==e;d++)f=this.contactEquations[this.contactEquations.length-1-d],f.bodyA===o?(a(n.t,n.t,f.normalA),a(n.contactPointA,n.contactPointA,f.contactPointA),a(n.contactPointB,n.contactPointB,f.contactPointB)):(y(n.t,n.t,f.normalA),a(n.contactPointA,n.contactPointA,f.contactPointB),a(n.contactPointB,n.contactPointB,f.contactPointA)),n.contactEquations.push(f);var i=1/e;return m(n.contactPointA,n.contactPointA,i),m(n.contactPointB,n.contactPointB,i),b(n.t,n.t),c.rotate90cw(n.t,n.t),n},o.prototype[A.CONVEX|A.LINE]=o.prototype.convexLine=function(){return 0},o.prototype[A.LINE|A.BOX]=o.prototype.lineBox=function(){return 0};var V=new B({width:1,height:1}),W=j();o.prototype[A.CONVEX|A.CAPSULE]=o.prototype[A.BOX|A.CAPSULE]=o.prototype.convexCapsule=function(e,f,n,o,i,t,l,p,u){var s=W,y=t.length/2;c.set(s,y,0),c.toGlobalFrame(s,s,l,p);var a=this.circleConvex(i,t,s,p,e,f,n,o,u,t.radius);c.set(s,-y,0),c.toGlobalFrame(s,s,l,p);var r=this.circleConvex(i,t,s,p,e,f,n,o,u,t.radius);if(u&&a+r!==0)return 1;var w=V;d(w,t);var b=this.convexConvex(e,f,n,o,i,w,l,p,u);return b+a+r},o.prototype[A.LINE|A.CAPSULE]=o.prototype.lineCapsule=function(){return 0};var X=j(),Y=j(),Z=new B({width:1,height:1});o.prototype[A.CAPSULE]=o.prototype.capsuleCapsule=function(e,f,n,o,i,t,l,p,u){for(var s,y=X,a=Y,r=0,w=0;2>w;w++){c.set(y,(0===w?-1:1)*f.length/2,0),c.toGlobalFrame(y,y,n,o);for(var b=0;2>b;b++){c.set(a,(0===b?-1:1)*t.length/2,0),c.toGlobalFrame(a,a,l,p),this.enableFrictionReduction&&(s=this.enableFriction,this.enableFriction=!1);var g=this.circleCircle(e,f,y,o,i,t,a,p,u,f.radius,t.radius);if(this.enableFrictionReduction&&(this.enableFriction=s),u&&0!==g)return 1;r+=g}}this.enableFrictionReduction&&(s=this.enableFriction,this.enableFriction=!1);var m=Z;d(m,f);var x=this.convexCapsule(e,m,n,o,i,t,l,p,u);if(this.enableFrictionReduction&&(this.enableFriction=s),u&&0!==x)return 1;if(r+=x,this.enableFrictionReduction){var s=this.enableFriction;this.enableFriction=!1}d(m,t);var j=this.convexCapsule(i,m,l,p,e,f,n,o,u);return this.enableFrictionReduction&&(this.enableFriction=s),u&&0!==j?1:(r+=j,this.enableFrictionReduction&&r&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(r)),r)},o.prototype[A.LINE]=o.prototype.lineLine=function(){return 0},o.prototype[A.PLANE|A.LINE]=o.prototype.planeLine=function(e,f,n,o,d,i,t,l,p){var u=D,s=E,x=F,j=G,v=H,h=I,k=J,q=K,z=L,A=S,B=0;c.set(u,-i.length/2,0),c.set(s,i.length/2,0),c.toGlobalFrame(x,u,t,l),c.toGlobalFrame(j,s,t,l),g(u,x),g(s,j),y(v,s,u),b(h,v),c.rotate90cw(z,h),w(q,C,o),A[0]=u,A[1]=s;for(var M=0;M<A.length;M++){var N=A[M];y(k,N,n);var O=r(k,q);if(0>O){if(p)return 1;var P=this.createContactEquation(e,d,f,i);B++,g(P.normalA,q),b(P.normalA,P.normalA),m(k,q,O),y(P.contactPointA,N,k),y(P.contactPointA,P.contactPointA,e.position),y(P.contactPointB,N,t),a(P.contactPointB,P.contactPointB,t),y(P.contactPointB,P.contactPointB,d.position),this.contactEquations.push(P),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(P))}}return p?0:(this.enableFrictionReduction||B&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(B)),B)},o.prototype[A.PARTICLE|A.CAPSULE]=o.prototype.particleCapsule=function(e,f,n,o,d,i,t,l,p){return this.circleLine(e,f,n,o,d,i,t,l,p,i.radius,0)},o.prototype[A.CIRCLE|A.LINE]=o.prototype.circleLine=function(e,f,n,o,d,i,t,l,p,u,s){var u=u||0,s=void 0!==s?s:f.radius,w=D,j=E,v=F,h=G,k=H,q=I,z=J,A=K,B=L,C=M,R=N,T=O,U=P,V=Q,W=S,X=i.length/2;c.set(A,-X,0),c.set(B,X,0),c.toGlobalFrame(C,A,t,l),c.toGlobalFrame(R,B,t,l),g(A,C),g(B,R),y(q,B,A),b(z,q),c.rotate90cw(k,z),y(T,n,A);var Y=r(T,k);y(h,A,t),y(U,n,t);var Z=s+u;if(Math.abs(Y)<Z){m(w,k,Y),y(v,n,w),m(j,k,r(k,U)),b(j,j),m(j,j,u),a(v,v,j);var $=r(z,v),_=r(z,A),ee=r(z,B);if($>_&&ee>$){if(p)return 1;var fe=this.createContactEquation(e,d,f,i);return m(fe.normalA,w,-1),b(fe.normalA,fe.normalA),m(fe.contactPointA,fe.normalA,s),a(fe.contactPointA,fe.contactPointA,n),y(fe.contactPointA,fe.contactPointA,e.position),y(fe.contactPointB,v,t),a(fe.contactPointB,fe.contactPointB,t),y(fe.contactPointB,fe.contactPointB,d.position),this.contactEquations.push(fe),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(fe)),1}}W[0]=A,W[1]=B;for(var ne=0;ne<W.length;ne++){var oe=W[ne];if(y(T,oe,n),x(T)<Math.pow(Z,2)){if(p)return 1;var fe=this.createContactEquation(e,d,f,i);return g(fe.normalA,T),b(fe.normalA,fe.normalA),m(fe.contactPointA,fe.normalA,s),a(fe.contactPointA,fe.contactPointA,n),y(fe.contactPointA,fe.contactPointA,e.position),y(fe.contactPointB,oe,t),m(V,fe.normalA,-u),a(fe.contactPointB,fe.contactPointB,V),a(fe.contactPointB,fe.contactPointB,t),y(fe.contactPointB,fe.contactPointB,d.position),this.contactEquations.push(fe),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(fe)),1}}return 0},o.prototype[A.CIRCLE|A.CAPSULE]=o.prototype.circleCapsule=function(e,f,n,o,d,i,t,l,p){return this.circleLine(e,f,n,o,d,i,t,l,p,i.radius)},o.prototype[A.CIRCLE|A.CONVEX]=o.prototype[A.CIRCLE|A.BOX]=o.prototype.circleConvex=function(e,f,n,o,d,i,l,p,u,s){var s=void 0!==s?s:f.radius,w=D,j=E,v=F,h=G,k=H,q=I,z=J,A=K,B=M,C=N,L=P,O=Q,S=R,T=-1,U=Number.MAX_VALUE;c.set(q,0,0),c.toLocalFrame(z,n,l,p);for(var V=i.vertices,W=i.normals,X=V.length,Y=-1,Z=-Number.MAX_VALUE,$=i.boundingRadius+s,_=0;X>_;_++){y(A,z,V[_]);var ee=r(W[_],A);if(ee>$)return 0;ee>Z&&(Z=ee,Y=_)}for(var _=Y+X-1;Y+X+2>_;_++){var fe=V[_%X],ne=W[_%X];if(m(O,ne,-s),a(O,O,z),t(O,i)){y(S,fe,O);var oe=Math.abs(r(S,ne));U>oe&&(U=oe,T=_)}}if(-1!==T){if(u)return 1;var fe=V[T%X],de=V[(T+1)%X];c.toGlobalFrame(w,fe,l,p),c.toGlobalFrame(j,de,l,p),y(v,j,w),b(h,v),c.rotate90cw(k,h),m(O,k,-s),a(O,O,n),m(L,k,U),a(L,L,O);var ie=this.createContactEquation(e,d,f,i);return y(ie.normalA,O,n),b(ie.normalA,ie.normalA),m(ie.contactPointA,ie.normalA,s),a(ie.contactPointA,ie.contactPointA,n),y(ie.contactPointA,ie.contactPointA,e.position),y(ie.contactPointB,L,l),a(ie.contactPointB,ie.contactPointB,l),y(ie.contactPointB,ie.contactPointB,d.position),this.contactEquations.push(ie),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(ie)),1}if(s>0&&-1!==Y)for(var _=Y+X;Y+X+2>_;_++){var te=V[_%X];if(y(B,te,z),x(B)<s*s){if(u)return 1;c.toGlobalFrame(C,te,l,p),y(B,C,n);var ie=this.createContactEquation(e,d,f,i);return g(ie.normalA,B),b(ie.normalA,ie.normalA),m(ie.contactPointA,ie.normalA,s),a(ie.contactPointA,ie.contactPointA,n),y(ie.contactPointA,ie.contactPointA,e.position),y(ie.contactPointB,C,l),a(ie.contactPointB,ie.contactPointB,l),y(ie.contactPointB,ie.contactPointB,d.position),this.contactEquations.push(ie),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(ie)),1}}return 0};var $=j(),_=j(),ee=j();o.prototype[A.PARTICLE|A.CONVEX]=o.prototype[A.PARTICLE|A.BOX]=o.prototype.particleConvex=function(e,f,n,o,d,t,l,p,u){var s=D,x=E,j=F,v=G,h=H,k=I,q=J,z=P,A=Q,B=R,C=Number.MAX_VALUE,K=!1,L=t.vertices;if(!i(n,t,l,p))return 0;if(u)return 1;for(var M=0,N=L.length;M!==N+1;M++){var O=L[M%N],S=L[(M+1)%N];w(s,O,p),w(x,S,p),a(s,s,l),a(x,x,l),y(j,x,s),b(v,j),c.rotate90cw(h,v),y(k,s,l),y(q,n,l),y(A,s,n);var T=Math.abs(r(A,h));C>T&&(C=T,m(z,h,T),a(z,z,n),g(B,h),K=!0)}if(K){var U=this.createContactEquation(e,d,f,t);return m(U.normalA,B,-1),b(U.normalA,U.normalA),c.set(U.contactPointA,0,0),a(U.contactPointA,U.contactPointA,n),y(U.contactPointA,U.contactPointA,e.position),y(U.contactPointB,z,l),a(U.contactPointB,U.contactPointB,l),y(U.contactPointB,U.contactPointB,d.position),this.contactEquations.push(U),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(U)),1}return 0},o.prototype[A.CIRCLE]=o.prototype.circleCircle=function(e,f,n,o,d,i,t,p,u,s,c){var a=D,s=s||f.radius,c=c||i.radius;y(a,n,t);var r=s+c;if(x(a)>r*r)return 0;if(u)return 1;var w=this.createContactEquation(e,d,f,i),g=w.contactPointA,j=w.contactPointB,v=w.normalA;return y(v,t,n),b(v,v),m(g,v,s),m(j,v,-c),l(g,g,n,e.position),l(j,j,t,d.position),this.contactEquations.push(w),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(w)),1},o.prototype[A.PLANE|A.CONVEX]=o.prototype[A.PLANE|A.BOX]=o.prototype.planeConvex=function(e,f,n,o,d,i,t,l,p){var u=D,s=E,a=F,b=G,x=H,j=I,v=0;w(s,C,o),c.vectorToLocalFrame(x,s,l),c.toLocalFrame(b,n,t,l);for(var h=i.vertices,k=0,q=h.length;k!==q;k++){var z=h[k];if(y(j,z,b),r(j,x)<=0){if(p)return 1;c.toGlobalFrame(u,z,t,l),y(a,u,n),v++;var A=this.createContactEquation(e,d,f,i);y(a,u,n),g(A.normalA,s);var B=r(a,A.normalA);m(a,A.normalA,B),y(A.contactPointB,u,d.position),y(A.contactPointA,u,a),y(A.contactPointA,A.contactPointA,e.position),this.contactEquations.push(A),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(A))}}return this.enableFrictionReduction&&this.enableFriction&&v&&this.frictionEquations.push(this.createFrictionFromAverage(v)),v},o.prototype[A.PARTICLE|A.PLANE]=o.prototype.particlePlane=function(e,f,n,o,d,i,t,l,p){var u=D,s=E;l=l||0,y(u,n,t),w(s,C,l);var c=r(u,s);if(c>0)return 0;if(p)return 1;var a=this.createContactEquation(d,e,i,f);return g(a.normalA,s),m(u,a.normalA,c),y(a.contactPointA,n,u),y(a.contactPointA,a.contactPointA,d.position),y(a.contactPointB,n,e.position),this.contactEquations.push(a),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(a)),1},o.prototype[A.CIRCLE|A.PARTICLE]=o.prototype.circleParticle=function(e,f,n,o,d,i,t,l,p){var u=D,s=f.radius;if(y(u,t,n),x(u)>s*s)return 0;if(p)return 1;var c=this.createContactEquation(e,d,f,i),r=c.normalA,w=c.contactPointA,j=c.contactPointB;return g(r,u),b(r,r),m(w,r,s),a(w,w,n),y(w,w,e.position),y(j,t,d.position),this.contactEquations.push(c),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(c)),1};var fe=new q({radius:1}),ne=j(),oe=j();o.prototype[A.PLANE|A.CAPSULE]=o.prototype.planeCapsule=function(e,f,n,o,d,i,t,l,p){var u=ne,s=oe,y=fe,a=i.length/2;c.set(u,-a,0),c.set(s,a,0),c.toGlobalFrame(u,u,t,l),c.toGlobalFrame(s,s,t,l),y.radius=i.radius;var r;this.enableFrictionReduction&&(r=this.enableFriction,this.enableFriction=!1);var w=this.circlePlane(d,y,u,0,e,f,n,o,p),b=this.circlePlane(d,y,s,0,e,f,n,o,p);if(this.enableFrictionReduction&&(this.enableFriction=r),p)return w+b;var g=w+b;return this.enableFrictionReduction&&g&&this.frictionEquations.push(this.createFrictionFromAverage(g)),g},o.prototype[A.CIRCLE|A.PLANE]=o.prototype.circlePlane=function(e,f,n,o,d,i,t,l,p){var u=f.radius,s=D,c=E,b=F;y(s,n,t),w(c,C,l);var x=r(c,s);if(x>u)return 0;if(p)return 1;var j=this.createContactEquation(d,e,i,f);g(j.normalA,c);var v=j.contactPointB;m(v,j.normalA,-u),a(v,v,n),y(v,v,e.position);var h=j.contactPointA;return m(b,j.normalA,x),y(h,s,b),a(h,h,t),y(h,h,d.position),this.contactEquations.push(j),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(j)),1};var de=c.create(),ie=c.create(),te=c.create(),le=c.create(),pe=c.create(),ue=c.create(),se=c.create(),ce=c.create(),ye=c.create(),ae=c.create(),re=c.create(),we=c.create(),be=c.create(),ge=c.create(),me=c.create(),xe=c.create(),je=[c.create(),c.create()],ve=[c.create(),c.create()],he=[c.create(),c.create()],ke=2;o.prototype[A.CONVEX]=o.prototype[A.CONVEX|A.BOX]=o.prototype[A.BOX]=o.prototype.convexConvex=function(e,f,n,o,d,i,t,l,a){var r=0,w=xe,b=ue,g=se,m=p(b,f,n,o,i,t,l),x=b[0];if(x>r)return 0;var j=p(g,i,t,l,f,n,o),v=g[0];if(v>r)return 0;var h,k,q,z,A,B,C,D,E,F;v>x?(h=i,k=f,C=d,D=e,q=t,A=l,z=n,B=o,E=j,F=1):(h=f,k=i,C=e,D=d,q=n,A=o,z=t,B=l,E=m,F=0);var G=he;u(G,h,q,A,E,k,z,B);var H=h.vertices.length,I=h.vertices,J=E,K=H>E+1?E+1:0,L=ge,M=me;c.copy(L,I[J]),c.copy(M,I[K]);var N=ce;c.subtract(N,M,L),c.normalize(N,N);var O=ye;c.crossVZ(O,N,1);var P=ae;c.add(P,L,M),c.scale(P,P,.5);var Q=re;c.rotate(Q,N,A);var R=we;c.crossVZ(R,Q,1),c.toGlobalFrame(L,L,q,A),c.toGlobalFrame(M,M,q,A);var S=c.dot(R,L),T=-c.dot(Q,L)+r,U=c.dot(Q,M)+r,V=je,W=ve,X=0,Y=be;if(c.scale(Y,Q,-1),X=s(V,G,Y,T,J),2>X)return 0;if(X=s(W,V,Q,U,K),2>X)return 0;for(var Z=0,$=0;ke>$;++$){var _=c.dot(R,W[$])-S;if(r>=_){if(a)return 1;++Z;var ee=this.createContactEquation(C,D,h,k);c.copy(ee.normalA,R),c.copy(ee.contactPointB,W[$]),y(ee.contactPointB,ee.contactPointB,D.position),c.scale(w,R,-_),c.add(ee.contactPointA,W[$],w),y(ee.contactPointA,ee.contactPointA,C.position),this.contactEquations.push(ee),this.enableFriction&&!this.enableFrictionReduction&&this.frictionEquations.push(this.createFrictionFromContact(ee))}}return Z&&this.enableFrictionReduction&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(Z)),Z};var qe=j(),ze=j(),Ae=j(),Be=j(),Ce=j(),De=j(),Ee=j();o.prototype[A.CIRCLE|A.HEIGHTFIELD]=o.prototype.circleHeightfield=function(e,f,n,o,d,i,t,l,p,u){var s=i.heights,u=u||f.radius,j=i.elementWidth,v=ze,h=qe,k=Ce,q=Ee,z=De,A=Ae,B=Be,C=Math.floor((n[0]-u-t[0])/j),D=Math.ceil((n[0]+u-t[0])/j);0>C&&(C=0),D>=s.length&&(D=s.length-1);for(var E=s[C],F=s[D],G=C;D>G;G++)s[G]<F&&(F=s[G]),s[G]>E&&(E=s[G]);if(n[1]-u>E)return 0;for(var H=!1,G=C;D>G;G++){c.set(A,G*j,s[G]),c.set(B,(G+1)*j,s[G+1]),a(A,A,t),a(B,B,t),y(z,B,A),w(z,z,Math.PI/2),b(z,z),m(h,z,-u),a(h,h,n),y(v,h,A);var I=r(v,z);if(h[0]>=A[0]&&h[0]<B[0]&&0>=I){if(p)return 1;H=!0,m(v,z,-I),a(k,h,v),g(q,z);var J=this.createContactEquation(d,e,i,f);g(J.normalA,q),m(J.contactPointB,J.normalA,-u),a(J.contactPointB,J.contactPointB,n),y(J.contactPointB,J.contactPointB,e.position),g(J.contactPointA,k),y(J.contactPointA,J.contactPointA,d.position),this.contactEquations.push(J),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(J))}}if(H=!1,u>0)for(var G=C;D>=G;G++)if(c.set(A,G*j,s[G]),a(A,A,t),y(v,n,A),x(v)<Math.pow(u,2)){if(p)return 1;H=!0;var J=this.createContactEquation(d,e,i,f);g(J.normalA,v),b(J.normalA,J.normalA),m(J.contactPointB,J.normalA,-u),a(J.contactPointB,J.contactPointB,n),y(J.contactPointB,J.contactPointB,e.position),y(J.contactPointA,A,t),a(J.contactPointA,J.contactPointA,t),y(J.contactPointA,J.contactPointA,d.position),this.contactEquations.push(J),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(J))}return H?1:0};var Fe=j(),Ge=j(),He=j(),Ie=new z({vertices:[j(),j(),j(),j()]});o.prototype[A.BOX|A.HEIGHTFIELD]=o.prototype[A.CONVEX|A.HEIGHTFIELD]=o.prototype.convexHeightfield=function(e,f,n,o,d,i,t,l,p){var u=i.heights,s=i.elementWidth,r=Fe,w=Ge,b=He,m=Ie,x=Math.floor((e.aabb.lowerBound[0]-t[0])/s),j=Math.ceil((e.aabb.upperBound[0]-t[0])/s);0>x&&(x=0),j>=u.length&&(j=u.length-1);for(var v=u[x],h=u[j],k=x;j>k;k++)u[k]<h&&(h=u[k]),u[k]>v&&(v=u[k]);if(e.aabb.lowerBound[1]>v)return 0;for(var q=0,k=x;j>k;k++){c.set(r,k*s,u[k]),c.set(w,(k+1)*s,u[k+1]),a(r,r,t),a(w,w,t);var z=100;c.set(b,.5*(w[0]+r[0]),.5*(w[1]+r[1]-z)),y(m.vertices[0],w,b),y(m.vertices[1],r,b),g(m.vertices[2],m.vertices[1]),g(m.vertices[3],m.vertices[0]),m.vertices[2][1]-=z,m.vertices[3][1]-=z,m.updateNormals(),q+=this.convexConvex(e,f,n,o,d,m,b,0,p)}return q}},{"../math/vec2":25,"../shapes/Box":32,"../shapes/Circle":34,"../shapes/Convex":35,"../shapes/Shape":40,"../utils/ContactEquationPool":43,"../utils/FrictionEquationPool":44,"../utils/TupleDictionary":49}],6:[function(e,f,n){function o(e){e=e||{},this.from=e.from?i.clone(e.from):i.create(),this.to=e.to?i.clone(e.to):i.create(),this.checkCollisionResponse=void 0!==e.checkCollisionResponse?e.checkCollisionResponse:!0,this.skipBackfaces=!!e.skipBackfaces,this.collisionMask=void 0!==e.collisionMask?e.collisionMask:-1,this.collisionGroup=void 0!==e.collisionGroup?e.collisionGroup:-1,this.mode=void 0!==e.mode?e.mode:o.ANY,this.callback=e.callback||function(){},this.direction=i.create(),this.length=1,this.update()}function d(e,f,n){i.subtract(l,n,e);var o=i.dot(l,f);return i.scale(p,f,o),i.add(p,p,e),i.squaredDistance(n,p)}f.exports=o;var i=e("../math/vec2");o.prototype.constructor=o,o.CLOSEST=1,o.ANY=2,o.ALL=4,o.prototype.update=function(){var e=this.direction;i.subtract(e,this.to,this.from),this.length=i.length(e),i.normalize(e,e)},o.prototype.intersectBodies=function(e,f){for(var n=0,o=f.length;!e.shouldStop(this)&&o>n;n++){var d=f[n],i=d.getAABB();(i.overlapsRay(this)>=0||i.containsPoint(this.from))&&this.intersectBody(e,d)}};var t=i.create();o.prototype.intersectBody=function(e,f){var n=this.checkCollisionResponse;if(!n||f.collisionResponse)for(var o=t,d=0,l=f.shapes.length;l>d;d++){var p=f.shapes[d];if((!n||p.collisionResponse)&&0!==(this.collisionGroup&p.collisionMask)&&0!==(p.collisionGroup&this.collisionMask)){i.rotate(o,p.position,f.angle),i.add(o,o,f.position);var u=p.angle+f.angle;if(this.intersectShape(e,p,u,o,f),e.shouldStop(this))break}}},o.prototype.intersectShape=function(e,f,n,o,i){var t=this.from,l=d(t,this.direction,o);l>f.boundingRadius*f.boundingRadius||(this._currentBody=i,this._currentShape=f,f.raycast(e,this,o,n),this._currentBody=this._currentShape=null)},o.prototype.getAABB=function(e){var f=this.to,n=this.from;i.set(e.lowerBound,Math.min(f[0],n[0]),Math.min(f[1],n[1])),i.set(e.upperBound,Math.max(f[0],n[0]),Math.max(f[1],n[1]))},o.prototype.reportIntersection=function(e,f,n,d){var t=this._currentShape,l=this._currentBody;if(!(this.skipBackfaces&&i.dot(n,this.direction)>0))switch(this.mode){case o.ALL:e.set(n,t,l,f,d),this.callback(e);break;case o.CLOSEST:(f<e.fraction||!e.hasHit())&&e.set(n,t,l,f,d);break;case o.ANY:e.set(n,t,l,f,d)}};var l=i.create(),p=i.create()},{"../math/vec2":25}],7:[function(e,f,n){function o(){this.normal=d.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}var d=e("../math/vec2"),i=e("../collision/Ray");f.exports=o,o.prototype.reset=function(){d.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},o.prototype.getHitDistance=function(e){return d.distance(e.from,e.to)*this.fraction},o.prototype.hasHit=function(){return-1!==this.fraction},o.prototype.getHitPoint=function(e,f){d.lerp(e,f.from,f.to,this.fraction)},o.prototype.stop=function(){this.isStopped=!0},o.prototype.shouldStop=function(e){return this.isStopped||-1!==this.fraction&&e.mode===i.ANY},o.prototype.set=function(e,f,n,o,i){d.copy(this.normal,e),this.shape=f,this.body=n,this.fraction=o,this.faceIndex=i}},{"../collision/Ray":6,"../math/vec2":25}],8:[function(e,f,n){function o(){t.call(this,t.SAP),this.axisList=[],this.axisIndex=0;var e=this;this._addBodyHandler=function(f){e.axisList.push(f.body)},this._removeBodyHandler=function(f){var n=e.axisList.indexOf(f.body);-1!==n&&e.axisList.splice(n,1)}}function d(e,f){f=0|f;for(var n=1,o=e.length;o>n;n++){for(var d=e[n],i=n-1;i>=0&&!(e[i].aabb.lowerBound[f]<=d.aabb.lowerBound[f]);i--)e[i+1]=e[i];e[i+1]=d}return e}var i=e("../utils/Utils"),t=e("../collision/Broadphase");f.exports=o,o.prototype=new t,o.prototype.constructor=o,
o.prototype.setWorld=function(e){this.axisList.length=0,i.appendArray(this.axisList,e.bodies),e.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),e.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=e},o.prototype.sortList=function(){var e=this.axisList,f=this.axisIndex;d(e,f)},o.prototype.getCollisionPairs=function(){var e=this.axisList,f=this.result,n=this.axisIndex;f.length=0;for(var o=e.length;o--;){var d=e[o];d.aabbNeedsUpdate&&d.updateAABB()}this.sortList();for(var i=0,l=0|e.length;i!==l;i++)for(var p=e[i],u=i+1;l>u;u++){var s=e[u],c=s.aabb.lowerBound[n]<=p.aabb.upperBound[n];if(!c)break;t.canCollide(p,s)&&this.boundingVolumeCheck(p,s)&&f.push(p,s)}return f},o.prototype.aabbQuery=function(e,f,n){n=n||[],this.sortList();for(var o=this.axisList,d=0;d<o.length;d++){var i=o[d];i.aabbNeedsUpdate&&i.updateAABB(),i.aabb.overlaps(f)&&n.push(i)}return n}},{"../collision/Broadphase":3,"../utils/Utils":50}],9:[function(e,f,n){function o(e,f,n,o){o=o||{},this.type=n,this.equations=[],this.bodyA=e,this.bodyB=f,this.collideConnected=void 0!==o.collideConnected?o.collideConnected:!0,o.wakeUpBodies!==!1&&(e&&e.wakeUp(),f&&f.wakeUp())}f.exports=o,o.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},o.DISTANCE=1,o.GEAR=2,o.LOCK=3,o.PRISMATIC=4,o.REVOLUTE=5,o.prototype.setStiffness=function(e){for(var f=this.equations,n=0;n!==f.length;n++){var o=f[n];o.stiffness=e,o.needsUpdate=!0}},o.prototype.setRelaxation=function(e){for(var f=this.equations,n=0;n!==f.length;n++){var o=f[n];o.relaxation=e,o.needsUpdate=!0}},o.prototype.setMaxBias=function(e){for(var f=this.equations,n=0;n!==f.length;n++){var o=f[n];o.maxBias=e}}},{}],10:[function(e,f,n){function o(e,f,n){n=n||{},d.call(this,e,f,d.DISTANCE,n),this.localAnchorA=n.localAnchorA?t.clone(n.localAnchorA):t.create(),this.localAnchorB=n.localAnchorB?t.clone(n.localAnchorB):t.create();var o=this.localAnchorA,l=this.localAnchorB;if(this.distance=0,"number"==typeof n.distance)this.distance=n.distance;else{var p=t.create(),u=t.create(),s=t.create();t.rotate(p,o,e.angle),t.rotate(u,l,f.angle),t.add(s,f.position,u),t.subtract(s,s,p),t.subtract(s,s,e.position),this.distance=t.length(s)}var c;c="undefined"==typeof n.maxForce?Number.MAX_VALUE:n.maxForce;var y=new i(e,f,-c,c);this.equations=[y],this.maxForce=c;var s=t.create(),a=t.create(),r=t.create(),w=this;y.computeGq=function(){var e=this.bodyA,f=this.bodyB,n=e.position,d=f.position;return t.rotate(a,o,e.angle),t.rotate(r,l,f.angle),t.add(s,d,r),t.subtract(s,s,a),t.subtract(s,s,n),t.length(s)-w.distance},this.setMaxForce(c),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var d=e("./Constraint"),i=e("../equations/Equation"),t=e("../math/vec2");f.exports=o,o.prototype=new d,o.prototype.constructor=o;var l=t.create(),p=t.create(),u=t.create();o.prototype.update=function(){var e=this.equations[0],f=this.bodyA,n=this.bodyB,o=f.position,d=n.position,i=this.equations[0],s=e.G;t.rotate(p,this.localAnchorA,f.angle),t.rotate(u,this.localAnchorB,n.angle),t.add(l,d,u),t.subtract(l,l,p),t.subtract(l,l,o),this.position=t.length(l);var c=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(i.maxForce=0,i.minForce=-this.maxForce,this.distance=this.upperLimit,c=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(i.maxForce=this.maxForce,i.minForce=0,this.distance=this.lowerLimit,c=!0),(this.lowerLimitEnabled||this.upperLimitEnabled)&&!c)return void(i.enabled=!1);i.enabled=!0,t.normalize(l,l);var y=t.crossLength(p,l),a=t.crossLength(u,l);s[0]=-l[0],s[1]=-l[1],s[2]=-y,s[3]=l[0],s[4]=l[1],s[5]=a},o.prototype.setMaxForce=function(e){var f=this.equations[0];f.minForce=-e,f.maxForce=e},o.prototype.getMaxForce=function(){var e=this.equations[0];return e.maxForce}},{"../equations/Equation":17,"../math/vec2":25,"./Constraint":9}],11:[function(e,f,n){function o(e,f,n){n=n||{},d.call(this,e,f,d.GEAR,n),this.ratio=void 0!==n.ratio?n.ratio:1,this.angle=void 0!==n.angle?n.angle:f.angle-this.ratio*e.angle;var o=t.shallowClone(n);o.angle=this.angle,o.ratio=this.ratio,this.equations=[new i(e,f,o)],void 0!==n.maxTorque&&this.setMaxTorque(n.maxTorque)}var d=e("./Constraint"),i=e("../equations/AngleLockEquation"),t=e("../utils/Utils");f.exports=o,o.prototype=new d,o.prototype.constructor=o,o.prototype.update=function(){var e=this.equations[0],f=this.ratio;e.ratio!==f&&e.setRatio(f),e.angle=this.angle},o.prototype.setMaxTorque=function(e){this.equations[0].setMaxTorque(e)},o.prototype.getMaxTorque=function(){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":15,"../utils/Utils":50,"./Constraint":9}],12:[function(e,f,n){function o(e,f,n){n=n||{},d.call(this,e,f,d.LOCK,n);var o="undefined"==typeof n.maxForce?Number.MAX_VALUE:n.maxForce,l=new t(e,f,-o,o),p=new t(e,f,-o,o),u=new t(e,f,-o,o),s=i.create(),c=i.create(),y=this;l.computeGq=function(){return i.rotate(s,y.localOffsetB,e.angle),i.subtract(c,f.position,e.position),i.subtract(c,c,s),c[0]},p.computeGq=function(){return i.rotate(s,y.localOffsetB,e.angle),i.subtract(c,f.position,e.position),i.subtract(c,c,s),c[1]};var a=i.create(),r=i.create();u.computeGq=function(){return i.rotate(a,y.localOffsetB,f.angle-y.localAngleB),i.scale(a,a,-1),i.subtract(c,e.position,f.position),i.add(c,c,a),i.rotate(r,a,-Math.PI/2),i.normalize(r,r),i.dot(c,r)},this.localOffsetB=i.create(),n.localOffsetB?i.copy(this.localOffsetB,n.localOffsetB):(i.subtract(this.localOffsetB,f.position,e.position),i.rotate(this.localOffsetB,this.localOffsetB,-e.angle)),this.localAngleB=0,"number"==typeof n.localAngleB?this.localAngleB=n.localAngleB:this.localAngleB=f.angle-e.angle,this.equations.push(l,p,u),this.setMaxForce(o)}var d=e("./Constraint"),i=e("../math/vec2"),t=e("../equations/Equation");f.exports=o,o.prototype=new d,o.prototype.constructor=o,o.prototype.setMaxForce=function(e){for(var f=this.equations,n=0;n<this.equations.length;n++)f[n].maxForce=e,f[n].minForce=-e},o.prototype.getMaxForce=function(){return this.equations[0].maxForce};var l=i.create(),p=i.create(),u=i.create(),s=i.fromValues(1,0),c=i.fromValues(0,1);o.prototype.update=function(){var e=this.equations[0],f=this.equations[1],n=this.equations[2],o=this.bodyA,d=this.bodyB;i.rotate(l,this.localOffsetB,o.angle),i.rotate(p,this.localOffsetB,d.angle-this.localAngleB),i.scale(p,p,-1),i.rotate(u,p,Math.PI/2),i.normalize(u,u),e.G[0]=-1,e.G[1]=0,e.G[2]=-i.crossLength(l,s),e.G[3]=1,f.G[0]=0,f.G[1]=-1,f.G[2]=-i.crossLength(l,c),f.G[4]=1,n.G[0]=-u[0],n.G[1]=-u[1],n.G[3]=u[0],n.G[4]=u[1],n.G[5]=i.crossLength(p,u)}},{"../equations/Equation":17,"../math/vec2":25,"./Constraint":9}],13:[function(e,f,n){function o(e,f,n){n=n||{},d.call(this,e,f,d.PRISMATIC,n);var o=l.create(),u=l.fromValues(1,0),s=l.create();n.localAnchorA&&l.copy(o,n.localAnchorA),n.localAxisA&&l.copy(u,n.localAxisA),n.localAnchorB&&l.copy(s,n.localAnchorB),this.localAnchorA=o,this.localAnchorB=s,this.localAxisA=u;var c=this.maxForce=void 0!==n.maxForce?n.maxForce:Number.MAX_VALUE,y=new t(e,f,-c,c),a=new l.create,r=new l.create,w=new l.create,b=new l.create;if(y.computeGq=function(){return l.dot(w,b)},y.updateJacobian=function(){var n=this.G,d=e.position,i=f.position;l.rotate(a,o,e.angle),l.rotate(r,s,f.angle),l.add(w,i,r),l.subtract(w,w,d),l.subtract(w,w,a),l.rotate(b,u,e.angle+Math.PI/2),n[0]=-b[0],n[1]=-b[1],n[2]=-l.crossLength(a,b)+l.crossLength(b,w),n[3]=b[0],n[4]=b[1],n[5]=l.crossLength(r,b)},this.equations.push(y),!n.disableRotationalLock){var g=new p(e,f,-c,c);this.equations.push(g)}this.position=0,this.velocity=0,this.lowerLimitEnabled=void 0!==n.lowerLimit?!0:!1,this.upperLimitEnabled=void 0!==n.upperLimit?!0:!1,this.lowerLimit=void 0!==n.lowerLimit?n.lowerLimit:0,this.upperLimit=void 0!==n.upperLimit?n.upperLimit:1,this.upperLimitEquation=new i(e,f),this.lowerLimitEquation=new i(e,f),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=c,this.motorEquation=new t(e,f),this.motorEnabled=!1,this.motorSpeed=0;var m=this,x=this.motorEquation;x.computeGq=function(){return 0},x.computeGW=function(){var e=this.G,f=this.bodyA,n=this.bodyB,o=f.velocity,d=n.velocity,i=f.angularVelocity,t=n.angularVelocity;return this.gmult(e,o,i,d,t)+m.motorSpeed}}var d=e("./Constraint"),i=e("../equations/ContactEquation"),t=e("../equations/Equation"),l=e("../math/vec2"),p=e("../equations/RotationalLockEquation");f.exports=o,o.prototype=new d,o.prototype.constructor=o;var u=l.create(),s=l.create(),c=l.create(),y=l.create(),a=l.create(),r=l.create();o.prototype.update=function(){var e=this.equations,f=e[0],n=this.upperLimit,o=this.lowerLimit,d=this.upperLimitEquation,i=this.lowerLimitEquation,t=this.bodyA,p=this.bodyB,w=this.localAxisA,b=this.localAnchorA,g=this.localAnchorB;f.updateJacobian(),l.rotate(u,w,t.angle),l.rotate(y,b,t.angle),l.add(s,y,t.position),l.rotate(a,g,p.angle),l.add(c,a,p.position);var m=this.position=l.dot(c,u)-l.dot(s,u);if(this.motorEnabled){var x=this.motorEquation.G;x[0]=u[0],x[1]=u[1],x[2]=l.crossLength(u,a),x[3]=-u[0],x[4]=-u[1],x[5]=-l.crossLength(u,y)}if(this.upperLimitEnabled&&m>n)l.scale(d.normalA,u,-1),l.subtract(d.contactPointA,s,t.position),l.subtract(d.contactPointB,c,p.position),l.scale(r,u,n),l.add(d.contactPointA,d.contactPointA,r),-1===e.indexOf(d)&&e.push(d);else{var j=e.indexOf(d);-1!==j&&e.splice(j,1)}if(this.lowerLimitEnabled&&o>m)l.scale(i.normalA,u,1),l.subtract(i.contactPointA,s,t.position),l.subtract(i.contactPointB,c,p.position),l.scale(r,u,o),l.subtract(i.contactPointB,i.contactPointB,r),-1===e.indexOf(i)&&e.push(i);else{var j=e.indexOf(i);-1!==j&&e.splice(j,1)}},o.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},o.prototype.disableMotor=function(){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations.splice(e,1),this.motorEnabled=!1}},o.prototype.setLimits=function(e,f){"number"==typeof e?(this.lowerLimit=e,this.lowerLimitEnabled=!0):(this.lowerLimit=e,this.lowerLimitEnabled=!1),"number"==typeof f?(this.upperLimit=f,this.upperLimitEnabled=!0):(this.upperLimit=f,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":16,"../equations/Equation":17,"../equations/RotationalLockEquation":19,"../math/vec2":25,"./Constraint":9}],14:[function(e,f,n){function o(e,f,n){n=n||{},d.call(this,e,f,d.REVOLUTE,n);var o=this.maxForce=void 0!==n.maxForce?n.maxForce:Number.MAX_VALUE,r=this.pivotA=p.create(),j=this.pivotB=p.create();n.worldPivot?(u(r,n.worldPivot,e.position),u(j,n.worldPivot,f.position),c(r,r,-e.angle),c(j,j,-f.angle)):(n.localPivotA&&a(r,n.localPivotA),n.localPivotB&&a(j,n.localPivotB));var v=this.motorEquation=new t(e,f);v.enabled=!1;var h=this.upperLimitEquation=new l(e,f),k=this.lowerLimitEquation=new l(e,f);h.minForce=k.maxForce=0;var q=this.equations=[new i(e,f,-o,o),new i(e,f,-o,o),v,h,k],z=q[0],A=q[1];z.computeGq=function(){return c(w,r,e.angle),c(b,j,f.angle),s(x,f.position,b),u(x,x,e.position),u(x,x,w),y(x,g)},A.computeGq=function(){return c(w,r,e.angle),c(b,j,f.angle),s(x,f.position,b),u(x,x,e.position),u(x,x,w),y(x,m)},A.minForce=z.minForce=-o,A.maxForce=z.maxForce=o,z.G[0]=-1,z.G[1]=0,z.G[3]=1,z.G[4]=0,A.G[0]=0,A.G[1]=-1,A.G[3]=0,A.G[4]=1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0}var d=e("./Constraint"),i=e("../equations/Equation"),t=e("../equations/RotationalVelocityEquation"),l=e("../equations/RotationalLockEquation"),p=e("../math/vec2"),u=p.subtract,s=p.add,c=p.rotate,y=p.dot,a=p.copy,r=p.crossLength;f.exports=o;var w=p.create(),b=p.create(),g=p.fromValues(1,0),m=p.fromValues(0,1),x=p.create();o.prototype=new d,o.prototype.constructor=o,o.prototype.setLimits=function(e,f){this.lowerLimit=e,this.upperLimit=f,this.lowerLimitEnabled=this.upperLimitEnabled=!0},o.prototype.update=function(){var e=this.bodyA,f=this.bodyB,n=this.pivotA,o=this.pivotB,d=this.equations,i=d[0],t=d[1],l=this.upperLimit,p=this.lowerLimit,u=this.upperLimitEquation,s=this.lowerLimitEquation,y=this.angle=f.angle-e.angle;u.angle=l,u.enabled=this.upperLimitEnabled&&y>l,s.angle=p,s.enabled=this.lowerLimitEnabled&&p>y,c(w,n,e.angle),c(b,o,f.angle);var a=i.G;a[2]=-r(w,g),a[5]=r(b,g);var x=t.G;x[2]=-r(w,m),x[5]=r(b,m)},Object.defineProperties(o.prototype,{motorEnabled:{get:function(){return this.motorEquation.enabled},set:function(e){this.motorEquation.enabled=e}},motorSpeed:{get:function(){return this.motorEquation.relativeVelocity},set:function(e){this.motorEquation.relativeVelocity=e}},motorMaxForce:{get:function(){return this.motorEquation.maxForce},set:function(e){var f=this.motorEquation;f.maxForce=e,f.minForce=-e}}}),o.prototype.enableMotor=function(){console.warn("revolute.enableMotor() is deprecated, do revolute.motorEnabled = true; instead."),this.motorEnabled=!0},o.prototype.disableMotor=function(){console.warn("revolute.disableMotor() is deprecated, do revolute.motorEnabled = false; instead."),this.motorEnabled=!1},o.prototype.motorIsEnabled=function(){return console.warn("revolute.motorIsEnabled() is deprecated, use revolute.motorEnabled instead."),this.motorEnabled},o.prototype.setMotorSpeed=function(e){console.warn("revolute.setMotorSpeed(speed) is deprecated, do revolute.motorSpeed = speed; instead."),this.motorSpeed=e},o.prototype.getMotorSpeed=function(){return console.warn("revolute.getMotorSpeed() is deprecated, use revolute.motorSpeed instead."),this.motorSpeed}},{"../equations/Equation":17,"../equations/RotationalLockEquation":19,"../equations/RotationalVelocityEquation":20,"../math/vec2":25,"./Constraint":9}],15:[function(e,f,n){function o(e,f,n){n=n||{},d.call(this,e,f,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=n.angle||0,this.ratio=void 0!==n.ratio?n.ratio:1,this.setRatio(this.ratio)}var d=e("./Equation");f.exports=o,o.prototype=new d,o.prototype.constructor=o,o.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},o.prototype.setRatio=function(e){var f=this.G;f[2]=e,f[5]=-1,this.ratio=e},o.prototype.setMaxTorque=function(e){this.maxForce=e,this.minForce=-e}},{"./Equation":17}],16:[function(e,f,n){function o(e,f){i.call(this,e,f,0,Number.MAX_VALUE),this.contactPointA=t.create(),this.penetrationVec=t.create(),this.contactPointB=t.create(),this.normalA=t.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}function d(e,f,n,o,d){e[0]=f[0]+n[0]-o[0]-d[0],e[1]=f[1]+n[1]-o[1]-d[1]}var i=e("./Equation"),t=e("../math/vec2");f.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.computeB=function(e,f,n){var o=this.bodyA,i=this.bodyB,l=this.contactPointA,p=this.contactPointB,u=o.position,s=i.position,c=this.normalA,y=this.G,a=t.crossLength(l,c),r=t.crossLength(p,c);y[0]=-c[0],y[1]=-c[1],y[2]=-a,y[3]=c[0],y[4]=c[1],y[5]=r;var w,b;if(this.firstImpact&&0!==this.restitution)b=0,w=1/f*(1+this.restitution)*this.computeGW();else{var g=this.penetrationVec;d(g,s,p,u,l),b=t.dot(c,g)+this.offset,w=this.computeGW()}var m=this.computeGiMf(),x=-b*e-w*f-n*m;return x};var l=t.create(),p=t.create(),u=t.create();o.prototype.getVelocityAlongNormal=function(){return this.bodyA.getVelocityAtPoint(l,this.contactPointA),this.bodyB.getVelocityAtPoint(p,this.contactPointB),t.subtract(u,l,p),t.dot(this.normalA,u)}},{"../math/vec2":25,"./Equation":17}],17:[function(e,f,n){function o(e,f,n,d){this.minForce=void 0===n?-Number.MAX_VALUE:n,this.maxForce=void 0===d?Number.MAX_VALUE:d,this.maxBias=Number.MAX_VALUE,this.bodyA=e,this.bodyB=f,this.stiffness=o.DEFAULT_STIFFNESS,this.relaxation=o.DEFAULT_RELAXATION,this.G=new u.ARRAY_TYPE(6);for(var i=0;6>i;i++)this.G[i]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0,this.lambda=this.B=this.invC=this.minForceDt=this.maxForceDt=0,this.index=-1}function d(e,f,n,o,d,i){e[0]+=f*o*d*i[0],e[1]+=n*o*d*i[1]}f.exports=o;var i=e("../math/vec2"),t=i.scale,l=i.multiply,p=i.create,u=e("../utils/Utils");o.DEFAULT_STIFFNESS=1e6,o.DEFAULT_RELAXATION=4;var s=p(),c=p(),y=p(),a=p();o.prototype={update:function(){var e=this.stiffness,f=this.relaxation,n=this.timeStep;this.a=4/(n*(1+4*f)),this.b=4*f/(1+4*f),this.epsilon=4/(n*n*e*(1+4*f)),this.needsUpdate=!1},gmult:function(e,f,n,o,d){return e[0]*f[0]+e[1]*f[1]+e[2]*n+e[3]*o[0]+e[4]*o[1]+e[5]*d},computeB:function(e,f,n){var o=this.computeGW(),d=this.computeGq(),i=this.maxBias;Math.abs(d)>i&&(d=d>0?i:-i);var t=this.computeGiMf(),l=-d*e-o*f-t*n;return l},computeGq:function(){var e=this.G,f=this.bodyA,n=this.bodyB,o=f.angle,d=n.angle;return this.gmult(e,s,o,c,d)+this.offset},computeGW:function(){var e=this.G,f=this.bodyA,n=this.bodyB,o=f.velocity,d=n.velocity,i=f.angularVelocity,t=n.angularVelocity;return this.gmult(e,o,i,d,t)+this.relativeVelocity},computeGWlambda:function(){var e=this.G,f=this.bodyA,n=this.bodyB,o=f.vlambda,d=n.vlambda,i=f.wlambda,t=n.wlambda;return this.gmult(e,o,i,d,t)},computeGiMf:function(){var e=this.bodyA,f=this.bodyB,n=e.force,o=e.angularForce,d=f.force,i=f.angularForce,p=e.invMassSolve,u=f.invMassSolve,s=e.invInertiaSolve,c=f.invInertiaSolve,r=this.G;return t(y,n,p),l(y,e.massMultiplier,y),t(a,d,u),l(a,f.massMultiplier,a),this.gmult(r,y,o*s,a,i*c)},computeGiMGt:function(){var e=this.bodyA,f=this.bodyB,n=e.invMassSolve,o=f.invMassSolve,d=e.invInertiaSolve,i=f.invInertiaSolve,t=this.G;return t[0]*t[0]*n*e.massMultiplier[0]+t[1]*t[1]*n*e.massMultiplier[1]+t[2]*t[2]*d+t[3]*t[3]*o*f.massMultiplier[0]+t[4]*t[4]*o*f.massMultiplier[1]+t[5]*t[5]*i},addToWlambda:function(e){var f=this.bodyA,n=this.bodyB,o=f.invMassSolve,i=n.invMassSolve,t=f.invInertiaSolve,l=n.invInertiaSolve,p=this.G;d(f.vlambda,p[0],p[1],o,e,f.massMultiplier),f.wlambda+=t*p[2]*e,d(n.vlambda,p[3],p[4],i,e,n.massMultiplier),n.wlambda+=l*p[5]*e},computeInvC:function(e){var f=1/(this.computeGiMGt()+e);return f}}},{"../math/vec2":25,"../utils/Utils":50}],18:[function(e,f,n){function o(e,f,n){i.call(this,e,f,-n,n),this.contactPointA=d.create(),this.contactPointB=d.create(),this.t=d.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var d=e("../math/vec2"),i=e("./Equation");f.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.setSlipForce=function(e){this.maxForce=e,this.minForce=-e},o.prototype.getSlipForce=function(){return this.maxForce},o.prototype.computeB=function(e,f,n){var o=this.contactPointA,i=this.contactPointB,t=this.t,l=this.G;l[0]=-t[0],l[1]=-t[1],l[2]=-d.crossLength(o,t),l[3]=t[0],l[4]=t[1],l[5]=d.crossLength(i,t);var p=this.computeGW(),u=this.computeGiMf(),s=-p*f-n*u;return s}},{"../math/vec2":25,"./Equation":17}],19:[function(e,f,n){function o(e,f,n){n=n||{},d.call(this,e,f,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=n.angle||0;var o=this.G;o[2]=1,o[5]=-1}var d=e("./Equation"),i=e("../math/vec2");f.exports=o,o.prototype=new d,o.prototype.constructor=o;var t=i.create(),l=i.create(),p=i.fromValues(1,0),u=i.fromValues(0,1);o.prototype.computeGq=function(){return i.rotate(t,p,this.bodyA.angle+this.angle),i.rotate(l,u,this.bodyB.angle),i.dot(t,l)}},{"../math/vec2":25,"./Equation":17}],20:[function(e,f,n){function o(e,f){d.call(this,e,f,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var d=e("./Equation");f.exports=o,o.prototype=new d,o.prototype.constructor=o,o.prototype.computeB=function(e,f,n){var o=this.G;o[2]=-1,o[5]=this.ratio;var d=this.computeGiMf(),i=this.computeGW(),t=-i*f-n*d;return t}},{"./Equation":17}],21:[function(e,f,n){function o(){this.tmpArray=[]}f.exports=o,o.prototype={constructor:o,on:function(e,f,n){f.context=n||this,void 0===this._listeners&&(this._listeners={});var o=this._listeners;return void 0===o[e]&&(o[e]=[]),-1===o[e].indexOf(f)&&o[e].push(f),this},off:function(e,f){var n=this._listeners;if(!n||!n[e])return this;var o=n[e].indexOf(f);return-1!==o&&n[e].splice(o,1),this},has:function(e,f){if(void 0===this._listeners)return!1;var n=this._listeners;if(f){if(void 0!==n[e]&&-1!==n[e].indexOf(f))return!0}else if(void 0!==n[e])return!0;return!1},emit:function(e){if(void 0===this._listeners)return this;var f=this._listeners,n=f[e.type];if(void 0!==n){e.target=this;for(var o=this.tmpArray,d=0,i=n.length;i>d;d++)o[d]=n[d];for(var d=0,i=o.length;i>d;d++){var t=o[d];t.call(t.context,e)}o.length=0}return this}}},{}],22:[function(e,f,n){function o(e,f,n){if(n=n||{},!(e instanceof d&&f instanceof d))throw new Error("First two arguments must be Material instances.");this.id=o.idCounter++,this.materialA=e,this.materialB=f,this.friction=void 0!==n.friction?n.friction:.3,this.restitution=void 0!==n.restitution?n.restitution:0,this.stiffness=void 0!==n.stiffness?n.stiffness:i.DEFAULT_STIFFNESS,this.relaxation=void 0!==n.relaxation?n.relaxation:i.DEFAULT_RELAXATION,this.frictionStiffness=void 0!==n.frictionStiffness?n.frictionStiffness:i.DEFAULT_STIFFNESS,this.frictionRelaxation=void 0!==n.frictionRelaxation?n.frictionRelaxation:i.DEFAULT_RELAXATION,this.surfaceVelocity=void 0!==n.surfaceVelocity?n.surfaceVelocity:0,this.contactSkinSize=.005}var d=e("./Material"),i=e("../equations/Equation");f.exports=o,o.idCounter=0},{"../equations/Equation":17,"./Material":23}],23:[function(e,f,n){function o(){this.id=o.idCounter++}f.exports=o,o.idCounter=0},{}],24:[function(e,f,n){var o={};o.GetArea=function(e){if(e.length<6)return 0;for(var f=e.length-2,n=0,o=0;f>o;o+=2)n+=(e[o+2]-e[o])*(e[o+1]+e[o+3]);return n+=(e[0]-e[f])*(e[f+1]+e[1]),.5*-n},o.Triangulate=function(e){var f=e.length>>1;if(3>f)return[];for(var n=[],d=[],i=0;f>i;i++)d.push(i);for(var i=0,t=f;t>3;){var l=d[(i+0)%t],p=d[(i+1)%t],u=d[(i+2)%t],s=e[2*l],c=e[2*l+1],y=e[2*p],a=e[2*p+1],r=e[2*u],w=e[2*u+1],b=!1;if(o._convex(s,c,y,a,r,w)){b=!0;for(var g=0;t>g;g++){var m=d[g];if(m!=l&&m!=p&&m!=u&&o._PointInTriangle(e[2*m],e[2*m+1],s,c,y,a,r,w)){b=!1;break}}}if(b)n.push(l,p,u),d.splice((i+1)%t,1),t--,i=0;else if(i++>3*t)break}return n.push(d[0],d[1],d[2]),n},o._PointInTriangle=function(e,f,n,o,d,i,t,l){var p=t-n,u=l-o,s=d-n,c=i-o,y=e-n,a=f-o,r=p*p+u*u,w=p*s+u*c,b=p*y+u*a,g=s*s+c*c,m=s*y+c*a,x=1/(r*g-w*w),j=(g*b-w*m)*x,v=(r*m-w*b)*x;return j>=0&&v>=0&&1>j+v},o._convex=function(e,f,n,o,d,i){return(f-o)*(d-n)+(n-e)*(i-o)>=0},f.exports=o},{}],25:[function(e,f,n){var o=f.exports={},d=e("../utils/Utils");o.crossLength=function(e,f){return e[0]*f[1]-e[1]*f[0]},o.crossVZ=function(e,f,n){return o.rotate(e,f,-Math.PI/2),o.scale(e,e,n),e},o.crossZV=function(e,f,n){return o.rotate(e,n,Math.PI/2),o.scale(e,e,f),e},o.rotate=function(e,f,n){if(0!==n){var o=Math.cos(n),d=Math.sin(n),i=f[0],t=f[1];e[0]=o*i-d*t,e[1]=d*i+o*t}else e[0]=f[0],e[1]=f[1];return e},o.rotate90cw=function(e,f){var n=f[0],o=f[1];return e[0]=o,e[1]=-n,e},o.toLocalFrame=function(e,f,n,o){var d=Math.cos(-o),i=Math.sin(-o),t=f[0]-n[0],l=f[1]-n[1];return e[0]=d*t-i*l,e[1]=i*t+d*l,e},o.toGlobalFrame=function(e,f,n,o){var d=Math.cos(o),i=Math.sin(o),t=f[0],l=f[1],p=n[0],u=n[1];e[0]=d*t-i*l+p,e[1]=i*t+d*l+u},o.vectorToLocalFrame=function(e,f,n){var o=Math.cos(-n),d=Math.sin(-n),i=f[0],t=f[1];return e[0]=o*i-d*t,e[1]=d*i+o*t,e},o.vectorToGlobalFrame=o.rotate,o.centroid=function(e,f,n,d){return o.add(e,f,n),o.add(e,e,d),o.scale(e,e,1/3),e},o.create=function(){var e=new d.ARRAY_TYPE(2);return e[0]=0,e[1]=0,e},o.clone=function(e){var f=new d.ARRAY_TYPE(2);return f[0]=e[0],f[1]=e[1],f},o.fromValues=function(e,f){var n=new d.ARRAY_TYPE(2);return n[0]=e,n[1]=f,n},o.copy=function(e,f){return e[0]=f[0],e[1]=f[1],e},o.set=function(e,f,n){return e[0]=f,e[1]=n,e},o.add=function(e,f,n){return e[0]=f[0]+n[0],e[1]=f[1]+n[1],e},o.subtract=function(e,f,n){return e[0]=f[0]-n[0],e[1]=f[1]-n[1],e},o.multiply=function(e,f,n){return e[0]=f[0]*n[0],e[1]=f[1]*n[1],e},o.divide=function(e,f,n){return e[0]=f[0]/n[0],e[1]=f[1]/n[1],e},o.scale=function(e,f,n){return e[0]=f[0]*n,e[1]=f[1]*n,e},o.distance=function(e,f){var n=f[0]-e[0],o=f[1]-e[1];return Math.sqrt(n*n+o*o)},o.squaredDistance=function(e,f){var n=f[0]-e[0],o=f[1]-e[1];return n*n+o*o},o.length=function(e){var f=e[0],n=e[1];return Math.sqrt(f*f+n*n)},o.squaredLength=function(e){var f=e[0],n=e[1];return f*f+n*n},o.negate=function(e,f){return e[0]=-f[0],e[1]=-f[1],e},o.normalize=function(e,f){var n=f[0],o=f[1],d=n*n+o*o;return d>0&&(d=1/Math.sqrt(d),e[0]=f[0]*d,e[1]=f[1]*d),e},o.dot=function(e,f){return e[0]*f[0]+e[1]*f[1]},o.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},o.lerp=function(e,f,n,o){var d=f[0],i=f[1];return e[0]=d+o*(n[0]-d),e[1]=i+o*(n[1]-i),e},o.reflect=function(e,f,n){var o=f[0]*n[0]+f[1]*n[1];e[0]=f[0]-2*n[0]*o,e[1]=f[1]-2*n[1]*o},o.getLineSegmentsIntersection=function(e,f,n,d,i){var t=o.getLineSegmentsIntersectionFraction(f,n,d,i);return 0>t?!1:(e[0]=f[0]+t*(n[0]-f[0]),e[1]=f[1]+t*(n[1]-f[1]),!0)},o.getLineSegmentsIntersectionFraction=function(e,f,n,o){var d,i,t=f[0]-e[0],l=f[1]-e[1],p=o[0]-n[0],u=o[1]-n[1];return d=(-l*(e[0]-n[0])+t*(e[1]-n[1]))/(-p*l+t*u),i=(p*(e[1]-n[1])-u*(e[0]-n[0]))/(-p*l+t*u),d>=0&&1>=d&&i>=0&&1>=i?i:-1}},{"../utils/Utils":50}],26:[function(e,f,n){function o(e){e=e||{},a.call(this),this.id=e.id||++o._idCounter,this.index=-1,this.world=null,this.shapes=[],this.mass=e.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!e.fixedRotation,this.fixedX=!!e.fixedX,this.fixedY=!!e.fixedY,this.massMultiplier=l(),this.position=e.position?d.clone(e.position):l(),this.interpolatedPosition=d.clone(this.position),this.previousPosition=d.clone(this.position),this.velocity=e.velocity?d.clone(e.velocity):l(),this.vlambda=l(),this.wlambda=0,this.angle=e.angle||0,this.previousAngle=this.angle,this.interpolatedAngle=this.angle,this.angularVelocity=e.angularVelocity||0,this.force=e.force?d.clone(e.force):l(),this.angularForce=e.angularForce||0,this.damping=void 0!==e.damping?e.damping:.1,this.angularDamping=void 0!==e.angularDamping?e.angularDamping:.1,this.type=o.STATIC,void 0!==e.type?this.type=e.type:e.mass?this.type=o.DYNAMIC:this.type=o.STATIC,this.boundingRadius=0,this.aabb=new y,this.aabbNeedsUpdate=!0,this.allowSleep=void 0!==e.allowSleep?e.allowSleep:!0,this.wantsToSleep=!1,this.sleepState=o.AWAKE,this.sleepSpeedLimit=void 0!==e.sleepSpeedLimit?e.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==e.sleepTimeLimit?e.sleepTimeLimit:1,this.gravityScale=void 0!==e.gravityScale?e.gravityScale:1,this.collisionResponse=void 0!==e.collisionResponse?e.collisionResponse:!0,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==e.ccdSpeedThreshold?e.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==e.ccdIterations?e.ccdIterations:10,this.islandId=-1,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var d=e("../math/vec2"),i=d.add,t=d.subtract,l=d.create,p=e("poly-decomp"),u=e("../shapes/Convex"),s=e("../collision/RaycastResult"),c=e("../collision/Ray"),y=e("../collision/AABB"),a=e("../events/EventEmitter");f.exports=o,o.prototype=new a,o.prototype.constructor=o,o._idCounter=0;var r={type:"sleepy"},w={type:"sleep"},b={type:"wakeup"};o.prototype.updateSolveMassProperties=function(){this.sleepState===o.SLEEPING||this.type===o.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},o.prototype.setDensity=function(e){var f=this.getArea();this.mass=f*e,this.updateMassProperties()},o.prototype.getArea=function(){for(var e=0,f=0;f<this.shapes.length;f++)e+=this.shapes[f].area;return e},o.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var g=new y,m=l();o.prototype.updateAABB=function(){for(var e=this.shapes,f=e.length,n=m,o=this.angle,i=0;i!==f;i++){var t=e[i],l=t.angle+o;d.toGlobalFrame(n,t.position,this.position,o),t.computeAABB(g,n,l),0===i?this.aabb.copy(g):this.aabb.extend(g)}this.aabbNeedsUpdate=!1},o.prototype.updateBoundingRadius=function(){for(var e=this.shapes,f=e.length,n=0,o=0;o!==f;o++){var i=e[o],t=d.length(i.position),l=i.boundingRadius;t+l>n&&(n=t+l)}this.boundingRadius=n},o.prototype.addShape=function(e,f,n){if(e.body)throw new Error("A shape can only be added to one body.");var o=this.world;if(o&&o.stepping)throw new Error("A shape cannot be added during step.");e.body=this,f?d.copy(e.position,f):d.set(e.position,0,0),e.angle=n||0,this.shapes.push(e),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},o.prototype.removeShape=function(e){var f=this.world;if(f&&f.stepping)throw new Error("A shape cannot be removed during step.");var n=this.shapes.indexOf(e);return-1!==n?(this.shapes.splice(n,1),this.aabbNeedsUpdate=!0,e.body=null,!0):!1},o.prototype.updateMassProperties=function(){if(this.type===o.STATIC||this.type===o.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var e=this.shapes,f=e.length,n=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var i=0;f>i;i++){var t=e[i],l=d.squaredLength(t.position),p=t.computeMomentOfInertia();n+=p+l}this.inertia=this.mass*n,this.invInertia=n>0?1/n:0}this.invMass=1/this.mass,d.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}},o.prototype.applyForce=function(e,f){if(i(this.force,this.force,e),f){var n=d.crossLength(f,e);this.angularForce+=n}};var x=l(),j=l(),v=l();o.prototype.applyForceLocal=function(e,f){f=f||v;var n=x,o=j;this.vectorToWorldFrame(n,e),this.vectorToWorldFrame(o,f),this.applyForce(n,o)};var h=l();o.prototype.applyImpulse=function(e,f){if(this.type===o.DYNAMIC){var n=h;if(d.scale(n,e,this.invMass),d.multiply(n,this.massMultiplier,n),i(this.velocity,n,this.velocity),f){var t=d.crossLength(f,e);t*=this.invInertia,this.angularVelocity+=t}}};var k=l(),q=l(),z=l();o.prototype.applyImpulseLocal=function(e,f){f=f||z;var n=k,o=q;this.vectorToWorldFrame(n,e),this.vectorToWorldFrame(o,f),this.applyImpulse(n,o)},o.prototype.toLocalFrame=function(e,f){d.toLocalFrame(e,f,this.position,this.angle)},o.prototype.toWorldFrame=function(e,f){d.toGlobalFrame(e,f,this.position,this.angle)},o.prototype.vectorToLocalFrame=function(e,f){d.vectorToLocalFrame(e,f,this.angle)},o.prototype.vectorToWorldFrame=function(e,f){d.vectorToGlobalFrame(e,f,this.angle)},o.prototype.fromPolygon=function(e,f){f=f||{};for(var n=this.shapes.length;n>=0;--n)this.removeShape(this.shapes[n]);for(var o=[],n=0;n<e.length;n++)o[n]=d.clone(e[n]);if(p.makeCCW(o),void 0!==f.removeCollinearPoints&&p.removeCollinearPoints(o,f.removeCollinearPoints),!f.skipSimpleCheck&&!p.isSimple(o))return!1;for(var i=this.concavePath=[],n=0;n<o.length;n++)i[n]=d.clone(o[n]);var s;s=f.optimalDecomp?p.decomp(o):p.quickDecomp(o);for(var c=l(),n=0;n!==s.length;n++){for(var y=new u({vertices:s[n]}),a=0;a!==y.vertices.length;a++){var r=y.vertices[a];t(r,r,y.centerOfMass)}d.copy(c,y.centerOfMass),y=new u({vertices:y.vertices}),this.addShape(y,c)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var A=l(),B=l(),C=l();o.prototype.adjustCenterOfMass=function(){var e=A,f=B,n=C,o=0;d.set(f,0,0);for(var l=0;l!==this.shapes.length;l++){var p=this.shapes[l];d.scale(e,p.position,p.area),i(f,f,e),o+=p.area}d.scale(n,f,1/o);for(var l=0;l!==this.shapes.length;l++){var p=this.shapes[l];t(p.position,p.position,n)}i(this.position,this.position,n);for(var l=0;this.concavePath&&l<this.concavePath.length;l++)t(this.concavePath[l],this.concavePath[l],n);this.updateMassProperties(),this.updateBoundingRadius()},o.prototype.setZeroForce=function(){var e=this.force;e[0]=e[1]=this.angularForce=0},o.prototype.resetConstraintVelocity=function(){var e=this,f=e.vlambda;d.set(f,0,0),e.wlambda=0},o.prototype.addConstraintVelocity=function(){var e=this,f=e.velocity;i(f,f,e.vlambda),e.angularVelocity+=e.wlambda},o.prototype.applyDamping=function(e){if(this.type===o.DYNAMIC){var f=this.velocity;d.scale(f,f,Math.pow(1-this.damping,e)),this.angularVelocity*=Math.pow(1-this.angularDamping,e);
}},o.prototype.wakeUp=function(){var e=this.sleepState;this.sleepState=o.AWAKE,this.idleTime=0,e!==o.AWAKE&&this.emit(b)},o.prototype.sleep=function(){this.sleepState=o.SLEEPING,this.angularVelocity=this.angularForce=0,d.set(this.velocity,0,0),d.set(this.force,0,0),this.emit(w)},o.prototype.sleepTick=function(e,f,n){if(this.allowSleep&&this.type!==o.SLEEPING){this.wantsToSleep=!1;var i=d.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2),t=Math.pow(this.sleepSpeedLimit,2);i>=t?(this.idleTime=0,this.sleepState=o.AWAKE):(this.idleTime+=n,this.sleepState!==o.SLEEPY&&(this.sleepState=o.SLEEPY,this.emit(r))),this.idleTime>this.sleepTimeLimit&&(f?this.wantsToSleep=!0:this.sleep())}},o.prototype.overlaps=function(e){return this.world.overlapKeeper.bodiesAreOverlapping(this,e)};var D=l(),E=l();o.prototype.integrate=function(e){var f=this.invMass,n=this.force,o=this.position,t=this.velocity;d.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*e),d.scale(D,n,e*f),d.multiply(D,this.massMultiplier,D),i(t,D,t),this.integrateToTimeOfImpact(e)||(d.scale(E,t,e),i(o,o,E),this.fixedRotation||(this.angle+=this.angularVelocity*e)),this.aabbNeedsUpdate=!0};var F=new s,G=new c({mode:c.CLOSEST,skipBackfaces:!0}),H=l(),I=l(),J=l(),K=l();o.prototype.integrateToTimeOfImpact=function(e){if(this.ccdSpeedThreshold<0||d.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;for(var f=[],n=this.world.disabledBodyCollisionPairs,o=0;o<n.length;o+=2){var l=n[o],p=n[o+1];l===this?f.push(p):p===this&&f.push(l)}d.normalize(H,this.velocity),d.scale(I,this.velocity,e),i(I,I,this.position),t(J,I,this.position);var u,s=this.angularVelocity*e,c=d.length(J),y=1;d.copy(G.from,this.position),d.copy(G.to,I),G.update();for(var o=0;o<this.shapes.length;o++){var a=this.shapes[o];if(F.reset(),G.collisionGroup=a.collisionGroup,G.collisionMask=a.collisionMask,this.world.raycast(F,G),u=F.body,(u===this||-1!==f.indexOf(u))&&(u=null),u)break}if(!u||!y)return!1;F.getHitPoint(I,G),t(J,I,this.position),y=d.distance(I,this.position)/c;var r=this.angle;d.copy(K,this.position);for(var w=0,b=0,g=y,m=1;m>=b&&w<this.ccdIterations;){w++,g=(m+b)/2,d.scale(E,J,g),i(this.position,K,E),this.angle=r+s*g,this.updateAABB();var x=this.aabb.overlaps(u.aabb)&&this.world.narrowphase.bodiesOverlap(this,u,!0);x?m=g:b=g}return y=m,d.copy(this.position,K),this.angle=r,d.scale(E,J,y),i(this.position,this.position,E),this.fixedRotation||(this.angle+=s*y),!0},o.prototype.getVelocityAtPoint=function(e,f){return d.crossVZ(e,f,this.angularVelocity),d.subtract(e,this.velocity,e),e},o.DYNAMIC=1,o.STATIC=2,o.KINEMATIC=4,o.AWAKE=0,o.SLEEPY=1,o.SLEEPING=2},{"../collision/AABB":2,"../collision/Ray":6,"../collision/RaycastResult":7,"../events/EventEmitter":21,"../math/vec2":25,"../shapes/Convex":35,"poly-decomp":1}],27:[function(e,f,n){function o(e,f,n){n=n||{},i.call(this,e,f,n),this.localAnchorA=d.create(),this.localAnchorB=d.create(),n.localAnchorA&&d.copy(this.localAnchorA,n.localAnchorA),n.localAnchorB&&d.copy(this.localAnchorB,n.localAnchorB),n.worldAnchorA&&this.setWorldAnchorA(n.worldAnchorA),n.worldAnchorB&&this.setWorldAnchorB(n.worldAnchorB);var o=d.create(),t=d.create();this.getWorldAnchorA(o),this.getWorldAnchorB(t);var l=d.distance(o,t);this.restLength=void 0!==n.restLength?n.restLength:l}var d=e("../math/vec2"),i=e("./Spring");f.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.setWorldAnchorA=function(e){this.bodyA.toLocalFrame(this.localAnchorA,e)},o.prototype.setWorldAnchorB=function(e){this.bodyB.toLocalFrame(this.localAnchorB,e)},o.prototype.getWorldAnchorA=function(e){this.bodyA.toWorldFrame(e,this.localAnchorA)},o.prototype.getWorldAnchorB=function(e){this.bodyB.toWorldFrame(e,this.localAnchorB)};var t=d.create(),l=d.create(),p=d.create(),u=d.create(),s=d.create(),c=d.create(),y=d.create(),a=d.create(),r=d.create();o.prototype.applyForce=function(){var e=this.stiffness,f=this.damping,n=this.restLength,o=this.bodyA,i=this.bodyB,w=t,b=l,g=p,m=u,x=r,j=s,v=c,h=y,k=a;this.getWorldAnchorA(j),this.getWorldAnchorB(v),d.subtract(h,j,o.position),d.subtract(k,v,i.position),d.subtract(w,v,j);var q=d.length(w);d.normalize(b,w),d.subtract(g,i.velocity,o.velocity),d.crossZV(x,i.angularVelocity,k),d.add(g,g,x),d.crossZV(x,o.angularVelocity,h),d.subtract(g,g,x),d.scale(m,b,-e*(q-n)-f*d.dot(g,b)),d.subtract(o.force,o.force,m),d.add(i.force,i.force,m);var z=d.crossLength(h,m),A=d.crossLength(k,m);o.angularForce-=z,i.angularForce+=A}},{"../math/vec2":25,"./Spring":29}],28:[function(e,f,n){function o(e,f,n){n=n||{},d.call(this,e,f,n),this.restAngle=void 0!==n.restAngle?n.restAngle:f.angle-e.angle}var d=e("./Spring");f.exports=o,o.prototype=new d,o.prototype.constructor=o,o.prototype.applyForce=function(){var e=this.stiffness,f=this.damping,n=this.restAngle,o=this.bodyA,d=this.bodyB,i=d.angle-o.angle,t=d.angularVelocity-o.angularVelocity,l=-e*(i-n)-f*t;o.angularForce-=l,d.angularForce+=l}},{"./Spring":29}],29:[function(e,f,n){function o(e,f,n){n=n||{},this.stiffness=void 0!==n.stiffness?n.stiffness:100,this.damping=void 0!==n.damping?n.damping:1,this.bodyA=e,this.bodyB=f}f.exports=o,o.prototype.applyForce=function(){}},{}],30:[function(e,f,n){function o(e,f){f=f||{},this.chassisBody=e,this.wheels=[],this.groundBody=new p({mass:0}),this.world=null;var n=this;this.preStepCallback=function(){n.update()}}function d(e,f){f=f||{},this.vehicle=e,this.forwardEquation=new l(e.chassisBody,e.groundBody),this.sideEquation=new l(e.chassisBody,e.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==f.sideFriction?f.sideFriction:5),this.localForwardVector=i.fromValues(0,1),f.localForwardVector&&i.copy(this.localForwardVector,f.localForwardVector),this.localPosition=i.create(),f.localPosition&&i.copy(this.localPosition,f.localPosition),t.call(this,e.chassisBody,e.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}var i=e("../math/vec2"),t=e("../constraints/Constraint"),l=e("../equations/FrictionEquation"),p=e("../objects/Body");f.exports=o,o.prototype.addToWorld=function(e){this.world=e,e.addBody(this.groundBody),e.on("preStep",this.preStepCallback);for(var f=0;f<this.wheels.length;f++){var n=this.wheels[f];e.addConstraint(n)}},o.prototype.removeFromWorld=function(){var e=this.world;e.removeBody(this.groundBody),e.off("preStep",this.preStepCallback);for(var f=0;f<this.wheels.length;f++){var n=this.wheels[f];e.removeConstraint(n)}this.world=null},o.prototype.addWheel=function(e){var f=new d(this,e);return this.wheels.push(f),f},o.prototype.update=function(){for(var e=0;e<this.wheels.length;e++)this.wheels[e].update()},d.prototype=new t,d.prototype.setBrakeForce=function(e){this.forwardEquation.setSlipForce(e)},d.prototype.setSideFriction=function(e){this.sideEquation.setSlipForce(e)};var u=i.create(),s=i.create();d.prototype.getSpeed=function(){var e=this.vehicle.chassisBody;return e.vectorToWorldFrame(s,this.localForwardVector),e.getVelocityAtPoint(u,s),i.dot(u,s)};var c=i.create();d.prototype.update=function(){var e=this.vehicle.chassisBody,f=this.forwardEquation,n=this.sideEquation,o=this.steerValue;e.vectorToWorldFrame(f.t,this.localForwardVector),i.rotate(n.t,this.localForwardVector,Math.PI/2),e.vectorToWorldFrame(n.t,n.t),i.rotate(f.t,f.t,o),i.rotate(n.t,n.t,o),e.toWorldFrame(f.contactPointB,this.localPosition),i.copy(n.contactPointB,f.contactPointB),e.vectorToWorldFrame(f.contactPointA,this.localPosition),i.copy(n.contactPointA,f.contactPointA),i.normalize(c,f.t),i.scale(c,c,this.engineForce),this.vehicle.chassisBody.applyForce(c,f.contactPointA)}},{"../constraints/Constraint":9,"../equations/FrictionEquation":18,"../math/vec2":25,"../objects/Body":26}],31:[function(e,f,n){f.exports={AABB:e("./collision/AABB"),AngleLockEquation:e("./equations/AngleLockEquation"),Body:e("./objects/Body"),Broadphase:e("./collision/Broadphase"),Capsule:e("./shapes/Capsule"),Circle:e("./shapes/Circle"),Constraint:e("./constraints/Constraint"),ContactEquation:e("./equations/ContactEquation"),ContactEquationPool:e("./utils/ContactEquationPool"),ContactMaterial:e("./material/ContactMaterial"),Convex:e("./shapes/Convex"),DistanceConstraint:e("./constraints/DistanceConstraint"),Equation:e("./equations/Equation"),EventEmitter:e("./events/EventEmitter"),FrictionEquation:e("./equations/FrictionEquation"),FrictionEquationPool:e("./utils/FrictionEquationPool"),GearConstraint:e("./constraints/GearConstraint"),GSSolver:e("./solver/GSSolver"),Heightfield:e("./shapes/Heightfield"),Line:e("./shapes/Line"),LockConstraint:e("./constraints/LockConstraint"),Material:e("./material/Material"),Narrowphase:e("./collision/Narrowphase"),NaiveBroadphase:e("./collision/NaiveBroadphase"),Particle:e("./shapes/Particle"),Plane:e("./shapes/Plane"),Pool:e("./utils/Pool"),RevoluteConstraint:e("./constraints/RevoluteConstraint"),PrismaticConstraint:e("./constraints/PrismaticConstraint"),Ray:e("./collision/Ray"),RaycastResult:e("./collision/RaycastResult"),Box:e("./shapes/Box"),RotationalVelocityEquation:e("./equations/RotationalVelocityEquation"),SAPBroadphase:e("./collision/SAPBroadphase"),Shape:e("./shapes/Shape"),Solver:e("./solver/Solver"),Spring:e("./objects/Spring"),TopDownVehicle:e("./objects/TopDownVehicle"),LinearSpring:e("./objects/LinearSpring"),RotationalSpring:e("./objects/RotationalSpring"),Utils:e("./utils/Utils"),World:e("./world/World"),vec2:e("./math/vec2"),version:"0.7.2"}},{"./collision/AABB":2,"./collision/Broadphase":3,"./collision/NaiveBroadphase":4,"./collision/Narrowphase":5,"./collision/Ray":6,"./collision/RaycastResult":7,"./collision/SAPBroadphase":8,"./constraints/Constraint":9,"./constraints/DistanceConstraint":10,"./constraints/GearConstraint":11,"./constraints/LockConstraint":12,"./constraints/PrismaticConstraint":13,"./constraints/RevoluteConstraint":14,"./equations/AngleLockEquation":15,"./equations/ContactEquation":16,"./equations/Equation":17,"./equations/FrictionEquation":18,"./equations/RotationalVelocityEquation":20,"./events/EventEmitter":21,"./material/ContactMaterial":22,"./material/Material":23,"./math/vec2":25,"./objects/Body":26,"./objects/LinearSpring":27,"./objects/RotationalSpring":28,"./objects/Spring":29,"./objects/TopDownVehicle":30,"./shapes/Box":32,"./shapes/Capsule":33,"./shapes/Circle":34,"./shapes/Convex":35,"./shapes/Heightfield":36,"./shapes/Line":37,"./shapes/Particle":38,"./shapes/Plane":39,"./shapes/Shape":40,"./solver/GSSolver":41,"./solver/Solver":42,"./utils/ContactEquationPool":43,"./utils/FrictionEquationPool":44,"./utils/Pool":48,"./utils/Utils":50,"./world/World":52}],32:[function(e,f,n){function o(e){e=e||{};var f=this.width=void 0!==e.width?e.width:1,n=this.height=void 0!==e.height?e.height:1,o=[d.fromValues(-f/2,-n/2),d.fromValues(f/2,-n/2),d.fromValues(f/2,n/2),d.fromValues(-f/2,n/2)],p=t(e);p.vertices=o,p.type=i.BOX,l.call(this,p)}var d=e("../math/vec2"),i=e("./Shape"),t=e("../utils/Utils").shallowClone,l=e("./Convex");f.exports=o,o.prototype=new l,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(){var e=this.width,f=this.height;return(f*f+e*e)/12},o.prototype.updateBoundingRadius=function(){var e=this.width,f=this.height;this.boundingRadius=Math.sqrt(e*e+f*f)/2},o.prototype.computeAABB=function(e,f,n){var o=Math.abs(Math.cos(n)),d=Math.abs(Math.sin(n)),i=this.width,t=this.height,l=.5*(i*d+t*o),p=.5*(t*d+i*o),u=e.lowerBound,s=e.upperBound,c=f[0],y=f[1];u[0]=c-p,u[1]=y-l,s[0]=c+p,s[1]=y+l},o.prototype.updateArea=function(){this.area=this.width*this.height},o.prototype.pointTest=function(e){return Math.abs(e[0])<=.5*this.width&&Math.abs(e[1])<=.5*this.height}},{"../math/vec2":25,"../utils/Utils":50,"./Convex":35,"./Shape":40}],33:[function(e,f,n){function o(e){e=e?i(e):{},this.length=void 0!==e.length?e.length:1,this.radius=void 0!==e.radius?e.radius:1,e.type=d.CAPSULE,d.call(this,e)}var d=e("./Shape"),i=e("../utils/Utils").shallowClone,t=e("../math/vec2");f.exports=o,o.prototype=new d,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(){function e(e,f){return e*f*(Math.pow(e,2)+Math.pow(f,2))/12}function f(e){return Math.PI*Math.pow(e,2)/2}function n(e){return(Math.PI/4-8/(9*Math.PI))*Math.pow(e,4)}function o(e){return 4*e/(3*Math.PI)}function d(e,f){return 2*e*f+Math.PI*Math.pow(f,2)}function i(d,i){var t=d/2+o(i);return e(d,2*i)+2*(n(i)+f(i)*Math.pow(t,2))}var t=this.radius,l=this.length,p=d(l,t);return p>0?i(l,t)/p:0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},o.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var l=t.create();o.prototype.computeAABB=function(e,f,n){var o=this.radius;t.set(l,this.length/2,0),0!==n&&t.rotate(l,l,n),t.set(e.upperBound,Math.max(l[0]+o,-l[0]+o),Math.max(l[1]+o,-l[1]+o)),t.set(e.lowerBound,Math.min(l[0]-o,-l[0]-o),Math.min(l[1]-o,-l[1]-o)),t.add(e.lowerBound,e.lowerBound,f),t.add(e.upperBound,e.upperBound,f)};var p=t.create(),u=t.create(),s=t.create(),c=t.create(),y=t.fromValues(0,1);o.prototype.raycast=function(e,f,n,o){for(var d=f.from,i=f.to,l=p,a=u,r=s,w=c,b=this.length/2,g=0;2>g;g++){var m=this.radius*(2*g-1);t.set(r,-b,m),t.set(w,b,m),t.toGlobalFrame(r,r,n,o),t.toGlobalFrame(w,w,n,o);var x=t.getLineSegmentsIntersectionFraction(d,i,r,w);if(x>=0&&(t.rotate(a,y,o),t.scale(a,a,2*g-1),f.reportIntersection(e,x,a,-1),e.shouldStop(f)))return}for(var j=Math.pow(this.radius,2)+Math.pow(b,2),g=0;2>g;g++){t.set(r,b*(2*g-1),0),t.toGlobalFrame(r,r,n,o);var v=Math.pow(i[0]-d[0],2)+Math.pow(i[1]-d[1],2),h=2*((i[0]-d[0])*(d[0]-r[0])+(i[1]-d[1])*(d[1]-r[1])),k=Math.pow(d[0]-r[0],2)+Math.pow(d[1]-r[1],2)-Math.pow(this.radius,2),x=Math.pow(h,2)-4*v*k;if(!(0>x))if(0===x){if(t.lerp(l,d,i,x),t.squaredDistance(l,n)>j&&(t.subtract(a,l,r),t.normalize(a,a),f.reportIntersection(e,x,a,-1),e.shouldStop(f)))return}else{var q=Math.sqrt(x),z=1/(2*v),A=(-h-q)*z,B=(-h+q)*z;if(A>=0&&1>=A&&(t.lerp(l,d,i,A),t.squaredDistance(l,n)>j&&(t.subtract(a,l,r),t.normalize(a,a),f.reportIntersection(e,A,a,-1),e.shouldStop(f))))return;if(B>=0&&1>=B&&(t.lerp(l,d,i,B),t.squaredDistance(l,n)>j&&(t.subtract(a,l,r),t.normalize(a,a),f.reportIntersection(e,B,a,-1),e.shouldStop(f))))return}}},o.prototype.pointTest=function(e){var f=this.radius,n=.5*this.length;return Math.abs(e[0])<=n&&Math.abs(e[1])<=f?!0:Math.pow(e[0]-n,2)+Math.pow(e[1],2)<=f*f?!0:Math.pow(e[0]+n,2)+Math.pow(e[1],2)<=f*f?!0:!1}},{"../math/vec2":25,"../utils/Utils":50,"./Shape":40}],34:[function(e,f,n){function o(e){e=e?t(e):{},this.radius=void 0!==e.radius?e.radius:1,e.type=d.CIRCLE,d.call(this,e)}var d=e("./Shape"),i=e("../math/vec2"),t=e("../utils/Utils").shallowClone;f.exports=o,o.prototype=new d,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(){var e=this.radius;return e*e/2},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},o.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},o.prototype.computeAABB=function(e,f){var n=this.radius;i.set(e.upperBound,n,n),i.set(e.lowerBound,-n,-n),f&&(i.add(e.lowerBound,e.lowerBound,f),i.add(e.upperBound,e.upperBound,f))};var l=i.create(),p=i.create();o.prototype.raycast=function(e,f,n){var o=f.from,d=f.to,t=this.radius,u=Math.pow(d[0]-o[0],2)+Math.pow(d[1]-o[1],2),s=2*((d[0]-o[0])*(o[0]-n[0])+(d[1]-o[1])*(o[1]-n[1])),c=Math.pow(o[0]-n[0],2)+Math.pow(o[1]-n[1],2)-Math.pow(t,2),y=Math.pow(s,2)-4*u*c,a=l,r=p;if(!(0>y))if(0===y)i.lerp(a,o,d,y),i.subtract(r,a,n),i.normalize(r,r),f.reportIntersection(e,y,r,-1);else{var w=Math.sqrt(y),b=1/(2*u),g=(-s-w)*b,m=(-s+w)*b;if(g>=0&&1>=g&&(i.lerp(a,o,d,g),i.subtract(r,a,n),i.normalize(r,r),f.reportIntersection(e,g,r,-1),e.shouldStop(f)))return;m>=0&&1>=m&&(i.lerp(a,o,d,m),i.subtract(r,a,n),i.normalize(r,r),f.reportIntersection(e,m,r,-1))}},o.prototype.pointTest=function(e){var f=this.radius;return i.squaredLength(e)<=f*f}},{"../math/vec2":25,"../utils/Utils":50,"./Shape":40}],35:[function(e,f,n){function o(e){e=e?u(e):{},this.vertices=[];for(var f=void 0!==e.vertices?e.vertices:[],n=0;n<f.length;n++)this.vertices.push(t.clone(f[n]));for(var o=this.normals=[],n=0;n<f.length;n++)o.push(t.create());if(this.updateNormals(),this.centerOfMass=t.create(),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,e.type=e.type||i.CONVEX,i.call(this,e),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in counter-clockwise winding.")}function d(e,f,n){return.5*((f[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(f[1]-e[1]))}var i=e("./Shape"),t=e("../math/vec2"),l=t.dot,p=e("../math/polyk"),u=e("../utils/Utils").shallowClone;f.exports=o,o.prototype=new i,o.prototype.constructor=o;var s=t.create(),c=t.create();o.prototype.updateNormals=function(){for(var e=this.vertices,f=this.normals,n=0;n<e.length;n++){var o=e[n],d=e[(n+1)%e.length],i=f[n];t.subtract(i,d,o),t.rotate90cw(i,i),t.normalize(i,i)}},o.prototype.projectOntoLocalAxis=function(e,f){for(var n,o,d=null,i=null,e=s,p=0;p<this.vertices.length;p++)n=this.vertices[p],o=l(n,e),(null===d||o>d)&&(d=o),(null===i||i>o)&&(i=o);if(i>d){var u=i;i=d,d=u}t.set(f,i,d)},o.prototype.projectOntoWorldAxis=function(e,f,n,o){var d=c;this.projectOntoLocalAxis(e,o),0!==n?t.rotate(d,e,n):d=e;var i=l(f,d);t.set(o,o[0]+i,o[1]+i)},o.prototype.updateTriangles=function(){this.triangles.length=0;for(var e=[],f=0;f<this.vertices.length;f++){var n=this.vertices[f];e.push(n[0],n[1])}for(var o=p.Triangulate(e),f=0;f<o.length;f+=3){var d=o[f],i=o[f+1],t=o[f+2];this.triangles.push([d,i,t])}};var y=t.create(),a=t.create(),r=t.create(),w=t.create(),b=t.create();o.prototype.updateCenterOfMass=function(){var e=this.triangles,f=this.vertices,n=this.centerOfMass,o=y,i=r,l=w,p=b,u=a;t.set(n,0,0);for(var s=0,c=0;c!==e.length;c++){var g=e[c],i=f[g[0]],l=f[g[1]],p=f[g[2]];t.centroid(o,i,l,p);var m=d(i,l,p);s+=m,t.scale(u,o,m),t.add(n,n,u)}t.scale(n,n,1/s)},o.prototype.computeMomentOfInertia=function(){for(var e=0,f=0,n=this.vertices.length,o=n-1,d=0;n>d;o=d,d++){var i=this.vertices[o],p=this.vertices[d],u=Math.abs(t.crossLength(i,p)),s=l(p,p)+l(p,i)+l(i,i);e+=u*s,f+=u}return 1/6*(e/f)},o.prototype.updateBoundingRadius=function(){for(var e=this.vertices,f=0,n=0;n!==e.length;n++){var o=t.squaredLength(e[n]);o>f&&(f=o)}this.boundingRadius=Math.sqrt(f)},o.triangleArea=d,o.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var e=this.triangles,f=this.vertices,n=0;n!==e.length;n++){var o=e[n],i=f[o[0]],t=f[o[1]],l=f[o[2]],p=d(i,t,l);this.area+=p}},o.prototype.computeAABB=function(e,f,n){e.setFromPoints(this.vertices,f,n,0)};var g=t.create(),m=t.create(),x=t.create();o.prototype.raycast=function(e,f,n,o){var d=g,i=m,l=x,p=this.vertices;t.toLocalFrame(d,f.from,n,o),t.toLocalFrame(i,f.to,n,o);for(var u=p.length,s=0;u>s&&!e.shouldStop(f);s++){var c=p[s],y=p[(s+1)%u],a=t.getLineSegmentsIntersectionFraction(d,i,c,y);a>=0&&(t.subtract(l,y,c),t.rotate(l,l,-Math.PI/2+o),t.normalize(l,l),f.reportIntersection(e,a,l,s))}};var j=t.create(),v=t.create();o.prototype.pointTest=function(e){for(var f=j,n=v,o=this.vertices,d=null,i=o.length,l=0;i+1>l;l++){var p=o[l%i],u=o[(l+1)%i];t.subtract(f,p,e),t.subtract(n,u,e);var s=t.crossLength(f,n);if(null===d&&(d=s),0>s*d)return!1;d=s}return!0}},{"../math/polyk":24,"../math/vec2":25,"../utils/Utils":50,"./Shape":40}],36:[function(e,f,n){function o(e){e=e?t(e):{},this.heights=e.heights?e.heights.slice(0):[],this.maxValue=e.maxValue||null,this.minValue=e.minValue||null,this.elementWidth=void 0!==e.elementWidth?e.elementWidth:.1,(void 0===e.maxValue||void 0===e.minValue)&&this.updateMaxMinValues(),e.type=d.HEIGHTFIELD,d.call(this,e)}var d=e("./Shape"),i=e("../math/vec2"),t=e("../utils/Utils").shallowClone;f.exports=o,o.prototype=new d,o.prototype.constructor=o,o.prototype.updateMaxMinValues=function(){for(var e=this.heights,f=e[0],n=e[0],o=0;o!==e.length;o++){var d=e[o];d>f&&(f=d),n>d&&(n=d)}this.maxValue=f,this.minValue=n},o.prototype.computeMomentOfInertia=function(){return Number.MAX_VALUE},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.updateArea=function(){for(var e=this.heights,f=0,n=0;n<e.length-1;n++)f+=(e[n]+e[n+1])/2*this.elementWidth;this.area=f};var l=[i.create(),i.create(),i.create(),i.create()];o.prototype.computeAABB=function(e,f,n){i.set(l[0],0,this.maxValue),i.set(l[1],this.elementWidth*this.heights.length,this.maxValue),i.set(l[2],this.elementWidth*this.heights.length,this.minValue),i.set(l[3],0,this.minValue),e.setFromPoints(l,f,n)},o.prototype.getLineSegment=function(e,f,n){var o=this.heights,d=this.elementWidth;i.set(e,n*d,o[n]),i.set(f,(n+1)*d,o[n+1])},o.prototype.getSegmentIndex=function(e){return Math.floor(e[0]/this.elementWidth)},o.prototype.getClampedSegmentIndex=function(e){var f=this.getSegmentIndex(e);return f=Math.min(this.heights.length,Math.max(f,0))};var p=i.create(),u=i.create(),s=i.create(),c=i.create(),y=i.create();o.prototype.raycast=function(e,f,n,o){var d=f.from,t=f.to,l=p,a=u,r=s,w=c,b=y;i.toLocalFrame(w,d,n,o),i.toLocalFrame(b,t,n,o);var g=this.getClampedSegmentIndex(w),m=this.getClampedSegmentIndex(b);if(g>m){var x=g;g=m,m=x}for(var j=0;j<this.heights.length-1;j++){this.getLineSegment(a,r,j);var v=i.getLineSegmentsIntersectionFraction(w,b,a,r);if(v>=0&&(i.subtract(l,r,a),i.rotate(l,l,o+Math.PI/2),i.normalize(l,l),f.reportIntersection(e,v,l,-1),e.shouldStop(f)))return}}},{"../math/vec2":25,"../utils/Utils":50,"./Shape":40}],37:[function(e,f,n){function o(e){e=e?i(e):{},this.length=void 0!==e.length?e.length:1,e.type=d.LINE,d.call(this,e)}var d=e("./Shape"),i=e("../utils/Utils").shallowClone,t=e("../math/vec2");f.exports=o,o.prototype=new d,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(){return Math.pow(this.length,2)/12},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var l=[t.create(),t.create()];o.prototype.computeAABB=function(e,f,n){var o=this.length/2;t.set(l[0],-o,0),t.set(l[1],o,0),e.setFromPoints(l,f,n,0)};var p=t.create(),u=t.create(),s=t.create(),c=t.fromValues(0,1);o.prototype.raycast=function(e,f,n,o){var d=f.from,i=f.to,l=u,y=s,a=this.length/2;t.set(l,-a,0),t.set(y,a,0),t.toGlobalFrame(l,l,n,o),t.toGlobalFrame(y,y,n,o);var r=t.getLineSegmentsIntersectionFraction(l,y,d,i);if(r>=0){var w=p;t.rotate(w,c,o),f.reportIntersection(e,r,w,-1)}}},{"../math/vec2":25,"../utils/Utils":50,"./Shape":40}],38:[function(e,f,n){function o(e){e=e?i(e):{},e.type=d.PARTICLE,d.call(this,e)}var d=e("./Shape"),i=e("../utils/Utils").shallowClone,t=e("../math/vec2").copy;f.exports=o,o.prototype=new d,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(){return 0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=0},o.prototype.computeAABB=function(e,f){t(e.lowerBound,f),t(e.upperBound,f)}},{"../math/vec2":25,"../utils/Utils":50,"./Shape":40}],39:[function(e,f,n){function o(e){e=e?t.shallowClone(e):{},e.type=d.PLANE,d.call(this,e)}var d=e("./Shape"),i=e("../math/vec2"),t=e("../utils/Utils");f.exports=o,o.prototype=new d,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(){return 0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.computeAABB=function(e,f,n){var o=n%(2*Math.PI),d=i.set,t=1e7,l=e.lowerBound,p=e.upperBound;d(l,-t,-t),d(p,t,t),0===o?p[1]=f[1]:o===Math.PI/2?l[0]=f[0]:o===Math.PI?l[1]=f[1]:o===3*Math.PI/2&&(p[0]=f[0])},o.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var l=i.create(),p=i.create(),u=i.create();o.prototype.raycast=function(e,f,n,o){var d=f.from,t=f.to,s=f.direction,c=l,y=p,a=u;i.set(y,0,1),i.rotate(y,y,o),i.subtract(a,d,n);var r=i.dot(a,y);i.subtract(a,t,n);var w=i.dot(a,y);if(!(r*w>0||i.squaredDistance(d,t)<r*r)){var b=i.dot(y,s);i.subtract(c,d,n);var g=-i.dot(y,c)/b/f.length;f.reportIntersection(e,g,y,-1)}},o.prototype.pointTest=function(e){return e[1]<=0}},{"../math/vec2":25,"../utils/Utils":50,"./Shape":40}],40:[function(e,f,n){function o(e){e=e||{},this.body=null,this.position=d.create(),e.position&&d.copy(this.position,e.position),this.angle=e.angle||0,this.type=e.type||0,this.id=o.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==e.collisionGroup?e.collisionGroup:1,this.collisionResponse=void 0!==e.collisionResponse?e.collisionResponse:!0,this.collisionMask=void 0!==e.collisionMask?e.collisionMask:1,this.material=e.material||null,this.area=0,this.sensor=void 0!==e.sensor?e.sensor:!1,this.type&&this.updateBoundingRadius(),this.updateArea()}f.exports=o;var d=e("../math/vec2");o.idCounter=0,o.CIRCLE=1,o.PARTICLE=2,o.PLANE=4,o.CONVEX=8,o.LINE=16,o.BOX=32,o.CAPSULE=64,o.HEIGHTFIELD=128,o.prototype={computeMomentOfInertia:function(){},updateBoundingRadius:function(){},updateArea:function(){},computeAABB:function(){},raycast:function(){},pointTest:function(){return!1},worldPointToLocal:function(){var e=d.create();return function(f,n){var o=this.body;d.rotate(e,this.position,o.angle),d.add(e,e,o.position),d.toLocalFrame(f,n,e,this.body.angle+this.angle)}}()}},{"../math/vec2":25}],41:[function(e,f,n){function o(e){t.call(this,e,t.GS),e=e||{},this.iterations=e.iterations||10,this.tolerance=void 0!==e.tolerance?e.tolerance:1e-7,this.frictionIterations=void 0!==e.frictionIterations?0:e.frictionIterations,this.usedIterations=0}function d(e,f){for(var n=e.length;n--;){var o=e[n];o.multiplier=o.lambda*f}}function i(e){var f=e.B,n=e.epsilon,o=e.invC,d=e.lambda,i=e.computeGWlambda(),t=e.maxForceDt,l=e.minForceDt,p=o*(f-i-n*d),u=d+p;return l>u?p=l-d:u>t&&(p=t-d),e.lambda+=p,e.addToWlambda(p),p}var t=e("./Solver"),l=e("../equations/FrictionEquation");f.exports=o,o.prototype=new t,o.prototype.constructor=o,o.prototype.solve=function(e,f){this.sortEquations();var n=0,o=this.iterations,t=this.frictionIterations,p=this.equations,u=p.length,s=Math.pow(this.tolerance*u,2),c=f.bodies,y=c.length;if(this.usedIterations=0,u)for(var a=0;a!==y;a++){var r=c[a];r.updateSolveMassProperties()}for(var a=0;a!==u;a++){var w=p[a];w.lambda=0,(w.timeStep!==e||w.needsUpdate)&&(w.timeStep=e,w.update()),w.B=w.computeB(w.a,w.b,e),w.invC=w.computeInvC(w.epsilon),w.maxForceDt=w.maxForce*e,w.minForceDt=w.minForce*e}var w,b,a,g;if(0!==u){for(a=0;a!==y;a++){var r=c[a];r.resetConstraintVelocity()}if(t){for(n=0;n!==t;n++){for(b=0,g=0;g!==u;g++){w=p[g];var m=i(w,e);b+=Math.abs(m)}if(this.usedIterations++,s>=b*b)break}for(d(p,1/e),g=0;g!==u;g++){var x=p[g];if(x instanceof l){for(var j=0,v=0;v!==x.contactEquations.length;v++)j+=x.contactEquations[v].multiplier;j*=x.frictionCoefficient/x.contactEquations.length,x.maxForce=j,x.minForce=-j,x.maxForceDt=j*e,x.minForceDt=-j*e}}}for(n=0;n!==o;n++){for(b=0,g=0;g!==u;g++){w=p[g];var m=i(w,e);b+=Math.abs(m)}if(this.usedIterations++,s>b*b)break}for(a=0;a!==y;a++)c[a].addConstraintVelocity();d(p,1/e)}}},{"../equations/FrictionEquation":18,"./Solver":42}],42:[function(e,f,n){function o(e,f){e=e||{},d.call(this),this.type=f,this.equations=[],this.equationSortFunction=e.equationSortFunction||!1}var d=e("../events/EventEmitter");f.exports=o,o.prototype=new d,o.prototype.constructor=o,o.prototype.solve=function(){throw new Error("Solver.solve should be implemented by subclasses!")},o.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},o.prototype.addEquation=function(e){e.enabled&&this.equations.push(e)},o.prototype.addEquations=function(e){for(var f=0,n=e.length;f!==n;f++){var o=e[f];o.enabled&&this.equations.push(o)}},o.prototype.removeEquation=function(e){var f=this.equations.indexOf(e);-1!==f&&this.equations.splice(f,1)},o.prototype.removeAllEquations=function(){this.equations.length=0},o.GS=1},{"../events/EventEmitter":21}],43:[function(e,f,n){function o(){i.apply(this,arguments)}var d=e("../equations/ContactEquation"),i=e("./Pool");f.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.create=function(){return new d},o.prototype.destroy=function(e){return e.bodyA=e.bodyB=null,this}},{"../equations/ContactEquation":16,"./Pool":48}],44:[function(e,f,n){function o(){i.apply(this,arguments)}var d=e("../equations/FrictionEquation"),i=e("./Pool");f.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.create=function(){return new d},o.prototype.destroy=function(e){return e.bodyA=e.bodyB=null,this}},{"../equations/FrictionEquation":18,"./Pool":48}],45:[function(e,f,n){function o(){this.overlappingShapesLastState=new d,this.overlappingShapesCurrentState=new d,this.recordPool=new i({size:16}),this.tmpDict=new d,this.tmpArray1=[]}var d=e("./TupleDictionary"),i=e("./OverlapKeeperRecordPool");f.exports=o,o.prototype.tick=function(){for(var e=this.overlappingShapesLastState,f=this.overlappingShapesCurrentState,n=e.keys.length;n--;){var o=e.keys[n],d=e.getByKey(o);d&&this.recordPool.release(d)}e.reset(),e.copy(f),f.reset()},o.prototype.setOverlapping=function(e,f,n,o){var d=this.overlappingShapesCurrentState;if(!d.get(f.id,o.id)){var i=this.recordPool.get();i.set(e,f,n,o),d.set(f.id,o.id,i)}},o.prototype.getNewOverlaps=function(e){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,e)},o.prototype.getEndOverlaps=function(e){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,e)},o.prototype.bodiesAreOverlapping=function(e,f){for(var n=this.overlappingShapesCurrentState,o=n.keys.length;o--;){var d=n.keys[o],i=n.data[d];if(i.bodyA===e&&i.bodyB===f||i.bodyA===f&&i.bodyB===e)return!0}return!1},o.prototype.getDiff=function(e,f,n){var n=n||[],o=e,d=f;n.length=0;for(var i=d.keys.length;i--;){var t=d.keys[i],l=d.data[t];if(!l)throw new Error("Key "+t+" had no data!");var p=o.data[t];p||n.push(l)}return n},o.prototype.isNewOverlap=function(e,f){var n=0|e.id,o=0|f.id,d=this.overlappingShapesLastState,i=this.overlappingShapesCurrentState;return!d.get(n,o)&&!!i.get(n,o)},o.prototype.getNewBodyOverlaps=function(e){this.tmpArray1.length=0;var f=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(f,e)},o.prototype.getEndBodyOverlaps=function(e){this.tmpArray1.length=0;var f=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(f,e)},o.prototype.getBodyDiff=function(e,f){f=f||[];for(var n=this.tmpDict,o=e.length;o--;){var d=e[o];n.set(0|d.bodyA.id,0|d.bodyB.id,d)}for(o=n.keys.length;o--;){var d=n.getByKey(n.keys[o]);d&&f.push(d.bodyA,d.bodyB)}return n.reset(),f}},{"./OverlapKeeperRecordPool":47,"./TupleDictionary":49}],46:[function(e,f,n){function o(e,f,n,o){this.shapeA=f,this.shapeB=o,this.bodyA=e,this.bodyB=n}f.exports=o,o.prototype.set=function(e,f,n,d){o.call(this,e,f,n,d)}},{}],47:[function(e,f,n){function o(){i.apply(this,arguments)}var d=e("./OverlapKeeperRecord"),i=e("./Pool");f.exports=o,o.prototype=new i,o.prototype.constructor=o,o.prototype.create=function(){return new d},o.prototype.destroy=function(e){return e.bodyA=e.bodyB=e.shapeA=e.shapeB=null,this}},{"./OverlapKeeperRecord":46,"./Pool":48}],48:[function(e,f,n){function o(e){e=e||{},this.objects=[],void 0!==e.size&&this.resize(e.size)}f.exports=o,o.prototype.resize=function(e){for(var f=this.objects;f.length>e;)f.pop();for(;f.length<e;)f.push(this.create());return this},o.prototype.get=function(){var e=this.objects;return e.length?e.pop():this.create()},o.prototype.release=function(e){return this.destroy(e),this.objects.push(e),this}},{}],49:[function(e,f,n){function o(){this.data={},this.keys=[]}var d=e("./Utils");f.exports=o,o.prototype.getKey=function(e,f){return e=0|e,f=0|f,(0|e)===(0|f)?-1:0|((0|e)>(0|f)?e<<16|65535&f:f<<16|65535&e)},o.prototype.getByKey=function(e){return e=0|e,this.data[e]},o.prototype.get=function(e,f){return this.data[this.getKey(e,f)]},o.prototype.set=function(e,f,n){if(!n)throw new Error("No data!");var o=this.getKey(e,f);return this.data[o]||this.keys.push(o),this.data[o]=n,o},o.prototype.reset=function(){
for(var e=this.data,f=this.keys,n=f.length;n--;)delete e[f[n]];f.length=0},o.prototype.copy=function(e){this.reset(),d.appendArray(this.keys,e.keys);for(var f=e.keys.length;f--;){var n=e.keys[f];this.data[n]=e.data[n]}}},{"./Utils":50}],50:[function(e,f,n){function o(){}f.exports=o,o.appendArray=function(e,f){if(f.length<15e4)e.push.apply(e,f);else for(var n=0,o=f.length;n!==o;++n)e.push(f[n])},o.splice=function(e,f,n){n=n||1;for(var o=f,d=e.length-n;d>o;o++)e[o]=e[o+n];e.length=d},o.arrayRemove=function(e,f){var n=e.indexOf(f);-1!==n&&o.splice(e,n,1)},"undefined"!=typeof P2_ARRAY_TYPE?o.ARRAY_TYPE=P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?o.ARRAY_TYPE=Float32Array:o.ARRAY_TYPE=Array,o.extend=function(e,f){for(var n in f)e[n]=f[n]},o.shallowClone=function(e){var f={};return o.extend(f,e),f},o.defaults=function(e,f){console.warn("Utils.defaults is deprecated."),e=e||{};for(var n in f)n in e||(e[n]=f[n]);return e}},{}],51:[function(e,f,n){function o(e){this.id=[],this.sz=[],this.size=e,this.count=e,this.resize(e)}f.exports=o,o.prototype={resize:function(e){this.count=this.size=e;for(var f=this.sz,n=this.id,o=0;e>o;o++)n[o]=o,f[o]=1},find:function(e){for(var f=this.id;e!==f[e];)f[e]=f[f[e]],e=f[e];return e},union:function(e,f){var n=this.find(e),o=this.find(f);if(n!==o){var d=this.sz,i=this.id;d[n]<d[o]?(i[n]=o,d[o]+=d[n]):(i[o]=n,d[n]+=d[o]),this.count--}}}},{}],52:[function(e,f,n){function o(e){c.apply(this),e=e||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=e.solver||new p,this.narrowphase=new g,this.gravity=u.fromValues(0,-9.78),e.gravity&&u.copy(this.gravity,e.gravity),this.frictionGravity=u.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=e.broadphase||new b,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new a,this.defaultContactMaterial=new r(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.islandSplit=void 0!==e.islandSplit?!!e.islandSplit:!0,this.emitImpactEvent=!0,this.sleepMode=o.NO_SLEEPING,this.unionFind=new v(1),this._constraintIdCounter=0,this._bodyIdCounter=0,this.overlapKeeper=new j}function d(e,f){return e.islandId-f.islandId}function i(e,f){var n=e.bodyA.islandId>0?e.bodyA.islandId:e.bodyB.islandId,o=f.bodyA.islandId>0?f.bodyA.islandId:f.bodyB.islandId;return n!==o?n-o:e.index-f.index}function t(e,f,n,o,d,i,t,l,p,s,c,a){if(0!==(o.collisionGroup&l.collisionMask)&&0!==(l.collisionGroup&o.collisionMask)&&(u.toGlobalFrame(G,d,n.position,n.angle),u.toGlobalFrame(H,p,t.position,t.angle),!(u.distance(G,H)>o.boundingRadius+l.boundingRadius))){var r=i+n.angle,w=s+t.angle;f.enableFriction=c.friction>0;var b;b=n.type===y.STATIC||n.type===y.KINEMATIC?t.mass:t.type===y.STATIC||t.type===y.KINEMATIC?n.mass:n.mass*t.mass/(n.mass+t.mass),f.slipForce=c.friction*a*b,f.currentContactMaterial=c,f.enabledEquations=n.collisionResponse&&t.collisionResponse&&o.collisionResponse&&l.collisionResponse;var g=f[o.type|l.type],m=0;if(g){var x=o.sensor||l.sensor,j=f.frictionEquations.length;m=o.type<l.type?g.call(f,n,o,G,r,t,l,H,w,x):g.call(f,t,l,H,w,n,o,G,r,x);var v=f.frictionEquations.length-j;if(m){if(n.allowSleep&&n.type===y.DYNAMIC&&n.sleepState===y.SLEEPING&&t.sleepState===y.AWAKE&&t.type!==y.STATIC){var h=u.squaredLength(t.velocity)+Math.pow(t.angularVelocity,2),k=Math.pow(t.sleepSpeedLimit,2);h>=2*k&&(n._wakeUpAfterNarrowphase=!0)}if(t.allowSleep&&t.type===y.DYNAMIC&&t.sleepState===y.SLEEPING&&n.sleepState===y.AWAKE&&n.type!==y.STATIC){var q=u.squaredLength(n.velocity)+Math.pow(n.angularVelocity,2),z=Math.pow(n.sleepSpeedLimit,2);q>=2*z&&(t._wakeUpAfterNarrowphase=!0)}if(e.overlapKeeper.setOverlapping(n,o,t,l),e.has("beginContact")&&e.overlapKeeper.isNewOverlap(o,l)){var A=C;if(A.shapeA=o,A.shapeB=l,A.bodyA=n,A.bodyB=t,A.contactEquations.length=0,!x)for(var B=f.contactEquations.length-m;B<f.contactEquations.length;B++)A.contactEquations.push(f.contactEquations[B]);e.emit(A)}if(!x&&v>1)for(var B=f.frictionEquations.length-v;B<f.frictionEquations.length;B++){var D=f.frictionEquations[B];D.setSlipForce(D.getSlipForce()/v)}}}}}function l(e,f){for(var n=e.constraints,o=0;o!==n.length;o++)for(var d=n[o],i=d.equations,t=0;t!==i.length;t++){var l=i[t];l.relaxation=void 0!==f.relaxation?f.relaxation:l.relaxation,l.stiffness=void 0!==f.stiffness?f.stiffness:l.stiffness,l.needsUpdate=!0}}var p=e("../solver/GSSolver"),u=e("../math/vec2"),s=e("../shapes/Shape"),c=e("../events/EventEmitter"),y=e("../objects/Body"),a=e("../material/Material"),r=e("../material/ContactMaterial"),w=e("../collision/AABB"),b=e("../collision/SAPBroadphase"),g=e("../collision/Narrowphase"),m=e("../utils/Utils"),x=m.arrayRemove,j=e("../utils/OverlapKeeper"),v=e("./UnionFind");f.exports=o,o.prototype=new Object(c.prototype),o.prototype.constructor=o;var h={type:"postStep"},k={type:"addBody",body:null},q={type:"removeBody",body:null},z={type:"addSpring",spring:null},A={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},B={type:"postBroadphase",pairs:null},C={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},D={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},E={type:"preSolve",contactEquations:null,frictionEquations:null};o.NO_SLEEPING=1,o.BODY_SLEEPING=2,o.ISLAND_SLEEPING=4,o.prototype.addConstraint=function(e){if(this.stepping)throw new Error("Constraints cannot be added during step.");var f=this.bodies;if(-1===f.indexOf(e.bodyA))throw new Error("Cannot add Constraint: bodyA is not added to the World.");if(-1===f.indexOf(e.bodyB))throw new Error("Cannot add Constraint: bodyB is not added to the World.");this.constraints.push(e)},o.prototype.addContactMaterial=function(e){this.contactMaterials.push(e)},o.prototype.removeContactMaterial=function(e){x(this.contactMaterials,e)},o.prototype.getContactMaterial=function(e,f){for(var n=this.contactMaterials,o=0,d=n.length;o!==d;o++){var i=n[o];if(i.materialA===e&&i.materialB===f||i.materialA===f&&i.materialB===e)return i}return!1},o.prototype.removeConstraint=function(e){if(this.stepping)throw new Error("Constraints cannot be removed during step.");x(this.constraints,e)};var F=u.create(),G=u.create(),H=u.create();o.prototype.step=function(e,f,n){if(n=n||10,f=f||0,0===f)this.internalStep(e),this.time+=e;else{this.accumulator+=f;for(var o=0;this.accumulator>=e&&n>o;)this.internalStep(e),this.time+=e,this.accumulator-=e,o++;for(var d=this.accumulator%e/e,i=0;i!==this.bodies.length;i++){var t=this.bodies[i];u.lerp(t.interpolatedPosition,t.previousPosition,t.position,d),t.interpolatedAngle=t.previousAngle+d*(t.angle-t.previousAngle)}}};var I=[];o.prototype.internalStep=function(e){this.stepping=!0;var f=this.springs.length,n=this.springs,l=this.bodies,p=this.gravity,s=this.solver,c=this.bodies.length,a=this.broadphase,r=this.narrowphase,w=this.constraints,b=F,g=u.add;if(this.overlapKeeper.tick(),this.lastTimeStep=e,this.useWorldGravityAsFrictionGravity){var x=u.length(this.gravity);0===x&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=x)}if(this.applyGravity)for(var j=0;j!==c;j++){var v=l[j],k=v.force;v.type===y.DYNAMIC&&v.sleepState!==y.SLEEPING&&(u.scale(b,p,v.mass*v.gravityScale),g(k,k,b))}if(this.applySpringForces)for(var j=0;j!==f;j++){var q=n[j];q.applyForce()}if(this.applyDamping)for(var j=0;j!==c;j++){var v=l[j];v.type===y.DYNAMIC&&v.applyDamping(e)}for(var z=a.getCollisionPairs(this),C=this.disabledBodyCollisionPairs,j=C.length-2;j>=0;j-=2)for(var G=z.length-2;G>=0;G-=2)(C[j]===z[G]&&C[j+1]===z[G+1]||C[j+1]===z[G]&&C[j]===z[G+1])&&z.splice(G,2);var H=w.length;for(j=0;j!==H;j++){var J=w[j];if(!J.collideConnected)for(var G=z.length-2;G>=0;G-=2)(J.bodyA===z[G]&&J.bodyB===z[G+1]||J.bodyB===z[G]&&J.bodyA===z[G+1])&&z.splice(G,2)}B.pairs=z,this.emit(B),B.pairs=null,r.reset();for(var K=this.defaultContactMaterial,L=this.frictionGravity,j=0,M=z.length;j!==M;j+=2)for(var N=z[j],O=z[j+1],P=0,Q=N.shapes.length;P!==Q;P++)for(var R=N.shapes[P],S=R.position,T=R.angle,U=0,V=O.shapes.length;U!==V;U++){var W=O.shapes[U],X=W.position,Y=W.angle,Z=null;R.material&&W.material&&(Z=this.getContactMaterial(R.material,W.material)),t(this,r,N,R,S,T,O,W,X,Y,Z||K,L)}for(var j=0;j!==c;j++){var $=l[j];$._wakeUpAfterNarrowphase&&($.wakeUp(),$._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(I);for(var _=D,U=I.length;U--;){var ee=I[U];_.shapeA=ee.shapeA,_.shapeB=ee.shapeB,_.bodyA=ee.bodyA,_.bodyB=ee.bodyB,this.emit(_)}I.length=0}E.contactEquations=r.contactEquations,E.frictionEquations=r.frictionEquations,this.emit(E),E.contactEquations=E.frictionEquations=null;var H=w.length;for(j=0;j!==H;j++)w[j].update();if(r.contactEquations.length||r.frictionEquations.length||H){var fe=[];for(m.appendArray(fe,r.contactEquations),m.appendArray(fe,r.frictionEquations),j=0;j!==H;j++)m.appendArray(fe,w[j].equations);if(this.islandSplit){var ne=this.unionFind;ne.resize(this.bodies.length+1);for(var j=0;j<fe.length;j++)fe[j].index=j;for(var j=0;j<fe.length;j++){var oe=fe[j].bodyA,de=fe[j].bodyB;oe.type===y.DYNAMIC&&de.type===y.DYNAMIC&&ne.union(oe.index,de.index)}for(var j=0;j<l.length;j++){var $=l[j];$.islandId=$.type===y.DYNAMIC?ne.find($.index):-1}fe=fe.sort(i);for(var ie=0;ie<fe.length;){var te=fe[ie++];s.addEquation(te);var le=te.bodyA.islandId>0?te.bodyA.islandId:te.bodyB.islandId,pe=-1;fe[ie]&&(pe=fe[ie].bodyA.islandId>0?fe[ie].bodyA.islandId:fe[ie].bodyB.islandId),(pe!==le||ie===fe.length)&&(this.solveConstraints&&s.solve(e,this),s.removeAllEquations())}}else s.addEquations(fe),this.solveConstraints&&s.solve(e,this),s.removeAllEquations()}for(var j=0;j!==c;j++){var $=l[j];($.type===y.DYNAMIC||$.type===y.KINEMATIC)&&$.integrate(e)}for(var j=0;j!==c;j++)l[j].setZeroForce();if(this.emitImpactEvent&&this.has("impact"))for(var ue=A,j=0;j!==r.contactEquations.length;j++){var se=r.contactEquations[j];se.firstImpact&&(ue.bodyA=se.bodyA,ue.bodyB=se.bodyB,ue.shapeA=se.shapeA,ue.shapeB=se.shapeB,ue.contactEquation=se,this.emit(ue))}if(this.sleepMode===o.BODY_SLEEPING)for(j=0;j!==c;j++)l[j].sleepTick(this.time,!1,e);else if(this.sleepMode===o.ISLAND_SLEEPING&&this.islandSplit){for(j=0;j!==c;j++)l[j].sleepTick(this.time,!0,e);for(var ce=l.sort(d),ye=1,ae=0;ae<ce.length;ae=ye){var re=ce[ae].islandId;for(ye=ae+1;ye<ce.length&&ce[ye].islandId===re;ye++);if(-1!==re){for(var we=!0,j=ae;ye>j;j++)if(!ce[j].wantsToSleep){we=!1;break}if(we)for(var j=ae;ye>j;j++)ce[j].sleep()}}}this.stepping=!1,this.emit(h)},o.prototype.addSpring=function(e){if(this.stepping)throw new Error("Springs cannot be added during step.");this.springs.push(e),z.spring=e,this.emit(z),z.spring=null},o.prototype.removeSpring=function(e){if(this.stepping)throw new Error("Springs cannot be removed during step.");x(this.springs,e)},o.prototype.addBody=function(e){if(this.stepping)throw new Error("Bodies cannot be added during step.");if(e.world)throw new Error("Body is already added to a World.");e.index=this.bodies.length,this.bodies.push(e),e.world=this,k.body=e,this.emit(k),k.body=null},o.prototype.removeBody=function(e){if(this.stepping)throw new Error("Bodies cannot be removed during step.");for(var f=this.constraints,n=f.length;n--;)if(f[n].bodyA===this||f[n].bodyB===this)throw new Error("Cannot remove Body from World: it still has constraints connected to it.");e.world=null;var o=this.bodies;x(o,e),e.index=-1;for(var n=o.length;n--;)o[n].index=n;q.body=e,e.resetConstraintVelocity(),this.emit(q),q.body=null;for(var d=this.disabledBodyCollisionPairs,i=0;i<d.length;)d[i]===e||d[i+1]===e?d.splice(i,2):i+=2},o.prototype.getBodyById=function(e){for(var f=this.bodies,n=0;n<f.length;n++){var o=f[n];if(o.id===e)return o}return!1},o.prototype.disableBodyCollision=function(e,f){this.disabledBodyCollisionPairs.push(e,f)},o.prototype.enableBodyCollision=function(e,f){for(var n=this.disabledBodyCollisionPairs,o=0;o<n.length;o+=2)if(n[o]===e&&n[o+1]===f||n[o+1]===e&&n[o]===f)return void n.splice(o,2)},o.prototype.clear=function(){this.solver.removeAllEquations();for(var e=this.constraints,f=e.length;f--;)this.removeConstraint(e[f]);var n=this.bodies;for(f=n.length;f--;)this.removeBody(n[f]);var o=this.springs;for(f=o.length;f--;)this.removeSpring(o[f]);var d=this.contactMaterials;for(f=d.length;f--;)this.removeContactMaterial(d[f])};var J=u.create(),K=u.create();o.prototype.hitTest=function(e,f,n){n=n||0;for(var o=J,d=K,i=[],t=0,l=f.length;t!==l;t++)for(var p=f[t],c=0,y=p.shapes.length;c!==y;c++){var a=p.shapes[c];a.worldPointToLocal(d,e),a.pointTest(d)?i.push(p):(u.rotate(o,a.position,p.angle),u.add(o,o,p.position),a.type===s.PARTICLE&&u.squaredDistance(o,e)<n*n&&i.push(p))}return i},o.prototype.setGlobalStiffness=function(e){l(this,{stiffness:e});for(var f=this.contactMaterials,n=0;n!==f.length;n++){var o=f[n];o.stiffness=o.frictionStiffness=e}var o=this.defaultContactMaterial;o.stiffness=o.frictionStiffness=e},o.prototype.setGlobalRelaxation=function(e){l(this,{relaxation:e});for(var f=0;f!==this.contactMaterials.length;f++){var n=this.contactMaterials[f];n.relaxation=n.frictionRelaxation=e}var n=this.defaultContactMaterial;n.relaxation=n.frictionRelaxation=e};var L=new w,M=[];o.prototype.raycast=function(e,f){return f.getAABB(L),this.broadphase.aabbQuery(this,L,M),f.intersectBodies(e,M),M.length=0,e.hasHit()}},{"../collision/AABB":2,"../collision/Narrowphase":5,"../collision/SAPBroadphase":8,"../events/EventEmitter":21,"../material/ContactMaterial":22,"../material/Material":23,"../math/vec2":25,"../objects/Body":26,"../shapes/Shape":40,"../solver/GSSolver":41,"../utils/OverlapKeeper":45,"../utils/Utils":50,"./UnionFind":51}]},{},[31])(31)});