(function(){function e(){return n.Matrix="undefined"!=typeof Float32Array?Float32Array:Array,n.Matrix}var f=this,n=n||{};n.WEBGL_RENDERER=0,n.CANVAS_RENDERER=1,n.Point=function(e,f){this.x=e||0,this.y=f||0},n.Point.prototype.clone=function(){return new n.Point(this.x,this.y)},n.Point.prototype.constructor=n.Point,n.Rectangle=function(e,f,n,o){this.x=e||0,this.y=f||0,this.width=n||0,this.height=o||0},n.Rectangle.prototype.clone=function(){return new n.Rectangle(this.x,this.y,this.width,this.height)},n.Rectangle.prototype.contains=function(e,f){if(this.width<=0||this.height<=0)return!1;var n=this.x;if(e>=n&&e<=n+this.width){var o=this.y;if(f>=o&&f<=o+this.height)return!0}return!1},n.Rectangle.prototype.constructor=n.Rectangle,n.Polygon=function(e){if(e instanceof Array||(e=Array.prototype.slice.call(arguments)),"number"==typeof e[0]){for(var f=[],o=0,d=e.length;d>o;o+=2)f.push(new n.Point(e[o],e[o+1]));e=f}this.points=e},n.Polygon.prototype.clone=function(){for(var e=[],f=0;f<this.points.length;f++)e.push(this.points[f].clone());return new n.Polygon(e)},n.Polygon.prototype.contains=function(e,f){for(var n=!1,o=0,d=this.points.length-1;o<this.points.length;d=o++){var i=this.points[o].x,t=this.points[o].y,l=this.points[d].x,p=this.points[d].y,u=t>f!=p>f&&(l-i)*(f-t)/(p-t)+i>e;u&&(n=!n)}return n},n.Polygon.prototype.constructor=n.Polygon,n.Circle=function(e,f,n){this.x=e||0,this.y=f||0,this.radius=n||0},n.Circle.prototype.clone=function(){return new n.Circle(this.x,this.y,this.radius)},n.Circle.prototype.contains=function(e,f){if(this.radius<=0)return!1;var n=this.x-e,o=this.y-f,d=this.radius*this.radius;return n*=n,o*=o,d>=n+o},n.Circle.prototype.constructor=n.Circle,n.Ellipse=function(e,f,n,o){this.x=e||0,this.y=f||0,this.width=n||0,this.height=o||0},n.Ellipse.prototype.clone=function(){return new n.Ellipse(this.x,this.y,this.width,this.height)},n.Ellipse.prototype.contains=function(e,f){if(this.width<=0||this.height<=0)return!1;var n=(e-this.x)/this.width-.5,o=(f-this.y)/this.height-.5;return n*=n,o*=o,.25>n+o},n.Ellipse.prototype.getBounds=function(){return new n.Rectangle(this.x,this.y,this.width,this.height)},n.Ellipse.prototype.constructor=n.Ellipse,e(),n.mat3={},n.mat3.create=function(){var e=new n.Matrix(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},n.mat3.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},n.mat4={},n.mat4.create=function(){var e=new n.Matrix(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.mat3.multiply=function(e,f,n){n||(n=e);var o=e[0],d=e[1],i=e[2],t=e[3],l=e[4],p=e[5],u=e[6],s=e[7],c=e[8],y=f[0],a=f[1],r=f[2],w=f[3],b=f[4],g=f[5],m=f[6],x=f[7],j=f[8];return n[0]=y*o+a*t+r*u,n[1]=y*d+a*l+r*s,n[2]=y*i+a*p+r*c,n[3]=w*o+b*t+g*u,n[4]=w*d+b*l+g*s,n[5]=w*i+b*p+g*c,n[6]=m*o+x*t+j*u,n[7]=m*d+x*l+j*s,n[8]=m*i+x*p+j*c,n},n.mat3.clone=function(e){var f=new n.Matrix(9);return f[0]=e[0],f[1]=e[1],f[2]=e[2],f[3]=e[3],f[4]=e[4],f[5]=e[5],f[6]=e[6],f[7]=e[7],f[8]=e[8],f},n.mat3.transpose=function(e,f){if(!f||e===f){var n=e[1],o=e[2],d=e[5];return e[1]=e[3],e[2]=e[6],e[3]=n,e[5]=e[7],e[6]=o,e[7]=d,e}return f[0]=e[0],f[1]=e[3],f[2]=e[6],f[3]=e[1],f[4]=e[4],f[5]=e[7],f[6]=e[2],f[7]=e[5],f[8]=e[8],f},n.mat3.toMat4=function(e,f){return f||(f=n.mat4.create()),f[15]=1,f[14]=0,f[13]=0,f[12]=0,f[11]=0,f[10]=e[8],f[9]=e[7],f[8]=e[6],f[7]=0,f[6]=e[5],f[5]=e[4],f[4]=e[3],f[3]=0,f[2]=e[2],f[1]=e[1],f[0]=e[0],f},n.mat4.create=function(){var e=new n.Matrix(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.mat4.transpose=function(e,f){if(!f||e===f){var n=e[1],o=e[2],d=e[3],i=e[6],t=e[7],l=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=n,e[6]=e[9],e[7]=e[13],e[8]=o,e[9]=i,e[11]=e[14],e[12]=d,e[13]=t,e[14]=l,e}return f[0]=e[0],f[1]=e[4],f[2]=e[8],f[3]=e[12],f[4]=e[1],f[5]=e[5],f[6]=e[9],f[7]=e[13],f[8]=e[2],f[9]=e[6],f[10]=e[10],f[11]=e[14],f[12]=e[3],f[13]=e[7],f[14]=e[11],f[15]=e[15],f},n.mat4.multiply=function(e,f,n){n||(n=e);var o=e[0],d=e[1],i=e[2],t=e[3],l=e[4],p=e[5],u=e[6],s=e[7],c=e[8],y=e[9],a=e[10],r=e[11],w=e[12],b=e[13],g=e[14],m=e[15],x=f[0],j=f[1],v=f[2],h=f[3];return n[0]=x*o+j*l+v*c+h*w,n[1]=x*d+j*p+v*y+h*b,n[2]=x*i+j*u+v*a+h*g,n[3]=x*t+j*s+v*r+h*m,x=f[4],j=f[5],v=f[6],h=f[7],n[4]=x*o+j*l+v*c+h*w,n[5]=x*d+j*p+v*y+h*b,n[6]=x*i+j*u+v*a+h*g,n[7]=x*t+j*s+v*r+h*m,x=f[8],j=f[9],v=f[10],h=f[11],n[8]=x*o+j*l+v*c+h*w,n[9]=x*d+j*p+v*y+h*b,n[10]=x*i+j*u+v*a+h*g,n[11]=x*t+j*s+v*r+h*m,x=f[12],j=f[13],v=f[14],h=f[15],n[12]=x*o+j*l+v*c+h*w,n[13]=x*d+j*p+v*y+h*b,n[14]=x*i+j*u+v*a+h*g,n[15]=x*t+j*s+v*r+h*m,n},n.identityMatrix=n.mat3.create(),n.DisplayObject=function(){this.last=this,this.first=this,this.position=new n.Point,this.scale=new n.Point(1,1),this.pivot=new n.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.defaultCursor="pointer",this.worldTransform=n.mat3.create(),this.localTransform=n.mat3.create(),this.color=[],this.dynamic=!0,this._sr=0,this._cr=1,this.filterArea=new n.Rectangle(0,0,1,1),this._bounds=new n.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null},n.DisplayObject.prototype.constructor=n.DisplayObject,n.DisplayObject.prototype.setInteractive=function(e){this.interactive=e},Object.defineProperty(n.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(e){this._interactive=e,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(n.DisplayObject.prototype,"worldVisible",{get:function(){var e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}}),Object.defineProperty(n.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask&&(this._mask.isMask=!1),this._mask=e,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(n.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(e){if(e){for(var f=[],n=0;n<e.length;n++)for(var o=e[n].passes,d=0;d<o.length;d++)f.push(o[d]);this._filterBlock={target:this,filterPasses:f}}this._filters=e}}),n.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var e=this.localTransform,f=this.parent.worldTransform,n=this.worldTransform;e[0]=this._cr*this.scale.x,e[1]=-this._sr*this.scale.y,e[3]=this._sr*this.scale.x,e[4]=this._cr*this.scale.y;var o=this.pivot.x,d=this.pivot.y,i=e[0],t=e[1],l=this.position.x-e[0]*o-d*e[1],p=e[3],u=e[4],s=this.position.y-e[4]*d-o*e[3],c=f[0],y=f[1],a=f[2],r=f[3],w=f[4],b=f[5];e[2]=l,e[5]=s,n[0]=c*i+y*p,n[1]=c*t+y*u,n[2]=c*l+y*s+a,n[3]=r*i+w*p,n[4]=r*t+w*u,n[5]=r*l+w*s+b,this.worldAlpha=this.alpha*this.parent.worldAlpha},n.DisplayObject.prototype.getBounds=function(){return n.EmptyRectangle},n.DisplayObject.prototype.getLocalBounds=function(){var e=this.worldTransform;this.worldTransform=n.identityMatrix,this.updateTransform();var f=this.getBounds();return this.worldTransform=e,f},n.DisplayObject.prototype.setStageReference=function(e){this.stage=e,this._interactive&&(this.stage.dirty=!0)},n.DisplayObject.prototype._renderWebGL=function(e){e=e},n.DisplayObject.prototype._renderCanvas=function(e){e=e},n.EmptyRectangle=new n.Rectangle(0,0,0,0),n.DisplayObjectContainer=function(){n.DisplayObject.call(this),this.children=[]},n.DisplayObjectContainer.prototype=Object.create(n.DisplayObject.prototype),n.DisplayObjectContainer.prototype.constructor=n.DisplayObjectContainer,n.DisplayObjectContainer.prototype.addChild=function(e){e.parent&&e!==this&&e.parent.removeChild(e),e.parent=this,this.children.push(e),this.stage&&e.setStageReference(this.stage)},n.DisplayObjectContainer.prototype.addChildAt=function(e,f){if(!(f>=0&&f<=this.children.length))throw new Error(e+" The index "+f+" supplied is out of bounds "+this.children.length);e.parent&&e.parent.removeChild(e),e.parent=this,this.children.splice(f,0,e),this.stage&&e.setStageReference(this.stage)},n.DisplayObjectContainer.prototype.swapChildren=function(e,f){if(e!==f){var n=this.children.indexOf(e),o=this.children.indexOf(f);if(0>n||0>o)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[n]=f,this.children[o]=e}},n.DisplayObjectContainer.prototype.getChildAt=function(e){if(e>=0&&e<this.children.length)return this.children[e];throw new Error("The supplied DisplayObjects must be a child of the caller "+this)},n.DisplayObjectContainer.prototype.removeChild=function(e){var f=this.children.indexOf(e);if(-1===f)throw new Error(e+" The supplied DisplayObject must be a child of the caller "+this);this.stage&&e.removeStageReference(),e.parent=void 0,this.children.splice(f,1)},n.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible){n.DisplayObject.prototype.updateTransform.call(this);for(var e=0,f=this.children.length;f>e;e++)this.children[e].updateTransform()}},n.DisplayObjectContainer.prototype.getBounds=function(){if(0===this.children.length)return n.EmptyRectangle;for(var e,f,o,d=1/0,i=1/0,t=-(1/0),l=-(1/0),p=0,u=this.children.length;u>p;p++){var s=this.children[p];s.visible&&(e=this.children[p].getBounds(),d=d<e.x?d:e.x,i=i<e.y?i:e.y,f=e.width+e.x,o=e.height+e.y,t=t>f?t:f,l=l>o?l:o)}var c=this._bounds;return c.x=d,c.y=i,c.width=t-d,c.height=l-i,c},n.DisplayObjectContainer.prototype.setStageReference=function(e){this.stage=e,this._interactive&&(this.stage.dirty=!0);for(var f=0,n=this.children.length;n>f;f++){var o=this.children[f];o.setStageReference(e)}},n.DisplayObjectContainer.prototype.removeStageReference=function(){for(var e=0,f=this.children.length;f>e;e++){var n=this.children[e];n.removeStageReference()}this._interactive&&(this.stage.dirty=!0),this.stage=null},n.DisplayObjectContainer.prototype._renderWebGL=function(e){if(this.visible!==!1&&0!==this.alpha){var f,n;if(this._mask||this._filters){for(this._mask&&(e.spriteBatch.stop(),e.maskManager.pushMask(this.mask,e),e.spriteBatch.start()),this._filters&&(e.spriteBatch.flush(),e.filterManager.pushFilter(this._filterBlock)),f=0,n=this.children.length;n>f;f++)this.children[f]._renderWebGL(e);e.spriteBatch.stop(),this._filters&&e.filterManager.popFilter(),this._mask&&e.maskManager.popMask(e),e.spriteBatch.start()}else for(f=0,n=this.children.length;n>f;f++)this.children[f]._renderWebGL(e)}},n.DisplayObjectContainer.prototype._renderCanvas=function(e){if(this.visible!==!1&&0!==this.alpha){this._mask&&e.maskManager.pushMask(this._mask,e.context);for(var f=0,n=this.children.length;n>f;f++){var o=this.children[f];o._renderCanvas(e)}this._mask&&e.maskManager.popMask(e.context)}},n.blendModes={},n.blendModes.NORMAL=0,n.blendModes.ADD=1,n.blendModes.MULTIPLY=2,n.blendModes.SCREEN=3,n.Sprite=function(e){n.DisplayObjectContainer.call(this),this.anchor=new n.Point,this.texture=e,this._width=0,this._height=0,this.tint=16777215,this.blendMode=n.blendModes.NORMAL,e.baseTexture.hasLoaded?this.onTextureUpdate():(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},n.Sprite.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Sprite.prototype.constructor=n.Sprite,Object.defineProperty(n.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(e){this.scale.x=e/this.texture.frame.width,this._width=e}}),Object.defineProperty(n.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(e){this.scale.y=e/this.texture.frame.height,this._height=e}}),n.Sprite.prototype.setTexture=function(e){this.texture.baseTexture!==e.baseTexture?(this.textureChange=!0,this.texture=e):this.texture=e,this.cachedTint=16777215,this.updateFrame=!0},n.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height),this.updateFrame=!0},n.Sprite.prototype.getBounds=function(){var e=this.texture.frame.width,f=this.texture.frame.height,n=e*(1-this.anchor.x),o=e*-this.anchor.x,d=f*(1-this.anchor.y),i=f*-this.anchor.y,t=this.worldTransform,l=t[0],p=t[3],u=t[1],s=t[4],c=t[2],y=t[5],a=l*o+u*i+c,r=s*i+p*o+y,w=l*n+u*i+c,b=s*i+p*n+y,g=l*n+u*d+c,m=s*d+p*n+y,x=l*o+u*d+c,j=s*d+p*o+y,v=-(1/0),h=-(1/0),k=1/0,q=1/0;k=k>a?a:k,k=k>w?w:k,k=k>g?g:k,k=k>x?x:k,q=q>r?r:q,q=q>b?b:q,q=q>m?m:q,q=q>j?j:q,v=a>v?a:v,v=w>v?w:v,v=g>v?g:v,v=x>v?x:v,h=r>h?r:h,h=b>h?b:h,h=m>h?m:h,h=j>h?j:h;var z=this._bounds;return z.x=k,z.width=v-k,z.y=q,z.height=h-q,this._currentBounds=z,z},n.Sprite.prototype._renderWebGL=function(e){if(this.visible!==!1&&0!==this.alpha){var f,n;if(this._mask||this._filters){var o=e.spriteBatch;for(this._mask&&(o.stop(),e.maskManager.pushMask(this.mask,e),o.start()),this._filters&&(o.flush(),e.filterManager.pushFilter(this._filterBlock)),o.render(this),f=0,n=this.children.length;n>f;f++)this.children[f]._renderWebGL(e);o.stop(),this._filters&&e.filterManager.popFilter(),this._mask&&e.maskManager.popMask(e),o.start()}else for(e.spriteBatch.render(this),f=0,n=this.children.length;n>f;f++)this.children[f]._renderWebGL(e)}},n.Sprite.prototype._renderCanvas=function(e){if(this.visible!==!1&&0!==this.alpha){this._mask&&e.maskManager.pushMask(this._mask,e.context);var f=this.texture.frame,o=e.context,d=this.texture;if(f&&f.width&&f.height&&d.baseTexture.source){o.globalAlpha=this.worldAlpha;var i=this.worldTransform;if(o.setTransform(i[0],i[3],i[1],i[4],i[2],i[5]),this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,o.globalCompositeOperation=n.blendModesCanvas[e.currentBlendMode]),16777215!==this.tint){if(this.cachedTint!==this.tint){if(!d.baseTexture.hasLoaded)return;this.cachedTint=this.tint,this.tintedTexture=n.CanvasTinter.getTintedTexture(this,this.tint)}o.drawImage(this.tintedTexture,0,0,f.width,f.height,this.anchor.x*-f.width,this.anchor.y*-f.height,f.width,f.height)}else if(d.trimmed){var t=d.trim;o.drawImage(this.texture.baseTexture.source,f.x,f.y,f.width,f.height,t.x-this.anchor.x*t.realWidth,t.y-this.anchor.y*t.realHeight,f.width,f.height)}else o.drawImage(this.texture.baseTexture.source,f.x,f.y,f.width,f.height,this.anchor.x*-f.width,this.anchor.y*-f.height,f.width,f.height)}for(var l=0,p=this.children.length;p>l;l++){var u=this.children[l];u._renderCanvas(e)}this._mask&&e.maskManager.popMask(e.context)}},n.Sprite.fromFrame=function(e){var f=n.TextureCache[e];if(!f)throw new Error('The frameId "'+e+'" does not exist in the texture cache'+this);return new n.Sprite(f)},n.Sprite.fromImage=function(e){var f=n.Texture.fromImage(e);return new n.Sprite(f)},n.MovieClip=function(e){n.Sprite.call(this,e[0]),this.textures=e,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},n.MovieClip.prototype=Object.create(n.Sprite.prototype),n.MovieClip.prototype.constructor=n.MovieClip,Object.defineProperty(n.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}}),n.MovieClip.prototype.stop=function(){this.playing=!1},n.MovieClip.prototype.play=function(){this.playing=!0},n.MovieClip.prototype.gotoAndStop=function(e){this.playing=!1,this.currentFrame=e;var f=this.currentFrame+.5|0;this.setTexture(this.textures[f%this.textures.length])},n.MovieClip.prototype.gotoAndPlay=function(e){this.currentFrame=e,this.playing=!0},n.MovieClip.prototype.updateTransform=function(){if(n.Sprite.prototype.updateTransform.call(this),this.playing){this.currentFrame+=this.animationSpeed;var e=this.currentFrame+.5|0;this.loop||e<this.textures.length?this.setTexture(this.textures[e%this.textures.length]):e>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},n.FilterBlock=function(){this.visible=!0,this.renderable=!0},n.Text=function(e,f){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),n.Sprite.call(this,n.Texture.fromCanvas(this.canvas)),this.setText(e),this.setStyle(f),this.updateText(),this.dirty=!1},n.Text.prototype=Object.create(n.Sprite.prototype),n.Text.prototype.constructor=n.Text,n.Text.prototype.setStyle=function(e){e=e||{},e.font=e.font||"bold 20pt Arial",e.fill=e.fill||"black",e.align=e.align||"left",e.stroke=e.stroke||"black",e.strokeThickness=e.strokeThickness||0,e.wordWrap=e.wordWrap||!1,e.wordWrapWidth=e.wordWrapWidth||100,this.style=e,this.dirty=!0},n.Text.prototype.setText=function(e){this.text=e.toString()||" ",this.dirty=!0},n.Text.prototype.updateText=function(){this.context.font=this.style.font;var e=this.text;this.style.wordWrap&&(e=this.wordWrap(this.text));for(var f=e.split(/(?:\r\n|\r|\n)/),o=[],d=0,i=0;i<f.length;i++){var t=this.context.measureText(f[i]).width;o[i]=t,d=Math.max(d,t)}this.canvas.width=d+this.style.strokeThickness;var l=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness;for(this.canvas.height=l*f.length,navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="top",i=0;i<f.length;i++){var p=new n.Point(this.style.strokeThickness/2,this.style.strokeThickness/2+i*l);"right"===this.style.align?p.x+=d-o[i]:"center"===this.style.align&&(p.x+=(d-o[i])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(f[i],p.x,p.y),this.style.fill&&this.context.fillText(f[i],p.x,p.y)}this.updateTexture()},n.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.frame.width=this.canvas.width,this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.requiresUpdate=!0},n.Text.prototype._renderWebGL=function(e){this.requiresUpdate&&(this.requiresUpdate=!1,n.updateWebGLTexture(this.texture.baseTexture,e.gl)),n.Sprite.prototype._renderWebGL.call(this,e)},n.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),n.Sprite.prototype.updateTransform.call(this)},n.Text.prototype.determineFontHeight=function(e){var f=n.Text.heightCache[e];if(!f){var o=document.getElementsByTagName("body")[0],d=document.createElement("div"),i=document.createTextNode("M");d.appendChild(i),d.setAttribute("style",e+";position:absolute;top:0;left:0"),o.appendChild(d),f=d.offsetHeight,n.Text.heightCache[e]=f,o.removeChild(d)}return f},n.Text.prototype.wordWrap=function(e){for(var f="",n=e.split("\n"),o=0;o<n.length;o++){for(var d=this.style.wordWrapWidth,i=n[o].split(" "),t=0;t<i.length;t++){var l=this.context.measureText(i[t]).width,p=l+this.context.measureText(" ").width;p>d?(t>0&&(f+="\n"),f+=i[t]+" ",d=this.style.wordWrapWidth-l):(d-=p,f+=i[t]+" ")}f+="\n"}return f},n.Text.prototype.destroy=function(e){e&&this.texture.destroy()},n.Text.heightCache={},n.BitmapText=function(e,f){n.DisplayObjectContainer.call(this),this.setText(e),this.setStyle(f),this.updateText(),this.dirty=!1},n.BitmapText.prototype=Object.create(n.DisplayObjectContainer.prototype),n.BitmapText.prototype.constructor=n.BitmapText,n.BitmapText.prototype.setText=function(e){this.text=e||" ",this.dirty=!0},n.BitmapText.prototype.setStyle=function(e){e=e||{},e.align=e.align||"left",this.style=e;var f=e.font.split(" ");this.fontName=f[f.length-1],this.fontSize=f.length>=2?parseInt(f[f.length-2],10):n.BitmapText.fonts[this.fontName].size,this.dirty=!0},n.BitmapText.prototype.updateText=function(){for(var e=n.BitmapText.fonts[this.fontName],f=new n.Point,o=null,d=[],i=0,t=[],l=0,p=this.fontSize/e.size,u=0;u<this.text.length;u++){var s=this.text.charCodeAt(u);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(u)))t.push(f.x),i=Math.max(i,f.x),l++,f.x=0,f.y+=e.lineHeight,o=null;else{var c=e.chars[s];c&&(o&&c[o]&&(f.x+=c.kerning[o]),d.push({texture:c.texture,line:l,charCode:s,position:new n.Point(f.x+c.xOffset,f.y+c.yOffset)}),f.x+=c.xAdvance,o=s)}}t.push(f.x),i=Math.max(i,f.x);var y=[];for(u=0;l>=u;u++){var a=0;"right"===this.style.align?a=i-t[u]:"center"===this.style.align&&(a=(i-t[u])/2),y.push(a)}for(u=0;u<d.length;u++){var r=new n.Sprite(d[u].texture);r.position.x=(d[u].position.x+y[d[u].line])*p,r.position.y=d[u].position.y*p,r.scale.x=r.scale.y=p,this.addChild(r)}this.width=i*p,this.height=(f.y+e.lineHeight)*p},n.BitmapText.prototype.updateTransform=function(){if(this.dirty){for(;this.children.length>0;)this.removeChild(this.getChildAt(0));this.updateText(),this.dirty=!1}n.DisplayObjectContainer.prototype.updateTransform.call(this)},n.BitmapText.fonts={},n.InteractionManager=function(e){this.stage=e,this.mouse=new n.InteractionData,this.touchs={},this.tempPoint=new n.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.interactionDOMElement=null,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.last=0,this.currentCursor="inherit"},n.InteractionManager.prototype.constructor=n.InteractionManager,n.InteractionManager.prototype.collectInteractiveSprite=function(e,f){for(var n=e.children,o=n.length,d=o-1;d>=0;d--){var i=n[d];i.interactive?(f.interactiveChildren=!0,this.interactiveItems.push(i),i.children.length>0&&this.collectInteractiveSprite(i,i)):(i.__iParent=null,i.children.length>0&&this.collectInteractiveSprite(i,f))}},n.InteractionManager.prototype.setTarget=function(e){this.target=e,null===this.interactionDOMElement&&this.setTargetDomElement(e.view),document.body.addEventListener("mouseup",this.onMouseUp,!0)},n.InteractionManager.prototype.setTargetDomElement=function(e){null!==this.interactionDOMElement&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0)),window.navigator.msPointerEnabled&&(e.style["-ms-content-zooming"]="none",e.style["-ms-touch-action"]="none"),this.interactionDOMElement=e,e.addEventListener("mousemove",this.onMouseMove,!0),e.addEventListener("mousedown",this.onMouseDown,!0),e.addEventListener("mouseout",this.onMouseOut,!0),e.addEventListener("touchstart",this.onTouchStart,!0),e.addEventListener("touchend",this.onTouchEnd,!0),e.addEventListener("touchmove",this.onTouchMove,!0)},n.InteractionManager.prototype.update=function(){if(this.target){var e=Date.now(),f=e-this.last;if(f=30*f/1e3,!(1>f)){this.last=e;var n=0;if(this.dirty){this.dirty=!1;var o=this.interactiveItems.length;for(n=0;o>n;n++)this.interactiveItems[n].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)}var d=this.interactiveItems.length;for(n=0;d>n;n++){var i=this.interactiveItems[n];(i.mouseover||i.mouseout||i.buttonMode)&&(i.__hit=this.hitTest(i,this.mouse),this.mouse.target=i,i.__hit?(i.buttonMode&&(this.currentCursor=i.defaultCursor),i.__isOver||(i.mouseover&&i.mouseover(this.mouse),i.__isOver=!0)):i.__isOver&&(i.mouseout&&i.mouseout(this.mouse),i.__isOver=!1))}this.currentCursor!==this.interactionDOMElement.style.cursor&&(this.interactionDOMElement.style.cursor=this.currentCursor)}}},n.InteractionManager.prototype.onMouseMove=function(e){this.mouse.originalEvent=e||window.event;var f=this.interactionDOMElement.getBoundingClientRect();this.mouse.global.x=(e.clientX-f.left)*(this.target.width/f.width),this.mouse.global.y=(e.clientY-f.top)*(this.target.height/f.height);for(var n=this.interactiveItems.length,o=0;n>o;o++){var d=this.interactiveItems[o];d.mousemove&&d.mousemove(this.mouse)}},n.InteractionManager.prototype.onMouseDown=function(e){this.mouse.originalEvent=e||window.event;for(var f=this.interactiveItems.length,n=0;f>n;n++){var o=this.interactiveItems[n];if((o.mousedown||o.click)&&(o.__mouseIsDown=!0,o.__hit=this.hitTest(o,this.mouse),o.__hit&&(o.mousedown&&o.mousedown(this.mouse),o.__isDown=!0,!o.interactiveChildren)))break}},n.InteractionManager.prototype.onMouseOut=function(){var e=this.interactiveItems.length;this.currentCursor="inherit";for(var f=0;e>f;f++){var n=this.interactiveItems[f];n.__isOver&&(this.mouse.target=n,n.mouseout&&n.mouseout(this.mouse),n.__isOver=!1)}},n.InteractionManager.prototype.onMouseUp=function(e){this.mouse.originalEvent=e||window.event;for(var f=this.interactiveItems.length,n=!1,o=0;f>o;o++){var d=this.interactiveItems[o];(d.mouseup||d.mouseupoutside||d.click)&&(d.__hit=this.hitTest(d,this.mouse),d.__hit&&!n?(d.mouseup&&d.mouseup(this.mouse),d.__isDown&&d.click&&d.click(this.mouse),d.interactiveChildren||(n=!0)):d.__isDown&&d.mouseupoutside&&d.mouseupoutside(this.mouse),d.__isDown=!1)}},n.InteractionManager.prototype.hitTest=function(e,f){var o=f.global;if(!e.worldVisible)return!1;var d=e instanceof n.Sprite,i=e.worldTransform,t=i[0],l=i[1],p=i[2],u=i[3],s=i[4],c=i[5],y=1/(t*s+l*-u),a=s*y*o.x+-l*y*o.y+(c*l-p*s)*y,r=t*y*o.y+-u*y*o.x+(-c*t+p*u)*y;if(f.target=e,e.hitArea&&e.hitArea.contains)return e.hitArea.contains(a,r)?(f.target=e,!0):!1;if(d){var w,b=e.texture.frame.width,g=e.texture.frame.height,m=-b*e.anchor.x;if(a>m&&m+b>a&&(w=-g*e.anchor.y,r>w&&w+g>r))return f.target=e,!0}for(var x=e.children.length,j=0;x>j;j++){var v=e.children[j],h=this.hitTest(v,f);if(h)return f.target=e,!0}return!1},n.InteractionManager.prototype.onTouchMove=function(e){var f,n=this.interactionDOMElement.getBoundingClientRect(),o=e.changedTouches,d=0;for(d=0;d<o.length;d++){var i=o[d];f=this.touchs[i.identifier],f.originalEvent=e||window.event,f.global.x=(i.clientX-n.left)*(this.target.width/n.width),f.global.y=(i.clientY-n.top)*(this.target.height/n.height),navigator.isCocoonJS&&(f.global.x=i.clientX,f.global.y=i.clientY)}var t=this.interactiveItems.length;for(d=0;t>d;d++){var l=this.interactiveItems[d];l.touchmove&&l.touchmove(f)}},n.InteractionManager.prototype.onTouchStart=function(e){for(var f=this.interactionDOMElement.getBoundingClientRect(),o=e.changedTouches,d=0;d<o.length;d++){var i=o[d],t=this.pool.pop();t||(t=new n.InteractionData),t.originalEvent=e||window.event,this.touchs[i.identifier]=t,t.global.x=(i.clientX-f.left)*(this.target.width/f.width),t.global.y=(i.clientY-f.top)*(this.target.height/f.height),navigator.isCocoonJS&&(t.global.x=i.clientX,t.global.y=i.clientY);for(var l=this.interactiveItems.length,p=0;l>p;p++){var u=this.interactiveItems[p];if((u.touchstart||u.tap)&&(u.__hit=this.hitTest(u,t),u.__hit&&(u.touchstart&&u.touchstart(t),u.__isDown=!0,u.__touchData=t,!u.interactiveChildren)))break}}},n.InteractionManager.prototype.onTouchEnd=function(e){for(var f=this.interactionDOMElement.getBoundingClientRect(),n=e.changedTouches,o=0;o<n.length;o++){var d=n[o],i=this.touchs[d.identifier],t=!1;i.global.x=(d.clientX-f.left)*(this.target.width/f.width),i.global.y=(d.clientY-f.top)*(this.target.height/f.height),navigator.isCocoonJS&&(i.global.x=d.clientX,i.global.y=d.clientY);for(var l=this.interactiveItems.length,p=0;l>p;p++){var u=this.interactiveItems[p],s=u.__touchData;u.__hit=this.hitTest(u,i),s===i&&(i.originalEvent=e||window.event,(u.touchend||u.tap)&&(u.__hit&&!t?(u.touchend&&u.touchend(i),u.__isDown&&u.tap&&u.tap(i),u.interactiveChildren||(t=!0)):u.__isDown&&u.touchendoutside&&u.touchendoutside(i),u.__isDown=!1),u.__touchData=null)}this.pool.push(i),this.touchs[d.identifier]=null}},n.InteractionData=function(){this.global=new n.Point,this.local=new n.Point,this.target=null,this.originalEvent=null},n.InteractionData.prototype.getLocalPosition=function(e){var f=e.worldTransform,o=this.global,d=f[0],i=f[1],t=f[2],l=f[3],p=f[4],u=f[5],s=1/(d*p+i*-l);return new n.Point(p*s*o.x+-i*s*o.y+(u*i-t*p)*s,d*s*o.y+-l*s*o.x+(-u*d+t*l)*s)},n.InteractionData.prototype.constructor=n.InteractionData,n.Stage=function(e){n.DisplayObjectContainer.call(this),this.worldTransform=n.mat3.create(),this.interactive=!0,this.interactionManager=new n.InteractionManager(this),this.dirty=!0,this.stage=this,this.stage.hitArea=new n.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(e)},n.Stage.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Stage.prototype.constructor=n.Stage,n.Stage.prototype.setInteractionDelegate=function(e){this.interactionManager.setTargetDomElement(e)},n.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var e=0,f=this.children.length;f>e;e++)this.children[e].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},n.Stage.prototype.setBackgroundColor=function(e){this.backgroundColor=e||0,this.backgroundColorSplit=n.hex2rgb(this.backgroundColor);var f=this.backgroundColor.toString(16);f="000000".substr(0,6-f.length)+f,this.backgroundColorString="#"+f},n.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};for(var o=0,d=["ms","moz","webkit","o"],i=0;i<d.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[d[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[d[i]+"CancelAnimationFrame"]||window[d[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var f=(new Date).getTime(),n=Math.max(0,16-(f-o)),d=window.setTimeout(function(){e(f+n)},n);return o=f+n,d}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),window.requestAnimFrame=window.requestAnimationFrame,n.hex2rgb=function(e){return[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255]},n.rgb2hex=function(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var e=Array.prototype.slice;return function(f){function n(){var i=d.concat(e.call(arguments));o.apply(this instanceof n?this:f,i)}var o=this,d=e.call(arguments,1);if("function"!=typeof o)throw new TypeError;return n.prototype=function i(e){return e&&(i.prototype=e),this instanceof i?void 0:new i}(o.prototype),n}}()),n.AjaxRequest=function(){var e=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:!1;for(var f=0;f<e.length;f++)try{return new window.ActiveXObject(e[f])}catch(n){}},n.canUseNewCanvasBlendModes=function(){var e=document.createElement("canvas");e.width=1,e.height=1;var f=e.getContext("2d");return f.fillStyle="#000",f.fillRect(0,0,1,1),f.globalCompositeOperation="multiply",f.fillStyle="#fff",f.fillRect(0,0,1,1),0===f.getImageData(0,0,1,1).data[0]},n.getNextPowerOfTwo=function(e){if(e>0&&0===(e&e-1))return e;for(var f=1;e>f;)f<<=1;return f},n.EventTarget=function(){var e={};this.addEventListener=this.on=function(f,n){void 0===e[f]&&(e[f]=[]),-1===e[f].indexOf(n)&&e[f].push(n)},this.dispatchEvent=this.emit=function(f){if(e[f.type]&&e[f.type].length)for(var n=0,o=e[f.type].length;o>n;n++)e[f.type][n](f)},this.removeEventListener=this.off=function(f,n){var o=e[f].indexOf(n);-1!==o&&e[f].splice(o,1)},this.removeAllEventListeners=function(f){var n=e[f];n&&(n.length=0)}},n.autoDetectRenderer=function(e,f,o,d,i){e||(e=800),f||(f=600);var t=function(){try{var e=document.createElement("canvas");
return!!window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(f){return!1}}();return t?new n.WebGLRenderer(e,f,o,d,i):new n.CanvasRenderer(e,f,o,d)},n.PolyK={},n.PolyK.Triangulate=function(e){var f=!0,o=e.length>>1;if(3>o)return[];for(var d=[],i=[],t=0;o>t;t++)i.push(t);t=0;for(var l=o;l>3;){var p=i[(t+0)%l],u=i[(t+1)%l],s=i[(t+2)%l],c=e[2*p],y=e[2*p+1],a=e[2*u],r=e[2*u+1],w=e[2*s],b=e[2*s+1],g=!1;if(n.PolyK._convex(c,y,a,r,w,b,f)){g=!0;for(var m=0;l>m;m++){var x=i[m];if(x!==p&&x!==u&&x!==s&&n.PolyK._PointInTriangle(e[2*x],e[2*x+1],c,y,a,r,w,b)){g=!1;break}}}if(g)d.push(p,u,s),i.splice((t+1)%l,1),l--,t=0;else if(t++>3*l){if(!f)return window.console.log("PIXI Warning: shape too complex to fill"),[];for(d=[],i=[],t=0;o>t;t++)i.push(t);t=0,l=o,f=!1}}return d.push(i[0],i[1],i[2]),d},n.PolyK._PointInTriangle=function(e,f,n,o,d,i,t,l){var p=t-n,u=l-o,s=d-n,c=i-o,y=e-n,a=f-o,r=p*p+u*u,w=p*s+u*c,b=p*y+u*a,g=s*s+c*c,m=s*y+c*a,x=1/(r*g-w*w),j=(g*b-w*m)*x,v=(r*m-w*b)*x;return j>=0&&v>=0&&1>j+v},n.PolyK._convex=function(e,f,n,o,d,i,t){return(f-o)*(d-n)+(n-e)*(i-o)>=0===t},n.initDefaultShaders=function(){},n.CompileVertexShader=function(e,f){return n._CompileShader(e,f,e.VERTEX_SHADER)},n.CompileFragmentShader=function(e,f){return n._CompileShader(e,f,e.FRAGMENT_SHADER)},n._CompileShader=function(e,f,n){var o=f.join("\n"),d=e.createShader(n);return e.shaderSource(d,o),e.compileShader(d),e.getShaderParameter(d,e.COMPILE_STATUS)?d:(window.console.log(e.getShaderInfoLog(d)),null)},n.compileProgram=function(e,f,o){var d=n.CompileFragmentShader(e,o),i=n.CompileVertexShader(e,f),t=e.createProgram();return e.attachShader(t,i),e.attachShader(t,d),e.linkProgram(t),e.getProgramParameter(t,e.LINK_STATUS)||window.console.log("Could not initialise shaders"),t},n.PixiShader=function(e){this.gl=e,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.init()},n.PixiShader.prototype.init=function(){var e=this.gl,f=n.compileProgram(e,this.vertexSrc||n.PixiShader.defaultVertexSrc,this.fragmentSrc);e.useProgram(f),this.uSampler=e.getUniformLocation(f,"uSampler"),this.projectionVector=e.getUniformLocation(f,"projectionVector"),this.offsetVector=e.getUniformLocation(f,"offsetVector"),this.dimensions=e.getUniformLocation(f,"dimensions"),this.aVertexPosition=e.getAttribLocation(f,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(f,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(f,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2);for(var o in this.uniforms)this.uniforms[o].uniformLocation=e.getUniformLocation(f,o);this.initUniforms(),this.program=f},n.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var e,f=this.gl;for(var n in this.uniforms){e=this.uniforms[n];var o=e.type;"sampler2D"===o?(e._init=!1,null!==e.value&&this.initSampler2D(e)):"mat2"===o||"mat3"===o||"mat4"===o?(e.glMatrix=!0,e.glValueLength=1,"mat2"===o?e.glFunc=f.uniformMatrix2fv:"mat3"===o?e.glFunc=f.uniformMatrix3fv:"mat4"===o&&(e.glFunc=f.uniformMatrix4fv)):(e.glFunc=f["uniform"+o],"2f"===o||"2i"===o?e.glValueLength=2:"3f"===o||"3i"===o?e.glValueLength=3:"4f"===o||"4i"===o?e.glValueLength=4:e.glValueLength=1)}},n.PixiShader.prototype.initSampler2D=function(e){if(e.value&&e.value.baseTexture&&e.value.baseTexture.hasLoaded){var f=this.gl;if(f.activeTexture(f["TEXTURE"+this.textureCount]),f.bindTexture(f.TEXTURE_2D,e.value.baseTexture._glTexture),e.textureData){var n=e.textureData,o=n.magFilter?n.magFilter:f.LINEAR,d=n.minFilter?n.minFilter:f.LINEAR,i=n.wrapS?n.wrapS:f.CLAMP_TO_EDGE,t=n.wrapT?n.wrapT:f.CLAMP_TO_EDGE,l=n.luminance?f.LUMINANCE:f.RGBA;if(n.repeat&&(i=f.REPEAT,t=f.REPEAT),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!1),n.width){var p=n.width?n.width:512,u=n.height?n.height:2,s=n.border?n.border:0;f.texImage2D(f.TEXTURE_2D,0,l,p,u,s,l,f.UNSIGNED_BYTE,null)}else f.texImage2D(f.TEXTURE_2D,0,l,f.RGBA,f.UNSIGNED_BYTE,e.value.baseTexture.source);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,d),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,t)}f.uniform1i(e.uniformLocation,this.textureCount),e._init=!0,this.textureCount++}},n.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var e,f=this.gl;for(var o in this.uniforms)e=this.uniforms[o],1===e.glValueLength?e.glMatrix===!0?e.glFunc.call(f,e.uniformLocation,e.transpose,e.value):e.glFunc.call(f,e.uniformLocation,e.value):2===e.glValueLength?e.glFunc.call(f,e.uniformLocation,e.value.x,e.value.y):3===e.glValueLength?e.glFunc.call(f,e.uniformLocation,e.value.x,e.value.y,e.value.z):4===e.glValueLength?e.glFunc.call(f,e.uniformLocation,e.value.x,e.value.y,e.value.z,e.value.w):"sampler2D"===e.type&&(e._init?(f.activeTexture(f["TEXTURE"+this.textureCount]),f.bindTexture(f.TEXTURE_2D,e.value.baseTexture._glTextures[f.id]||n.createWebGLTexture(e.value.baseTexture,f)),f.uniform1i(e.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(e))},n.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vec3 color = mod(vec3(aColor.y/65536.0, aColor.y/256.0, aColor.y), 256.0) / 256.0;","   vColor = vec4(color * aColor.x, aColor.x);","}"],n.StripShader=function(){this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","   gl_FragColor = gl_FragColor * alpha;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","uniform vec2 offsetVector;","varying float vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"]},n.StripShader.prototype.init=function(){var e=n.gl,f=n.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(f),this.uSampler=e.getUniformLocation(f,"uSampler"),this.projectionVector=e.getUniformLocation(f,"projectionVector"),this.offsetVector=e.getUniformLocation(f,"offsetVector"),this.colorAttribute=e.getAttribLocation(f,"aColor"),this.aVertexPosition=e.getAttribLocation(f,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(f,"aTextureCoord"),this.translationMatrix=e.getUniformLocation(f,"translationMatrix"),this.alpha=e.getUniformLocation(f,"alpha"),this.program=f},n.PrimitiveShader=function(e){this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},n.PrimitiveShader.prototype.init=function(){var e=this.gl,f=n.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(f),this.projectionVector=e.getUniformLocation(f,"projectionVector"),this.offsetVector=e.getUniformLocation(f,"offsetVector"),this.tintColor=e.getUniformLocation(f,"tint"),this.aVertexPosition=e.getAttribLocation(f,"aVertexPosition"),this.colorAttribute=e.getAttribLocation(f,"aColor"),this.translationMatrix=e.getUniformLocation(f,"translationMatrix"),this.alpha=e.getUniformLocation(f,"alpha"),this.program=f},n.WebGLGraphics=function(){},n.WebGLGraphics.renderGraphics=function(e,f){var o=f.gl,d=f.projection,i=f.offset,t=f.shaderManager.primitiveShader;e._webGL[o.id]||(e._webGL[o.id]={points:[],indices:[],lastIndex:0,buffer:o.createBuffer(),indexBuffer:o.createBuffer()});var l=e._webGL[o.id];e.dirty&&(e.dirty=!1,e.clearDirty&&(e.clearDirty=!1,l.lastIndex=0,l.points=[],l.indices=[]),n.WebGLGraphics.updateGraphics(e,o)),f.shaderManager.activatePrimitiveShader();var p=n.mat3.clone(e.worldTransform);n.mat3.transpose(p),o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),o.uniformMatrix3fv(t.translationMatrix,!1,p),o.uniform2f(t.projectionVector,d.x,-d.y),o.uniform2f(t.offsetVector,-i.x,-i.y),o.uniform3fv(t.tintColor,n.hex2rgb(e.tint)),o.uniform1f(t.alpha,e.worldAlpha),o.bindBuffer(o.ARRAY_BUFFER,l.buffer),o.vertexAttribPointer(t.aVertexPosition,2,o.FLOAT,!1,24,0),o.vertexAttribPointer(t.colorAttribute,4,o.FLOAT,!1,24,8),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,l.indexBuffer),o.drawElements(o.TRIANGLE_STRIP,l.indices.length,o.UNSIGNED_SHORT,0),f.shaderManager.deactivatePrimitiveShader()},n.WebGLGraphics.updateGraphics=function(e,f){for(var o=e._webGL[f.id],d=o.lastIndex;d<e.graphicsData.length;d++){var i=e.graphicsData[d];i.type===n.Graphics.POLY?(i.fill&&i.points.length>3&&n.WebGLGraphics.buildPoly(i,o),i.lineWidth>0&&n.WebGLGraphics.buildLine(i,o)):i.type===n.Graphics.RECT?n.WebGLGraphics.buildRectangle(i,o):(i.type===n.Graphics.CIRC||i.type===n.Graphics.ELIP)&&n.WebGLGraphics.buildCircle(i,o)}o.lastIndex=e.graphicsData.length,o.glPoints=new Float32Array(o.points),f.bindBuffer(f.ARRAY_BUFFER,o.buffer),f.bufferData(f.ARRAY_BUFFER,o.glPoints,f.STATIC_DRAW),o.glIndicies=new Uint16Array(o.indices),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,o.indexBuffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,o.glIndicies,f.STATIC_DRAW)},n.WebGLGraphics.buildRectangle=function(e,f){var o=e.points,d=o[0],i=o[1],t=o[2],l=o[3];if(e.fill){var p=n.hex2rgb(e.fillColor),u=e.fillAlpha,s=p[0]*u,c=p[1]*u,y=p[2]*u,a=f.points,r=f.indices,w=a.length/6;a.push(d,i),a.push(s,c,y,u),a.push(d+t,i),a.push(s,c,y,u),a.push(d,i+l),a.push(s,c,y,u),a.push(d+t,i+l),a.push(s,c,y,u),r.push(w,w,w+1,w+2,w+3,w+3)}if(e.lineWidth){var b=e.points;e.points=[d,i,d+t,i,d+t,i+l,d,i+l,d,i],n.WebGLGraphics.buildLine(e,f),e.points=b}},n.WebGLGraphics.buildCircle=function(e,f){var o=e.points,d=o[0],i=o[1],t=o[2],l=o[3],p=40,u=2*Math.PI/p,s=0;if(e.fill){var c=n.hex2rgb(e.fillColor),y=e.fillAlpha,a=c[0]*y,r=c[1]*y,w=c[2]*y,b=f.points,g=f.indices,m=b.length/6;for(g.push(m),s=0;p+1>s;s++)b.push(d,i,a,r,w,y),b.push(d+Math.sin(u*s)*t,i+Math.cos(u*s)*l,a,r,w,y),g.push(m++,m++);g.push(m-1)}if(e.lineWidth){var x=e.points;for(e.points=[],s=0;p+1>s;s++)e.points.push(d+Math.sin(u*s)*t,i+Math.cos(u*s)*l);n.WebGLGraphics.buildLine(e,f),e.points=x}},n.WebGLGraphics.buildLine=function(e,f){var o=0,d=e.points;if(0!==d.length){var i=new n.Point(d[0],d[1]),t=new n.Point(d[d.length-2],d[d.length-1]);if(i.x===t.x&&i.y===t.y){d.pop(),d.pop(),t=new n.Point(d[d.length-2],d[d.length-1]);var l=t.x+.5*(i.x-t.x),p=t.y+.5*(i.y-t.y);d.unshift(l,p),d.push(l,p)}var u,s,c,y,a,r,w,b,g,m,x,j,v,h,k,q,z,A,B,C,D,E,F,G=f.points,H=f.indices,I=d.length/2,J=d.length,K=G.length/6,L=e.lineWidth/2,M=n.hex2rgb(e.lineColor),N=e.lineAlpha,O=M[0]*N,P=M[1]*N,Q=M[2]*N;for(c=d[0],y=d[1],a=d[2],r=d[3],g=-(y-r),m=c-a,F=Math.sqrt(g*g+m*m),g/=F,m/=F,g*=L,m*=L,G.push(c-g,y-m,O,P,Q,N),G.push(c+g,y+m,O,P,Q,N),o=1;I-1>o;o++)c=d[2*(o-1)],y=d[2*(o-1)+1],a=d[2*o],r=d[2*o+1],w=d[2*(o+1)],b=d[2*(o+1)+1],g=-(y-r),m=c-a,F=Math.sqrt(g*g+m*m),g/=F,m/=F,g*=L,m*=L,x=-(r-b),j=a-w,F=Math.sqrt(x*x+j*j),x/=F,j/=F,x*=L,j*=L,k=-m+y-(-m+r),q=-g+a-(-g+c),z=(-g+c)*(-m+r)-(-g+a)*(-m+y),A=-j+b-(-j+r),B=-x+a-(-x+w),C=(-x+w)*(-j+r)-(-x+a)*(-j+b),D=k*B-A*q,u=(q*C-B*z)/D,s=(A*z-k*C)/D,E=(u-a)*(u-a)+(s-r)+(s-r),E>19600?(v=g-x,h=m-j,F=Math.sqrt(v*v+h*h),v/=F,h/=F,v*=L,h*=L,G.push(a-v,r-h),G.push(O,P,Q,N),G.push(a+v,r+h),G.push(O,P,Q,N),G.push(a-v,r-h),G.push(O,P,Q,N),J++):(G.push(u,s),G.push(O,P,Q,N),G.push(a-(u-a),r-(s-r)),G.push(O,P,Q,N));for(c=d[2*(I-2)],y=d[2*(I-2)+1],a=d[2*(I-1)],r=d[2*(I-1)+1],g=-(y-r),m=c-a,F=Math.sqrt(g*g+m*m),g/=F,m/=F,g*=L,m*=L,G.push(a-g,r-m),G.push(O,P,Q,N),G.push(a+g,r+m),G.push(O,P,Q,N),H.push(K),o=0;J>o;o++)H.push(K++);H.push(K-1)}},n.WebGLGraphics.buildPoly=function(e,f){var o=e.points;if(!(o.length<6)){var d=f.points,i=f.indices,t=o.length/2,l=n.hex2rgb(e.fillColor),p=e.fillAlpha,u=l[0]*p,s=l[1]*p,c=l[2]*p,y=n.PolyK.Triangulate(o),a=d.length/6,r=0;for(r=0;r<y.length;r+=3)i.push(y[r]+a),i.push(y[r]+a),i.push(y[r+1]+a),i.push(y[r+2]+a),i.push(y[r+2]+a);for(r=0;t>r;r++)d.push(o[2*r],o[2*r+1],u,s,c,p)}},n.glContexts=[],n.WebGLRenderer=function(e,f,o,d,i){n.defaultRenderer||(n.defaultRenderer=this),this.type=n.WEBGL_RENDERER,this.transparent=!!d,this.width=e||800,this.height=f||600,this.view=o||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height;var t=this;this.view.addEventListener("webglcontextlost",function(e){t.handleContextLost(e)},!1),this.view.addEventListener("webglcontextrestored",function(e){t.handleContextRestored(e)},!1),this.options={alpha:this.transparent,antialias:!!i,premultipliedAlpha:!1,stencil:!0};try{this.gl=this.view.getContext("experimental-webgl",this.options)}catch(l){try{this.gl=this.view.getContext("webgl",this.options)}catch(p){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}}var u=this.gl;this.glContextId=u.id=n.WebGLRenderer.glContextId++,n.glContexts[this.glContextId]=u,n.blendModesWebGL||(n.blendModesWebGL=[],n.blendModesWebGL[n.blendModes.NORMAL]=[u.ONE,u.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.ADD]=[u.SRC_ALPHA,u.DST_ALPHA],n.blendModesWebGL[n.blendModes.MULTIPLY]=[u.DST_COLOR,u.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.SCREEN]=[u.SRC_ALPHA,u.ONE]),this.projection=new n.Point,this.projection.x=this.width/2,this.projection.y=-this.height/2,this.offset=new n.Point(0,0),this.resize(this.width,this.height),this.contextLost=!1,this.shaderManager=new n.WebGLShaderManager(u),this.spriteBatch=new n.WebGLSpriteBatch(u),this.maskManager=new n.WebGLMaskManager(u),this.filterManager=new n.WebGLFilterManager(u,this.transparent),this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.spriteBatch=this.spriteBatch,u.useProgram(this.shaderManager.defaultShader.program),u.disable(u.DEPTH_TEST),u.disable(u.CULL_FACE),u.enable(u.BLEND),u.colorMask(!0,!0,!0,this.transparent)},n.WebGLRenderer.prototype.constructor=n.WebGLRenderer,n.WebGLRenderer.prototype.render=function(e){if(!this.contextLost){this.__stage!==e&&(this.__stage=e),n.WebGLRenderer.updateTextures(),e.updateTransform();var f=this.gl;f.colorMask(!0,!0,!0,this.transparent),f.viewport(0,0,this.width,this.height),f.bindFramebuffer(f.FRAMEBUFFER,null),f.clearColor(e.backgroundColorSplit[0],e.backgroundColorSplit[1],e.backgroundColorSplit[2],!this.transparent),f.clear(f.COLOR_BUFFER_BIT),this.renderDisplayObject(e,this.projection),e.interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this)))}},n.WebGLRenderer.prototype.renderDisplayObject=function(e,f){this.renderSession.drawCount=0,this.renderSession.currentBlendMode=9999,this.renderSession.projection=f,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,null),e._renderWebGL(this.renderSession),this.spriteBatch.end()},n.WebGLRenderer.updateTextures=function(){var e=0;for(e=0;e<n.Texture.frameUpdates.length;e++)n.WebGLRenderer.updateTextureFrame(n.Texture.frameUpdates[e]);for(e=0;e<n.texturesToDestroy.length;e++)n.WebGLRenderer.destroyTexture(n.texturesToDestroy[e]);n.texturesToUpdate.length=0,n.texturesToDestroy.length=0,n.Texture.frameUpdates.length=0},n.WebGLRenderer.destroyTexture=function(e){for(var f=e._glTextures.length-1;f>=0;f--){var o=e._glTextures[f],d=n.glContexts[f];d&&o&&d.deleteTexture(o)}e._glTextures.length=0},n.WebGLRenderer.updateTextureFrame=function(e){e.updateFrame=!1,e._updateWebGLuvs()},n.WebGLRenderer.prototype.resize=function(e,f){this.width=e,this.height=f,this.view.width=e,this.view.height=f,this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2,this.projection.y=-this.height/2},n.createWebGLTexture=function(e,f){return e.hasLoaded&&(e._glTextures[f.id]=f.createTexture(),f.bindTexture(f.TEXTURE_2D,e._glTextures[f.id]),f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,e.source),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e.scaleMode===n.BaseTexture.SCALE_MODE.LINEAR?f.LINEAR:f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,e.scaleMode===n.BaseTexture.SCALE_MODE.LINEAR?f.LINEAR:f.NEAREST),e._powerOf2?(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT)):(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE)),f.bindTexture(f.TEXTURE_2D,null)),e._glTextures[f.id]},n.updateWebGLTexture=function(e,f){e._glTextures[f.id]&&(f.bindTexture(f.TEXTURE_2D,e._glTextures[f.id]),f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,e.source),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e.scaleMode===n.BaseTexture.SCALE_MODE.LINEAR?f.LINEAR:f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,e.scaleMode===n.BaseTexture.SCALE_MODE.LINEAR?f.LINEAR:f.NEAREST),e._powerOf2?(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT)):(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE)),f.bindTexture(f.TEXTURE_2D,null))},n.WebGLRenderer.prototype.handleContextLost=function(e){e.preventDefault(),this.contextLost=!0},n.WebGLRenderer.prototype.handleContextRestored=function(){try{this.gl=this.view.getContext("experimental-webgl",this.options)}catch(e){try{this.gl=this.view.getContext("webgl",this.options)}catch(f){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}}var o=this.gl;o.id=n.WebGLRenderer.glContextId++,this.shaderManager.setContext(o),this.spriteBatch.setContext(o),this.maskManager.setContext(o),this.filterManager.setContext(o),this.renderSession.gl=this.gl,o.disable(o.DEPTH_TEST),o.disable(o.CULL_FACE),o.enable(o.BLEND),o.colorMask(!0,!0,!0,this.transparent),this.gl.viewport(0,0,this.width,this.height);for(var d in n.TextureCache){var i=n.TextureCache[d].baseTexture;i._glTextures=[]}this.contextLost=!1},n.WebGLRenderer.glContextId=0,n.WebGLMaskManager=function(e){this.maskStack=[],this.maskPosition=0,this.setContext(e)},n.WebGLMaskManager.prototype.setContext=function(e){this.gl=e},n.WebGLMaskManager.prototype.pushMask=function(e,f){var o=this.gl;0===this.maskStack.length&&(o.enable(o.STENCIL_TEST),o.stencilFunc(o.ALWAYS,1,1)),this.maskStack.push(e),o.colorMask(!1,!1,!1,!0),o.stencilOp(o.KEEP,o.KEEP,o.INCR),n.WebGLGraphics.renderGraphics(e,f),o.colorMask(!0,!0,!0,!0),o.stencilFunc(o.NOTEQUAL,0,this.maskStack.length),o.stencilOp(o.KEEP,o.KEEP,o.KEEP)},n.WebGLMaskManager.prototype.popMask=function(e){var f=this.gl,o=this.maskStack.pop();o&&(f.colorMask(!1,!1,!1,!1),f.stencilOp(f.KEEP,f.KEEP,f.DECR),n.WebGLGraphics.renderGraphics(o,e),f.colorMask(!0,!0,!0,!0),f.stencilFunc(f.NOTEQUAL,0,this.maskStack.length),f.stencilOp(f.KEEP,f.KEEP,f.KEEP)),0===this.maskStack.length&&f.disable(f.STENCIL_TEST)},n.WebGLShaderManager=function(e){this.setContext(e)},n.WebGLShaderManager.prototype.setContext=function(e){this.gl=e,this.primitiveShader=new n.PrimitiveShader(e),this.defaultShader=new n.PixiShader(e);var f=this.defaultShader.program;e.useProgram(f),e.enableVertexAttribArray(this.defaultShader.aVertexPosition),e.enableVertexAttribArray(this.defaultShader.colorAttribute),e.enableVertexAttribArray(this.defaultShader.aTextureCoord)},n.WebGLShaderManager.prototype.activatePrimitiveShader=function(){var e=this.gl;e.useProgram(this.primitiveShader.program),e.disableVertexAttribArray(this.defaultShader.aVertexPosition),e.disableVertexAttribArray(this.defaultShader.colorAttribute),e.disableVertexAttribArray(this.defaultShader.aTextureCoord),e.enableVertexAttribArray(this.primitiveShader.aVertexPosition),e.enableVertexAttribArray(this.primitiveShader.colorAttribute)},n.WebGLShaderManager.prototype.deactivatePrimitiveShader=function(){var e=this.gl;e.useProgram(this.defaultShader.program),e.disableVertexAttribArray(this.primitiveShader.aVertexPosition),e.disableVertexAttribArray(this.primitiveShader.colorAttribute),e.enableVertexAttribArray(this.defaultShader.aVertexPosition),e.enableVertexAttribArray(this.defaultShader.colorAttribute),e.enableVertexAttribArray(this.defaultShader.aTextureCoord)},n.WebGLSpriteBatch=function(e){this.size=2e3,this.vertSize=6;var f=4*this.size*this.vertSize,n=6*this.size;this.vertices=new Float32Array(f),this.indices=new Uint16Array(n),this.lastIndexCount=0;for(var o=0,d=0;n>o;o+=6,d+=4)this.indices[o+0]=d+0,this.indices[o+1]=d+1,this.indices[o+2]=d+2,this.indices[o+3]=d+0,this.indices[o+4]=d+2,this.indices[o+5]=d+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.setContext(e)},n.WebGLSpriteBatch.prototype.setContext=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),this.currentBlendMode=99999},n.WebGLSpriteBatch.prototype.begin=function(e){this.renderSession=e,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},n.WebGLSpriteBatch.prototype.end=function(){this.flush()},n.WebGLSpriteBatch.prototype.render=function(e){(e.texture.baseTexture!==this.currentBaseTexture||this.currentBatchSize>=this.size)&&(this.flush(),this.currentBaseTexture=e.texture.baseTexture),e.blendMode!==this.currentBlendMode&&this.setBlendMode(e.blendMode);var f=e._uvs||e.texture._uvs;if(f){var n,o,d,i,t=e.worldAlpha,l=e.tint,p=this.vertices,u=e.texture.frame.width,s=e.texture.frame.height,c=e.anchor.x,y=e.anchor.y;if(e.texture.trimmed){var a=e.texture.trim;o=a.x-c*a.realWidth,n=o+u,i=a.y-y*a.realHeight,d=i+s}else n=u*(1-c),o=u*-c,d=s*(1-y),i=s*-y;var r=4*this.currentBatchSize*this.vertSize,w=e.worldTransform,b=w[0],g=w[3],m=w[1],x=w[4],j=w[2],v=w[5];p[r++]=b*o+m*i+j,p[r++]=x*i+g*o+v,p[r++]=f[0],p[r++]=f[1],p[r++]=t,p[r++]=l,p[r++]=b*n+m*i+j,p[r++]=x*i+g*n+v,p[r++]=f[2],p[r++]=f[3],p[r++]=t,p[r++]=l,p[r++]=b*n+m*d+j,p[r++]=x*d+g*n+v,p[r++]=f[4],p[r++]=f[5],p[r++]=t,p[r++]=l,p[r++]=b*o+m*d+j,p[r++]=x*d+g*o+v,p[r++]=f[6],p[r++]=f[7],p[r++]=t,p[r++]=l,this.currentBatchSize++}},n.WebGLSpriteBatch.prototype.renderTilingSprite=function(e){var f=e.tilingTexture;(f.baseTexture!==this.currentBaseTexture||this.currentBatchSize>=this.size)&&(this.flush(),this.currentBaseTexture=f.baseTexture),e.blendMode!==this.currentBlendMode&&this.setBlendMode(e.blendMode),e._uvs||(e._uvs=new Float32Array(8));var n=e._uvs,o=e.tilePosition.x/f.baseTexture.width,d=e.tilePosition.y/f.baseTexture.height,i=e.width/f.baseTexture.width/(e.tileScale.x*e.tileScaleOffset.x),t=e.height/f.baseTexture.height/(e.tileScale.y*e.tileScaleOffset.y);n[0]=0-o,n[1]=0-d,n[2]=1*i-o,n[3]=0-d,n[4]=1*i-o,n[5]=1*t-d,n[6]=0-o,n[7]=1*t-d;var l=e.worldAlpha,p=e.tint,u=this.vertices,s=e.width,c=e.height,y=e.anchor.x,a=e.anchor.y,r=s*(1-y),w=s*-y,b=c*(1-a),g=c*-a,m=4*this.currentBatchSize*this.vertSize,x=e.worldTransform,j=x[0],v=x[3],h=x[1],k=x[4],q=x[2],z=x[5];u[m++]=j*w+h*g+q,u[m++]=k*g+v*w+z,u[m++]=n[0],u[m++]=n[1],u[m++]=l,u[m++]=p,u[m++]=j*r+h*g+q,u[m++]=k*g+v*r+z,u[m++]=n[2],u[m++]=n[3],u[m++]=l,u[m++]=p,u[m++]=j*r+h*b+q,u[m++]=k*b+v*r+z,u[m++]=n[4],u[m++]=n[5],u[m++]=l,u[m++]=p,u[m++]=j*w+h*b+q,u[m++]=k*b+v*w+z,u[m++]=n[6],u[m++]=n[7],u[m++]=l,u[m++]=p,this.currentBatchSize++},n.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var e=this.gl;e.bindTexture(e.TEXTURE_2D,this.currentBaseTexture._glTextures[e.id]||n.createWebGLTexture(this.currentBaseTexture,e));var f=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);e.bufferSubData(e.ARRAY_BUFFER,0,f),e.drawElements(e.TRIANGLES,6*this.currentBatchSize,e.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},n.WebGLSpriteBatch.prototype.stop=function(){this.flush()},n.WebGLSpriteBatch.prototype.start=function(){var e=this.gl;e.activeTexture(e.TEXTURE0),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var f=this.renderSession.projection;e.uniform2f(this.shader.projectionVector,f.x,f.y);var o=4*this.vertSize;e.vertexAttribPointer(this.shader.aVertexPosition,2,e.FLOAT,!1,o,0),e.vertexAttribPointer(this.shader.aTextureCoord,2,e.FLOAT,!1,o,8),e.vertexAttribPointer(this.shader.colorAttribute,2,e.FLOAT,!1,o,16),this.currentBlendMode!==n.blendModes.NORMAL&&this.setBlendMode(n.blendModes.NORMAL)},n.WebGLSpriteBatch.prototype.setBlendMode=function(e){this.flush(),this.currentBlendMode=e;var f=n.blendModesWebGL[this.currentBlendMode];this.gl.blendFunc(f[0],f[1])},n.WebGLFilterManager=function(e,f){this.transparent=f,this.filterStack=[],this.offsetX=0,this.offsetY=0,this.setContext(e)},n.WebGLFilterManager.prototype.setContext=function(e){this.gl=e,this.texturePool=[],this.initShaderBuffers()},n.WebGLFilterManager.prototype.begin=function(e,f){this.renderSession=e,this.defaultShader=e.shaderManager.defaultShader;var n=this.renderSession.projection;this.width=2*n.x,this.height=2*-n.y,this.buffer=f},n.WebGLFilterManager.prototype.pushFilter=function(e){var f=this.gl,o=this.renderSession.projection,d=this.renderSession.offset;this.filterStack.push(e);var i=e.filterPasses[0];this.offsetX+=e.target.filterArea.x,this.offsetY+=e.target.filterArea.y;var t=this.texturePool.pop();t?t.resize(this.width,this.height):t=new n.FilterTexture(this.gl,this.width,this.height),f.bindTexture(f.TEXTURE_2D,t.texture),e.target.filterArea=e.target.getBounds();var l=e.target.filterArea,p=i.padding;l.x-=p,l.y-=p,l.width+=2*p,l.height+=2*p,l.x<0&&(l.x=0),l.width>this.width&&(l.width=this.width),l.y<0&&(l.y=0),l.height>this.height&&(l.height=this.height),f.bindFramebuffer(f.FRAMEBUFFER,t.frameBuffer),f.viewport(0,0,l.width,l.height),o.x=l.width/2,o.y=-l.height/2,d.x=-l.x,d.y=-l.y,f.uniform2f(this.defaultShader.projectionVector,l.width/2,-l.height/2),f.uniform2f(this.defaultShader.offsetVector,-l.x,-l.y),f.colorMask(!0,!0,!0,!0),f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT),e._glFilterTexture=t},n.WebGLFilterManager.prototype.popFilter=function(){var e=this.gl,f=this.filterStack.pop(),o=f.target.filterArea,d=f._glFilterTexture,i=this.renderSession.projection,t=this.renderSession.offset;if(f.filterPasses.length>1){e.viewport(0,0,o.width,o.height),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=o.height,this.vertexArray[2]=o.width,this.vertexArray[3]=o.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=o.width,this.vertexArray[7]=0,e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=o.width/this.width,this.uvArray[5]=o.height/this.height,this.uvArray[6]=o.width/this.width,this.uvArray[7]=o.height/this.height,e.bufferSubData(e.ARRAY_BUFFER,0,this.uvArray);var l=d,p=this.texturePool.pop();p||(p=new n.FilterTexture(this.gl,this.width,this.height)),e.bindFramebuffer(e.FRAMEBUFFER,p.frameBuffer),e.clear(e.COLOR_BUFFER_BIT),e.disable(e.BLEND);for(var u=0;u<f.filterPasses.length-1;u++){var s=f.filterPasses[u];e.bindFramebuffer(e.FRAMEBUFFER,p.frameBuffer),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,l.texture),this.applyFilterPass(s,o,o.width,o.height);var c=l;l=p,p=c}e.enable(e.BLEND),d=l,this.texturePool.push(p)}var y=f.filterPasses[f.filterPasses.length-1];this.offsetX-=o.x,this.offsetY-=o.y;var a=this.width,r=this.height,w=0,b=0,g=this.buffer;if(0===this.filterStack.length)e.colorMask(!0,!0,!0,this.transparent);else{var m=this.filterStack[this.filterStack.length-1];o=m.target.filterArea,a=o.width,r=o.height,w=o.x,b=o.y,g=m._glFilterTexture.frameBuffer}i.x=a/2,i.y=-r/2,t.x=w,t.y=b,o=f.target.filterArea;var x=o.x-w,j=o.y-b;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=x,this.vertexArray[1]=j+o.height,this.vertexArray[2]=x+o.width,this.vertexArray[3]=j+o.height,this.vertexArray[4]=x,this.vertexArray[5]=j,this.vertexArray[6]=x+o.width,this.vertexArray[7]=j,e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=o.width/this.width,this.uvArray[5]=o.height/this.height,this.uvArray[6]=o.width/this.width,this.uvArray[7]=o.height/this.height,e.bufferSubData(e.ARRAY_BUFFER,0,this.uvArray),e.viewport(0,0,a,r),e.bindFramebuffer(e.FRAMEBUFFER,g),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,d.texture),this.applyFilterPass(y,o,a,r),e.useProgram(this.defaultShader.program),e.uniform2f(this.defaultShader.projectionVector,a/2,-r/2),e.uniform2f(this.defaultShader.offsetVector,-w,-b),this.texturePool.push(d),f._glFilterTexture=null},n.WebGLFilterManager.prototype.applyFilterPass=function(e,f,o,d){var i=this.gl,t=e.shaders[i.id];t||(t=new n.PixiShader(i),t.fragmentSrc=e.fragmentSrc,t.uniforms=e.uniforms,t.init(),e.shaders[i.id]=t),i.useProgram(t.program),i.uniform2f(t.projectionVector,o/2,-d/2),i.uniform2f(t.offsetVector,0,0),e.uniforms.dimensions&&(e.uniforms.dimensions.value[0]=this.width,e.uniforms.dimensions.value[1]=this.height,e.uniforms.dimensions.value[2]=this.vertexArray[0],e.uniforms.dimensions.value[3]=this.vertexArray[5]),t.syncUniforms(),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),i.vertexAttribPointer(t.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this.uvBuffer),i.vertexAttribPointer(t.aTextureCoord,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this.colorBuffer),i.vertexAttribPointer(t.colorAttribute,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0),this.renderSession.drawCount++},n.WebGLFilterManager.prototype.initShaderBuffers=function(){var e=this.gl;this.vertexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.STATIC_DRAW),this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvArray,e.STATIC_DRAW),this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colorArray,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),e.STATIC_DRAW)},n.FilterTexture=function(e,f,n){this.gl=e,this.frameBuffer=e.createFramebuffer(),this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),
e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),this.resize(f,n)},n.FilterTexture.prototype.clear=function(){var e=this.gl;e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)},n.FilterTexture.prototype.resize=function(e,f){if(this.width!==e||this.height!==f){this.width=e,this.height=f;var n=this.gl;n.bindTexture(n.TEXTURE_2D,this.texture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,f,0,n.RGBA,n.UNSIGNED_BYTE,null)}},n.CanvasMaskManager=function(){},n.CanvasMaskManager.prototype.pushMask=function(e,f){f.save();var o=e.alpha,d=e.worldTransform;f.setTransform(d[0],d[3],d[1],d[4],d[2],d[5]),n.CanvasGraphics.renderGraphicsMask(e,f),f.clip(),e.worldAlpha=o},n.CanvasMaskManager.prototype.popMask=function(e){e.restore()},n.CanvasTinter=function(){},n.CanvasTinter.getTintedTexture=function(e,f){var o=e.texture;f=n.CanvasTinter.roundColor(f);var d="#"+("00000"+(0|f).toString(16)).substr(-6);if(o.tintCache=o.tintCache||{},o.tintCache[d])return o.tintCache[d];var i=n.CanvasTinter.canvas||document.createElement("canvas");if(n.CanvasTinter.tintMethod(o,f,i),n.CanvasTinter.convertTintToImage){var t=new Image;t.src=i.toDataURL(),o.tintCache[d]=t}else o.tintCache[d]=i,n.CanvasTinter.canvas=null;return i},n.CanvasTinter.tintWithMultiply=function(e,f,n){var o=n.getContext("2d"),d=e.frame;n.width=d.width,n.height=d.height,o.fillStyle="#"+("00000"+(0|f).toString(16)).substr(-6),o.fillRect(0,0,d.width,d.height),o.globalCompositeOperation="multiply",o.drawImage(e.baseTexture.source,d.x,d.y,d.width,d.height,0,0,d.width,d.height),o.globalCompositeOperation="destination-atop",o.drawImage(e.baseTexture.source,d.x,d.y,d.width,d.height,0,0,d.width,d.height)},n.CanvasTinter.tintWithOverlay=function(e,f,n){var o=n.getContext("2d"),d=e.frame;n.width=d.width,n.height=d.height,o.globalCompositeOperation="copy",o.fillStyle="#"+("00000"+(0|f).toString(16)).substr(-6),o.fillRect(0,0,d.width,d.height),o.globalCompositeOperation="destination-atop",o.drawImage(e.baseTexture.source,d.x,d.y,d.width,d.height,0,0,d.width,d.height)},n.CanvasTinter.tintWithPerPixel=function(e,f,o){var d=o.getContext("2d"),i=e.frame;o.width=i.width,o.height=i.height,d.globalCompositeOperation="copy",d.drawImage(e.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height);for(var t=n.hex2rgb(f),l=t[0],p=t[1],u=t[2],s=d.getImageData(0,0,i.width,i.height),c=s.data,y=0;y<c.length;y+=4)c[y+0]*=l,c[y+1]*=p,c[y+2]*=u;d.putImageData(s,0,0)},n.CanvasTinter.roundColor=function(e){var f=n.CanvasTinter.cacheStepsPerColorChannel,o=n.hex2rgb(e);return o[0]=Math.min(255,Math.round(o[0]/f)*f),o[1]=Math.min(255,Math.round(o[1]/f)*f),o[2]=Math.min(255,Math.round(o[2]/f)*f),n.rgb2hex(o)},n.CanvasTinter.cacheStepsPerColorChannel=8,n.CanvasTinter.convertTintToImage=!1,n.CanvasTinter.canUseMultiply=n.canUseNewCanvasBlendModes(),n.CanvasTinter.tintMethod=n.CanvasTinter.canUseMultiply?n.CanvasTinter.tintWithMultiply:n.CanvasTinter.tintWithPerPixel,n.CanvasRenderer=function(e,f,o,d){n.defaultRenderer=n.defaultRenderer||this,this.type=n.CANVAS_RENDERER,this.transparent=d,n.blendModesCanvas||(n.blendModesCanvas=[],n.canUseNewCanvasBlendModes()?(n.blendModesCanvas[n.blendModes.NORMAL]="source-over",n.blendModesCanvas[n.blendModes.ADD]="lighter",n.blendModesCanvas[n.blendModes.MULTIPLY]="multiply",n.blendModesCanvas[n.blendModes.SCREEN]="screen"):(n.blendModesCanvas[n.blendModes.NORMAL]="source-over",n.blendModesCanvas[n.blendModes.ADD]="lighter",n.blendModesCanvas[n.blendModes.MULTIPLY]="source-over",n.blendModesCanvas[n.blendModes.SCREEN]="source-over")),this.width=e||800,this.height=f||600,this.view=o||document.createElement("canvas"),this.context=this.view.getContext("2d"),this.smoothProperty=null,"imageSmoothingEnabled"in this.context?this.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context&&(this.smoothProperty="oImageSmoothingEnabled"),this.scaleMode=null,this.refresh=!0,this.view.width=this.width,this.view.height=this.height,this.count=0,this.maskManager=new n.CanvasMaskManager,this.renderSession={},this.renderSession.context=this.context,this.renderSession.maskManager=this.maskManager},n.CanvasRenderer.prototype.constructor=n.CanvasRenderer,n.CanvasRenderer.prototype.render=function(e){n.texturesToUpdate.length=0,n.texturesToDestroy.length=0,e.updateTransform(),this.view.style.backgroundColor===e.backgroundColorString||this.transparent||(this.view.style.backgroundColor=e.backgroundColorString),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height),this.renderDisplayObject(e),e.interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this))),n.Texture.frameUpdates.length>0&&(n.Texture.frameUpdates.length=0)},n.CanvasRenderer.prototype.resize=function(e,f){this.width=e,this.height=f,this.view.width=e,this.view.height=f},n.CanvasRenderer.prototype.renderDisplayObject=function(e,f){this.renderSession.context=f||this.context,e._renderCanvas(this.renderSession)},n.CanvasRenderer.prototype.renderStripFlat=function(e){var f=this.context,n=e.verticies,o=n.length/2;this.count++,f.beginPath();for(var d=1;o-2>d;d++){var i=2*d,t=n[i],l=n[i+2],p=n[i+4],u=n[i+1],s=n[i+3],c=n[i+5];f.moveTo(t,u),f.lineTo(l,s),f.lineTo(p,c)}f.fillStyle="#FF0000",f.fill(),f.closePath()},n.CanvasRenderer.prototype.renderStrip=function(e){var f=this.context,n=e.verticies,o=e.uvs,d=n.length/2;this.count++;for(var i=1;d-2>i;i++){var t=2*i,l=n[t],p=n[t+2],u=n[t+4],s=n[t+1],c=n[t+3],y=n[t+5],a=o[t]*e.texture.width,r=o[t+2]*e.texture.width,w=o[t+4]*e.texture.width,b=o[t+1]*e.texture.height,g=o[t+3]*e.texture.height,m=o[t+5]*e.texture.height;f.save(),f.beginPath(),f.moveTo(l,s),f.lineTo(p,c),f.lineTo(u,y),f.closePath(),f.clip();var x=a*g+b*w+r*m-g*w-b*r-a*m,j=l*g+b*u+p*m-g*u-b*p-l*m,v=a*p+l*w+r*u-p*w-l*r-a*u,h=a*g*u+b*p*w+l*r*m-l*g*w-b*r*u-a*p*m,k=s*g+b*y+c*m-g*y-b*c-s*m,q=a*c+s*w+r*y-c*w-s*r-a*y,z=a*g*y+b*c*w+s*r*m-s*g*w-b*r*y-a*c*m;f.transform(j/x,k/x,v/x,q/x,h/x,z/x),f.drawImage(e.texture.baseTexture.source,0,0),f.restore()}},n.CanvasBuffer=function(e,f){this.width=e,this.height=f,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=e,this.canvas.height=f},n.CanvasBuffer.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},n.CanvasBuffer.prototype.resize=function(e,f){this.width=this.canvas.width=e,this.height=this.canvas.height=f},n.CanvasGraphics=function(){},n.CanvasGraphics.renderGraphics=function(e,f){for(var o=e.worldAlpha,d="",i=0;i<e.graphicsData.length;i++){var t=e.graphicsData[i],l=t.points;if(f.strokeStyle=d="#"+("00000"+(0|t.lineColor).toString(16)).substr(-6),f.lineWidth=t.lineWidth,t.type===n.Graphics.POLY){f.beginPath(),f.moveTo(l[0],l[1]);for(var p=1;p<l.length/2;p++)f.lineTo(l[2*p],l[2*p+1]);l[0]===l[l.length-2]&&l[1]===l[l.length-1]&&f.closePath(),t.fill&&(f.globalAlpha=t.fillAlpha*o,f.fillStyle=d="#"+("00000"+(0|t.fillColor).toString(16)).substr(-6),f.fill()),t.lineWidth&&(f.globalAlpha=t.lineAlpha*o,f.stroke())}else if(t.type===n.Graphics.RECT)(t.fillColor||0===t.fillColor)&&(f.globalAlpha=t.fillAlpha*o,f.fillStyle=d="#"+("00000"+(0|t.fillColor).toString(16)).substr(-6),f.fillRect(l[0],l[1],l[2],l[3])),t.lineWidth&&(f.globalAlpha=t.lineAlpha*o,f.strokeRect(l[0],l[1],l[2],l[3]));else if(t.type===n.Graphics.CIRC)f.beginPath(),f.arc(l[0],l[1],l[2],0,2*Math.PI),f.closePath(),t.fill&&(f.globalAlpha=t.fillAlpha*o,f.fillStyle=d="#"+("00000"+(0|t.fillColor).toString(16)).substr(-6),f.fill()),t.lineWidth&&(f.globalAlpha=t.lineAlpha*o,f.stroke());else if(t.type===n.Graphics.ELIP){var u=t.points,s=2*u[2],c=2*u[3],y=u[0]-s/2,a=u[1]-c/2;f.beginPath();var r=.5522848,w=s/2*r,b=c/2*r,g=y+s,m=a+c,x=y+s/2,j=a+c/2;f.moveTo(y,j),f.bezierCurveTo(y,j-b,x-w,a,x,a),f.bezierCurveTo(x+w,a,g,j-b,g,j),f.bezierCurveTo(g,j+b,x+w,m,x,m),f.bezierCurveTo(x-w,m,y,j+b,y,j),f.closePath(),t.fill&&(f.globalAlpha=t.fillAlpha*o,f.fillStyle=d="#"+("00000"+(0|t.fillColor).toString(16)).substr(-6),f.fill()),t.lineWidth&&(f.globalAlpha=t.lineAlpha*o,f.stroke())}}},n.CanvasGraphics.renderGraphicsMask=function(e,f){var o=e.graphicsData.length;if(0!==o){o>1&&(o=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var d=0;1>d;d++){var i=e.graphicsData[d],t=i.points;if(i.type===n.Graphics.POLY){f.beginPath(),f.moveTo(t[0],t[1]);for(var l=1;l<t.length/2;l++)f.lineTo(t[2*l],t[2*l+1]);t[0]===t[t.length-2]&&t[1]===t[t.length-1]&&f.closePath()}else if(i.type===n.Graphics.RECT)f.beginPath(),f.rect(t[0],t[1],t[2],t[3]),f.closePath();else if(i.type===n.Graphics.CIRC)f.beginPath(),f.arc(t[0],t[1],t[2],0,2*Math.PI),f.closePath();else if(i.type===n.Graphics.ELIP){var p=i.points,u=2*p[2],s=2*p[3],c=p[0]-u/2,y=p[1]-s/2;f.beginPath();var a=.5522848,r=u/2*a,w=s/2*a,b=c+u,g=y+s,m=c+u/2,x=y+s/2;f.moveTo(c,x),f.bezierCurveTo(c,x-w,m-r,y,m,y),f.bezierCurveTo(m+r,y,b,x-w,b,x),f.bezierCurveTo(b,x+w,m+r,g,m,g),f.bezierCurveTo(m-r,g,c,x+w,c,x),f.closePath()}}}},n.Graphics=function(){n.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor="black",this.graphicsData=[],this.tint=16777215,this.blendMode=n.blendModes.NORMAL,this.currentPath={points:[]},this._webGL=[],this.isMask=!1,this.bounds=null,this.boundsPadding=10},n.Graphics.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Graphics.prototype.constructor=n.Graphics,Object.defineProperty(n.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(e){this._cacheAsBitmap=e,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),n.Graphics.prototype.lineStyle=function(e,f,o){this.currentPath.points.length||this.graphicsData.pop(),this.lineWidth=e||0,this.lineColor=f||0,this.lineAlpha=arguments.length<3?1:o,this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:n.Graphics.POLY},this.graphicsData.push(this.currentPath)},n.Graphics.prototype.moveTo=function(e,f){this.currentPath.points.length||this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:n.Graphics.POLY},this.currentPath.points.push(e,f),this.graphicsData.push(this.currentPath)},n.Graphics.prototype.lineTo=function(e,f){this.currentPath.points.push(e,f),this.dirty=!0},n.Graphics.prototype.beginFill=function(e,f){this.filling=!0,this.fillColor=e||0,this.fillAlpha=arguments.length<2?1:f},n.Graphics.prototype.endFill=function(){this.filling=!1,this.fillColor=null,this.fillAlpha=1},n.Graphics.prototype.drawRect=function(e,f,o,d){this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,f,o,d],type:n.Graphics.RECT},this.graphicsData.push(this.currentPath),this.dirty=!0},n.Graphics.prototype.drawCircle=function(e,f,o){this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,f,o,o],type:n.Graphics.CIRC},this.graphicsData.push(this.currentPath),this.dirty=!0},n.Graphics.prototype.drawEllipse=function(e,f,o,d){this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[e,f,o,d],type:n.Graphics.ELIP},this.graphicsData.push(this.currentPath),this.dirty=!0},n.Graphics.prototype.clear=function(){this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this.bounds=null},n.Graphics.prototype.generateTexture=function(){var e=this.getBounds(),f=new n.CanvasBuffer(e.width,e.height),o=n.Texture.fromCanvas(f.canvas);return f.context.translate(-e.x,-e.y),n.CanvasGraphics.renderGraphics(this,f.context),o},n.Graphics.prototype._renderWebGL=function(e){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return this.dirty&&(this._generateCachedSprite(),n.updateWebGLTexture(this._cachedSprite.texture.baseTexture,e.gl),this.dirty=!1),void n.Sprite.prototype._renderWebGL.call(this._cachedSprite,e);if(e.spriteBatch.stop(),this._mask&&e.maskManager.pushMask(this.mask,e),this._filters&&e.filterManager.pushFilter(this._filterBlock),this.blendMode!==e.spriteBatch.currentBlendMode){this.spriteBatch.currentBlendMode=this.blendMode;var f=n.blendModesWebGL[e.spriteBatch.currentBlendMode];this.spriteBatch.gl.blendFunc(f[0],f[1])}if(n.WebGLGraphics.renderGraphics(this,e),this.children.length){e.spriteBatch.start();for(var o=0,d=this.children.length;d>o;o++)this.children[o]._renderWebGL(e);e.spriteBatch.stop()}this._filters&&e.filterManager.popFilter(),this._mask&&e.maskManager.popMask(e),e.drawCount++,e.spriteBatch.start()}},n.Graphics.prototype._renderCanvas=function(e){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){var f=e.context,o=this.worldTransform;this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,f.globalCompositeOperation=n.blendModesCanvas[e.currentBlendMode]),f.setTransform(o[0],o[3],o[1],o[4],o[2],o[5]),n.CanvasGraphics.renderGraphics(this,f);for(var d=0,i=this.children.length;i>d;d++)this.children[d]._renderCanvas(e)}},n.Graphics.prototype.getBounds=function(){this.bounds||this.updateBounds();var e=this.bounds.x,f=this.bounds.width+this.bounds.x,n=this.bounds.y,o=this.bounds.height+this.bounds.y,d=this.worldTransform,i=d[0],t=d[3],l=d[1],p=d[4],u=d[2],s=d[5],c=i*f+l*o+u,y=p*o+t*f+s,a=i*e+l*o+u,r=p*o+t*e+s,w=i*e+l*n+u,b=p*n+t*e+s,g=i*f+l*n+u,m=p*n+t*f+s,x=-(1/0),j=-(1/0),v=1/0,h=1/0;v=v>c?c:v,v=v>a?a:v,v=v>w?w:v,v=v>g?g:v,h=h>y?y:h,h=h>r?r:h,h=h>b?b:h,h=h>m?m:h,x=c>x?c:x,x=a>x?a:x,x=w>x?w:x,x=g>x?g:x,j=y>j?y:j,j=r>j?r:j,j=b>j?b:j,j=m>j?m:j;var k=this._bounds;return k.x=v,k.width=x-v,k.y=h,k.height=j-h,k},n.Graphics.prototype.updateBounds=function(){for(var e,f,o,d=1/0,i=-(1/0),t=1/0,l=-(1/0),p=0;p<this.graphicsData.length;p++){var u=this.graphicsData[p],s=u.type,c=u.lineWidth;if(e=u.points,s===n.Graphics.RECT){f=e.x-c/2,o=e.y-c/2;var y=e.width+c,a=e.height+c;d=d>f?f:d,i=f+y>i?f+y:i,t=t>o?f:t,l=o+a>l?o+a:l}else if(s===n.Graphics.CIRC||s===n.Graphics.ELIP){f=e.x,o=e.y;var r=e.radius+c/2;d=d>f-r?f-r:d,i=f+r>i?f+r:i,t=t>o-r?o-r:t,l=o+r>l?o+r:l}else for(var w=0;w<e.length;w+=2)f=e[w],o=e[w+1],d=d>f-c?f-c:d,i=f+c>i?f+c:i,t=t>o-c?o-c:t,l=o+c>l?o+c:l}var b=this.boundsPadding;this.bounds=new n.Rectangle(d-b,t-b,i-d+2*b,l-t+2*b)},n.Graphics.prototype._generateCachedSprite=function(){var e=this.getBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(e.width,e.height);else{var f=new n.CanvasBuffer(e.width,e.height),o=n.Texture.fromCanvas(f.canvas);this._cachedSprite=new n.Sprite(o),this._cachedSprite.buffer=f,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-(e.x/e.width),this._cachedSprite.anchor.y=-(e.y/e.height),this._cachedSprite.buffer.context.translate(-e.x,-e.y),n.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context)},n.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},n.Graphics.POLY=0,n.Graphics.RECT=1,n.Graphics.CIRC=2,n.Graphics.ELIP=3,n.Strip=function(e,f,o){n.DisplayObjectContainer.call(this),this.texture=e,this.blendMode=n.blendModes.NORMAL;try{this.uvs=new Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new Float32Array([0,0,0,0,0,0,0,0,0]),this.colors=new Float32Array([1,1,1,1]),this.indices=new Uint16Array([0,1,2,3])}catch(d){this.uvs=[0,1,1,1,1,0,0,1],this.verticies=[0,0,0,0,0,0,0,0,0],this.colors=[1,1,1,1],this.indices=[0,1,2,3]}this.width=f,this.height=o,e.baseTexture.hasLoaded?(this.width=this.texture.frame.width,this.height=this.texture.frame.height,this.updateFrame=!0):(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},n.Strip.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Strip.prototype.constructor=n.Strip,n.Strip.prototype.setTexture=function(e){this.texture=e,this.width=e.frame.width,this.height=e.frame.height,this.updateFrame=!0},n.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},n.Rope=function(e,f){n.Strip.call(this,e),this.points=f;try{this.verticies=new Float32Array(4*f.length),this.uvs=new Float32Array(4*f.length),this.colors=new Float32Array(2*f.length),this.indices=new Uint16Array(2*f.length)}catch(o){this.verticies=new Array(4*f.length),this.uvs=new Array(4*f.length),this.colors=new Array(2*f.length),this.indices=new Array(2*f.length)}this.refresh()},n.Rope.prototype=Object.create(n.Strip.prototype),n.Rope.prototype.constructor=n.Rope,n.Rope.prototype.refresh=function(){var e=this.points;if(!(e.length<1)){var f=this.uvs,n=e[0],o=this.indices,d=this.colors;this.count-=.2,f[0]=0,f[1]=1,f[2]=0,f[3]=1,d[0]=1,d[1]=1,o[0]=0,o[1]=1;for(var i,t,l,p=e.length,u=1;p>u;u++)i=e[u],t=4*u,l=u/(p-1),u%2?(f[t]=l,f[t+1]=0,f[t+2]=l,f[t+3]=1):(f[t]=l,f[t+1]=0,f[t+2]=l,f[t+3]=1),t=2*u,d[t]=1,d[t+1]=1,t=2*u,o[t]=t,o[t+1]=t+1,n=i}},n.Rope.prototype.updateTransform=function(){var e=this.points;if(!(e.length<1)){var f,o=e[0],d={x:0,y:0};this.count-=.2;var i=this.verticies;i[0]=o.x+d.x,i[1]=o.y+d.y,i[2]=o.x-d.x,i[3]=o.y-d.y;for(var t,l,p,u,s,c=e.length,y=1;c>y;y++)t=e[y],l=4*y,f=y<e.length-1?e[y+1]:t,d.y=-(f.x-o.x),d.x=f.y-o.y,p=10*(1-y/(c-1)),p>1&&(p=1),u=Math.sqrt(d.x*d.x+d.y*d.y),s=this.texture.height/2,d.x/=u,d.y/=u,d.x*=s,d.y*=s,i[l]=t.x+d.x,i[l+1]=t.y+d.y,i[l+2]=t.x-d.x,i[l+3]=t.y-d.y,o=t;n.DisplayObjectContainer.prototype.updateTransform.call(this)}},n.Rope.prototype.setTexture=function(e){this.texture=e,this.updateFrame=!0},n.TilingSprite=function(e,f,o){n.Sprite.call(this,e),this.width=f||100,this.height=o||100,this.tileScale=new n.Point(1,1),this.tileScaleOffset=new n.Point(1,1),this.tilePosition=new n.Point(0,0),this.renderable=!0,this.tint=16777215,this.blendMode=n.blendModes.NORMAL},n.TilingSprite.prototype=Object.create(n.Sprite.prototype),n.TilingSprite.prototype.constructor=n.TilingSprite,Object.defineProperty(n.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e}}),Object.defineProperty(n.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e}}),n.TilingSprite.prototype.onTextureUpdate=function(){this.updateFrame=!0},n.TilingSprite.prototype._renderWebGL=function(e){if(this.visible!==!1&&0!==this.alpha){var f,n;if(this.mask||this.filters){for(this.mask&&(e.spriteBatch.stop(),e.maskManager.pushMask(this.mask,e.projection),e.spriteBatch.start()),this.filters&&(e.spriteBatch.flush(),e.filterManager.pushFilter(this._filterBlock)),this.tilingTexture?e.spriteBatch.renderTilingSprite(this):this.generateTilingTexture(!0),f=0,n=this.children.length;n>f;f++)this.children[f]._renderWebGL(e);e.spriteBatch.stop(),this.filters&&e.filterManager.popFilter(),this.mask&&e.maskManager.popMask(e.projection),e.spriteBatch.start()}else for(this.tilingTexture?e.spriteBatch.renderTilingSprite(this):this.generateTilingTexture(!0),f=0,n=this.children.length;n>f;f++)this.children[f]._renderWebGL(e)}},n.TilingSprite.prototype._renderCanvas=function(e){if(this.visible!==!1&&0!==this.alpha){var f=e.context;f.globalAlpha=this.worldAlpha;var o=this.worldTransform;f.setTransform(o[0],o[3],o[1],o[4],o[2],o[5]),this.__tilePattern||(this.generateTilingTexture(!1),this.tilingTexture&&(this.__tilePattern=f.createPattern(this.tilingTexture.baseTexture.source,"repeat"))),this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,f.globalCompositeOperation=n.blendModesCanvas[e.currentBlendMode]),f.beginPath();var d=this.tilePosition.x%this.tilingTexture.width,i=this.tilePosition.y%this.tilingTexture.height,t=this.tileScale;f.scale(t.x,t.y),f.translate(d,i),f.fillStyle=this.__tilePattern,f.fillRect(-d,-i,this.width/t.x,this.height/t.y),f.scale(1/t.x,1/t.y),f.translate(-d,-i),f.closePath()}},n.TilingSprite.prototype.getBounds=function(){var e=this._width,f=this._height,n=e*(1-this.anchor.x),o=e*-this.anchor.x,d=f*(1-this.anchor.y),i=f*-this.anchor.y,t=this.worldTransform,l=t[0],p=t[3],u=t[1],s=t[4],c=t[2],y=t[5],a=l*o+u*i+c,r=s*i+p*o+y,w=l*n+u*i+c,b=s*i+p*n+y,g=l*n+u*d+c,m=s*d+p*n+y,x=l*o+u*d+c,j=s*d+p*o+y,v=-(1/0),h=-(1/0),k=1/0,q=1/0;k=k>a?a:k,k=k>w?w:k,k=k>g?g:k,k=k>x?x:k,q=q>r?r:q,q=q>b?b:q,q=q>m?m:q,q=q>j?j:q,v=a>v?a:v,v=w>v?w:v,v=g>v?g:v,v=x>v?x:v,h=r>h?r:h,h=b>h?b:h,h=m>h?m:h,h=j>h?j:h;var z=this._bounds;return z.x=k,z.width=v-k,z.y=q,z.height=h-q,this._currentBounds=z,z},n.TilingSprite.prototype.generateTilingTexture=function(e){var f=this.texture;if(f.baseTexture.hasLoaded){var o,d,i=f.baseTexture,t=f.frame,l=t.width!==i.width||t.height!==i.height;this.tilingTexture=f;var p=!1;if(e?(o=n.getNextPowerOfTwo(f.frame.width),d=n.getNextPowerOfTwo(f.frame.height),t.width!==o&&t.height!==d&&(p=!0)):l&&(o=t.width,d=t.height,p=!0),p){var u=new n.CanvasBuffer(o,d);u.context.drawImage(f.baseTexture.source,t.x,t.y,t.width,t.height,0,0,o,d),this.tilingTexture=n.Texture.fromCanvas(u.canvas),this.tileScaleOffset.x=t.width/o,this.tileScaleOffset.y=t.height/d}this.tilingTexture.baseTexture._powerOf2=!0}};var t={};t.BoneData=function(e,f){this.name=e,this.parent=f},t.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1},t.SlotData=function(e,f){this.name=e,this.boneData=f},t.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null},t.Bone=function(e,f){this.data=e,this.parent=f,this.setToSetupPose()},t.Bone.yDown=!1,t.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(e,f){var n=this.parent;null!=n?(this.worldX=this.x*n.m00+this.y*n.m01+n.worldX,this.worldY=this.x*n.m10+this.y*n.m11+n.worldY,this.worldScaleX=n.worldScaleX*this.scaleX,this.worldScaleY=n.worldScaleY*this.scaleY,this.worldRotation=n.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var o=this.worldRotation*Math.PI/180,d=Math.cos(o),i=Math.sin(o);this.m00=d*this.worldScaleX,this.m10=i*this.worldScaleX,this.m01=-i*this.worldScaleY,this.m11=d*this.worldScaleY,e&&(this.m00=-this.m00,this.m01=-this.m01),f&&(this.m10=-this.m10,this.m11=-this.m11),t.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var e=this.data;this.x=e.x,this.y=e.y,this.rotation=e.rotation,this.scaleX=e.scaleX,this.scaleY=e.scaleY}},t.Slot=function(e,f,n){this.data=e,this.skeleton=f,this.bone=n,this.setToSetupPose()},t.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(e){this.attachment=e,this._attachmentTime=this.skeleton.time},setAttachmentTime:function(e){this._attachmentTime=this.skeleton.time-e},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var e=this.data;this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a;for(var f=this.skeleton.data.slots,n=0,o=f.length;o>n;n++)if(f[n]==e){this.setAttachment(e.attachmentName?this.skeleton.getAttachmentBySlotIndex(n,e.attachmentName):null);break}}},t.Skin=function(e){this.name=e,this.attachments={}},t.Skin.prototype={addAttachment:function(e,f,n){this.attachments[e+":"+f]=n},getAttachment:function(e,f){return this.attachments[e+":"+f]},_attachAll:function(e,f){for(var n in f.attachments){var o=n.indexOf(":"),d=parseInt(n.substring(0,o),10),i=n.substring(o+1),t=e.slots[d];if(t.attachment&&t.attachment.name==i){var l=this.getAttachment(d,i);l&&t.setAttachment(l)}}}},t.Animation=function(e,f,n){this.name=e,this.timelines=f,this.duration=n},t.Animation.prototype={apply:function(e,f,n){n&&this.duration&&(f%=this.duration);for(var o=this.timelines,d=0,i=o.length;i>d;d++)o[d].apply(e,f,1)},mix:function(e,f,n,o){n&&this.duration&&(f%=this.duration);for(var d=this.timelines,i=0,t=d.length;t>i;i++)d[i].apply(e,f,o)}},t.binarySearch=function(e,f,n){var o=0,d=Math.floor(e.length/n)-2;if(!d)return n;for(var i=d>>>1;;){if(e[(i+1)*n]<=f?o=i+1:d=i,o==d)return(o+1)*n;i=o+d>>>1}},t.linearSearch=function(e,f,n){for(var o=0,d=e.length-n;d>=o;o+=n)if(e[o]>f)return o;return-1},t.Curves=function(e){this.curves=[],this.curves.length=6*(e-1)},t.Curves.prototype={setLinear:function(e){this.curves[6*e]=0},setStepped:function(e){this.curves[6*e]=-1},setCurve:function(e,f,n,o,d){var i=.1,t=i*i,l=t*i,p=3*i,u=3*t,s=6*t,c=6*l,y=2*-f+o,a=2*-n+d,r=3*(f-o)+1,w=3*(n-d)+1,b=6*e,g=this.curves;g[b]=f*p+y*u+r*l,g[b+1]=n*p+a*u+w*l,g[b+2]=y*s+r*c,g[b+3]=a*s+w*c,g[b+4]=r*c,g[b+5]=w*c},getCurvePercent:function(e,f){f=0>f?0:f>1?1:f;var n=6*e,o=this.curves,d=o[n];if(!d)return f;if(-1==d)return 0;for(var i=o[n+1],t=o[n+2],l=o[n+3],p=o[n+4],u=o[n+5],s=d,c=i,y=8;;){if(s>=f){var a=s-d,r=c-i;return r+(c-r)*(f-a)/(s-a)}if(!y)break;y--,d+=t,i+=l,t+=p,l+=u,s+=d,c+=i}return c+(1-c)*(f-s)/(1-s)}},t.RotateTimeline=function(e){this.curves=new t.Curves(e),this.frames=[],this.frames.length=2*e},t.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(e,f,n){e*=2,this.frames[e]=f,this.frames[e+1]=n},apply:function(e,f,n){var o,d=this.frames;if(!(f<d[0])){var i=e.bones[this.boneIndex];if(f>=d[d.length-2]){for(o=i.data.rotation+d[d.length-1]-i.rotation;o>180;)o-=360;for(;-180>o;)o+=360;return void(i.rotation+=o*n)}var l=t.binarySearch(d,f,2),p=d[l-1],u=d[l],s=1-(f-u)/(d[l-2]-u);for(s=this.curves.getCurvePercent(l/2-1,s),o=d[l+1]-p;o>180;)o-=360;for(;-180>o;)o+=360;for(o=i.data.rotation+(p+o*s)-i.rotation;o>180;)o-=360;for(;-180>o;)o+=360;i.rotation+=o*n}}},t.TranslateTimeline=function(e){this.curves=new t.Curves(e),this.frames=[],this.frames.length=3*e},t.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(e,f,n,o){e*=3,this.frames[e]=f,this.frames[e+1]=n,this.frames[e+2]=o},apply:function(e,f,n){var o=this.frames;if(!(f<o[0])){var d=e.bones[this.boneIndex];if(f>=o[o.length-3])return d.x+=(d.data.x+o[o.length-2]-d.x)*n,void(d.y+=(d.data.y+o[o.length-1]-d.y)*n);var i=t.binarySearch(o,f,3),l=o[i-2],p=o[i-1],u=o[i],s=1-(f-u)/(o[i+-3]-u);s=this.curves.getCurvePercent(i/3-1,s),d.x+=(d.data.x+l+(o[i+1]-l)*s-d.x)*n,d.y+=(d.data.y+p+(o[i+2]-p)*s-d.y)*n}}},t.ScaleTimeline=function(e){this.curves=new t.Curves(e),this.frames=[],this.frames.length=3*e},t.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(e,f,n,o){e*=3,this.frames[e]=f,this.frames[e+1]=n,this.frames[e+2]=o},apply:function(e,f,n){var o=this.frames;if(!(f<o[0])){var d=e.bones[this.boneIndex];if(f>=o[o.length-3])return d.scaleX+=(d.data.scaleX-1+o[o.length-2]-d.scaleX)*n,void(d.scaleY+=(d.data.scaleY-1+o[o.length-1]-d.scaleY)*n);var i=t.binarySearch(o,f,3),l=o[i-2],p=o[i-1],u=o[i],s=1-(f-u)/(o[i+-3]-u);s=this.curves.getCurvePercent(i/3-1,s),d.scaleX+=(d.data.scaleX-1+l+(o[i+1]-l)*s-d.scaleX)*n,d.scaleY+=(d.data.scaleY-1+p+(o[i+2]-p)*s-d.scaleY)*n}}},t.ColorTimeline=function(e){this.curves=new t.Curves(e),this.frames=[],this.frames.length=5*e},t.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(e,f,n,o){e*=5,this.frames[e]=f,this.frames[e+1]=r,this.frames[e+2]=g,this.frames[e+3]=b,this.frames[e+4]=a},apply:function(e,f,n){var o=this.frames;if(!(f<o[0])){var d=e.slots[this.slotIndex];if(f>=o[o.length-5]){var i=o.length-1;return d.r=o[i-3],d.g=o[i-2],d.b=o[i-1],void(d.a=o[i])}var l=t.binarySearch(o,f,5),p=o[l-4],u=o[l-3],s=o[l-2],c=o[l-1],y=o[l],a=1-(f-y)/(o[l-5]-y);a=this.curves.getCurvePercent(l/5-1,a);var r=p+(o[l+1]-p)*a,w=u+(o[l+2]-u)*a,b=s+(o[l+3]-s)*a,g=c+(o[l+4]-c)*a;1>n?(d.r+=(r-d.r)*n,d.g+=(w-d.g)*n,d.b+=(b-d.b)*n,d.a+=(g-d.a)*n):(d.r=r,d.g=w,d.b=b,d.a=g)}}},t.AttachmentTimeline=function(e){this.curves=new t.Curves(e),this.frames=[],this.frames.length=e,this.attachmentNames=[],this.attachmentNames.length=e},t.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(e,f,n){this.frames[e]=f,this.attachmentNames[e]=n},apply:function(e,f,n){var o=this.frames;if(!(f<o[0])){var d;d=f>=o[o.length-1]?o.length-1:t.binarySearch(o,f,1)-1;var i=this.attachmentNames[d];e.slots[this.slotIndex].setAttachment(i?e.getAttachmentBySlotIndex(this.slotIndex,i):null)}}},t.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.animations=[]},t.SkeletonData.prototype={defaultSkin:null,findBone:function(e){for(var f=this.bones,n=0,o=f.length;o>n;n++)if(f[n].name==e)return f[n];return null},findBoneIndex:function(e){for(var f=this.bones,n=0,o=f.length;o>n;n++)if(f[n].name==e)return n;return-1},findSlot:function(e){for(var f=this.slots,n=0,o=f.length;o>n;n++)if(f[n].name==e)return slot[n];return null},findSlotIndex:function(e){for(var f=this.slots,n=0,o=f.length;o>n;n++)if(f[n].name==e)return n;return-1},findSkin:function(e){for(var f=this.skins,n=0,o=f.length;o>n;n++)if(f[n].name==e)return f[n];return null},findAnimation:function(e){for(var f=this.animations,n=0,o=f.length;o>n;n++)if(f[n].name==e)return f[n];return null}},t.Skeleton=function(e){this.data=e,this.bones=[];for(var f=0,n=e.bones.length;n>f;f++){var o=e.bones[f],d=o.parent?this.bones[e.bones.indexOf(o.parent)]:null;this.bones.push(new t.Bone(o,d))}for(this.slots=[],this.drawOrder=[],f=0,n=e.slots.length;n>f;f++){var i=e.slots[f],l=this.bones[e.bones.indexOf(i.boneData)],p=new t.Slot(i,this,l);this.slots.push(p),this.drawOrder.push(p)}},t.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateWorldTransform:function(){for(var e=this.flipX,f=this.flipY,n=this.bones,o=0,d=n.length;d>o;o++)n[o].updateWorldTransform(e,f)},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var e=this.bones,f=0,n=e.length;n>f;f++)e[f].setToSetupPose()},setSlotsToSetupPose:function(){for(var e=this.slots,f=0,n=e.length;n>f;f++)e[f].setToSetupPose(f)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(e){for(var f=this.bones,n=0,o=f.length;o>n;n++)if(f[n].data.name==e)return f[n];return null},findBoneIndex:function(e){for(var f=this.bones,n=0,o=f.length;o>n;n++)if(f[n].data.name==e)return n;return-1},findSlot:function(e){for(var f=this.slots,n=0,o=f.length;o>n;n++)if(f[n].data.name==e)return f[n];return null},findSlotIndex:function(e){for(var f=this.slots,n=0,o=f.length;o>n;n++)if(f[n].data.name==e)return n;return-1},setSkinByName:function(e){var f=this.data.findSkin(e);if(!f)throw"Skin not found: "+e;this.setSkin(f)},setSkin:function(e){this.skin&&e&&e._attachAll(this,this.skin),this.skin=e},getAttachmentBySlotName:function(e,f){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(e),f)},getAttachmentBySlotIndex:function(e,f){if(this.skin){var n=this.skin.getAttachment(e,f);if(n)return n}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(e,f):null},setAttachment:function(e,f){for(var n=this.slots,o=0,d=n.size;d>o;o++){var i=n[o];if(i.data.name==e){var t=null;if(f&&(t=this.getAttachment(o,f),
null==t))throw"Attachment not found: "+f+", for slot: "+e;return void i.setAttachment(t)}}throw"Slot not found: "+e},update:function(e){time+=e}},t.AttachmentType={region:0},t.RegionAttachment=function(){this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},t.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(e,f,n,o,d){var i=this.uvs;d?(i[2]=e,i[3]=o,i[4]=e,i[5]=f,i[6]=n,i[7]=f,i[0]=n,i[1]=o):(i[0]=e,i[1]=o,i[2]=e,i[3]=f,i[4]=n,i[5]=f,i[6]=n,i[7]=o)},updateOffset:function(){var e=this.width/this.regionOriginalWidth*this.scaleX,f=this.height/this.regionOriginalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.regionOffsetX*e,o=-this.height/2*this.scaleY+this.regionOffsetY*f,d=n+this.regionWidth*e,i=o+this.regionHeight*f,t=this.rotation*Math.PI/180,l=Math.cos(t),p=Math.sin(t),u=n*l+this.x,s=n*p,c=o*l+this.y,y=o*p,a=d*l+this.x,r=d*p,w=i*l+this.y,b=i*p,g=this.offset;g[0]=u-y,g[1]=c+s,g[2]=u-b,g[3]=w+s,g[4]=a-b,g[5]=w+r,g[6]=a-y,g[7]=c+r},computeVertices:function(e,f,n,o){e+=n.worldX,f+=n.worldY;var d=n.m00,i=n.m01,t=n.m10,l=n.m11,p=this.offset;o[0]=p[0]*d+p[1]*i+e,o[1]=p[0]*t+p[1]*l+f,o[2]=p[2]*d+p[3]*i+e,o[3]=p[2]*t+p[3]*l+f,o[4]=p[4]*d+p[5]*i+e,o[5]=p[4]*t+p[5]*l+f,o[6]=p[6]*d+p[7]*i+e,o[7]=p[6]*t+p[7]*l+f}},t.AnimationStateData=function(e){this.skeletonData=e,this.animationToMixTime={}},t.AnimationStateData.prototype={defaultMix:0,setMixByName:function(e,f,n){var o=this.skeletonData.findAnimation(e);if(!o)throw"Animation not found: "+e;var d=this.skeletonData.findAnimation(f);if(!d)throw"Animation not found: "+f;this.setMix(o,d,n)},setMix:function(e,f,n){this.animationToMixTime[e.name+":"+f.name]=n},getMix:function(e,f){var n=this.animationToMixTime[e.name+":"+f.name];return n?n:this.defaultMix}},t.AnimationState=function(e){this.data=e,this.queue=[]},t.AnimationState.prototype={current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(e){if(this.currentTime+=e,this.previousTime+=e,this.mixTime+=e,this.queue.length>0){var f=this.queue[0];this.currentTime>=f.delay&&(this._setAnimation(f.animation,f.loop),this.queue.shift())}},apply:function(e){if(this.current)if(this.previous){this.previous.apply(e,this.previousTime,this.previousLoop);var f=this.mixTime/this.mixDuration;f>=1&&(f=1,this.previous=null),this.current.mix(e,this.currentTime,this.currentLoop,f)}else this.current.apply(e,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null,this.current=null,this.queue.length=0},_setAnimation:function(e,f){this.previous=null,e&&this.current&&(this.mixDuration=this.data.getMix(this.current,e),this.mixDuration>0&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop)),this.current=e,this.currentLoop=f,this.currentTime=0},setAnimationByName:function(e,f){var n=this.data.skeletonData.findAnimation(e);if(!n)throw"Animation not found: "+e;this.setAnimation(n,f)},setAnimation:function(e,f){this.queue.length=0,this._setAnimation(e,f)},addAnimationByName:function(e,f,n){var o=this.data.skeletonData.findAnimation(e);if(!o)throw"Animation not found: "+e;this.addAnimation(o,f,n)},addAnimation:function(e,f,n){var o={};if(o.animation=e,o.loop=f,!n||0>=n){var d=this.queue.length?this.queue[this.queue.length-1].animation:this.current;n=null!=d?d.duration-this.data.getMix(d,e)+(n||0):0}o.delay=n,this.queue.push(o)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}},t.SkeletonJson=function(e){this.attachmentLoader=e},t.SkeletonJson.prototype={scale:1,readSkeletonData:function(e){for(var f,n=new t.SkeletonData,o=e.bones,d=0,i=o.length;i>d;d++){var l=o[d],p=null;if(l.parent&&(p=n.findBone(l.parent),!p))throw"Parent bone not found: "+l.parent;f=new t.BoneData(l.name,p),f.length=(l.length||0)*this.scale,f.x=(l.x||0)*this.scale,f.y=(l.y||0)*this.scale,f.rotation=l.rotation||0,f.scaleX=l.scaleX||1,f.scaleY=l.scaleY||1,n.bones.push(f)}var u=e.slots;for(d=0,i=u.length;i>d;d++){var s=u[d];if(f=n.findBone(s.bone),!f)throw"Slot bone not found: "+s.bone;var c=new t.SlotData(s.name,f),y=s.color;y&&(c.r=t.SkeletonJson.toColor(y,0),c.g=t.SkeletonJson.toColor(y,1),c.b=t.SkeletonJson.toColor(y,2),c.a=t.SkeletonJson.toColor(y,3)),c.attachmentName=s.attachment,n.slots.push(c)}var a=e.skins;for(var r in a)if(a.hasOwnProperty(r)){var w=a[r],b=new t.Skin(r);for(var g in w)if(w.hasOwnProperty(g)){var m=n.findSlotIndex(g),x=w[g];for(var j in x)if(x.hasOwnProperty(j)){var v=this.readAttachment(b,j,x[j]);null!=v&&b.addAttachment(m,j,v)}}n.skins.push(b),"default"==b.name&&(n.defaultSkin=b)}var h=e.animations;for(var k in h)h.hasOwnProperty(k)&&this.readAnimation(k,h[k],n);return n},readAttachment:function(e,f,n){f=n.name||f;var o=t.AttachmentType[n.type||"region"];if(o==t.AttachmentType.region){var d=new t.RegionAttachment;return d.x=(n.x||0)*this.scale,d.y=(n.y||0)*this.scale,d.scaleX=n.scaleX||1,d.scaleY=n.scaleY||1,d.rotation=n.rotation||0,d.width=(n.width||32)*this.scale,d.height=(n.height||32)*this.scale,d.updateOffset(),d.rendererObject={},d.rendererObject.name=f,d.rendererObject.scale={},d.rendererObject.scale.x=d.scaleX,d.rendererObject.scale.y=d.scaleY,d.rendererObject.rotation=-d.rotation*Math.PI/180,d}throw"Unknown attachment type: "+o},readAnimation:function(e,f,n){var o,d,i,l,p,u,s,c=[],y=0,a=f.bones;for(var r in a)if(a.hasOwnProperty(r)){var w=n.findBoneIndex(r);if(-1==w)throw"Bone not found: "+r;var b=a[r];for(i in b)if(b.hasOwnProperty(i))if(p=b[i],"rotate"==i){for(d=new t.RotateTimeline(p.length),d.boneIndex=w,o=0,u=0,s=p.length;s>u;u++)l=p[u],d.setFrame(o,l.time,l.angle),t.SkeletonJson.readCurve(d,o,l),o++;c.push(d),y=Math.max(y,d.frames[2*d.getFrameCount()-2])}else{if("translate"!=i&&"scale"!=i)throw"Invalid timeline type for a bone: "+i+" ("+r+")";var g=1;for("scale"==i?d=new t.ScaleTimeline(p.length):(d=new t.TranslateTimeline(p.length),g=this.scale),d.boneIndex=w,o=0,u=0,s=p.length;s>u;u++){l=p[u];var m=(l.x||0)*g,x=(l.y||0)*g;d.setFrame(o,l.time,m,x),t.SkeletonJson.readCurve(d,o,l),o++}c.push(d),y=Math.max(y,d.frames[3*d.getFrameCount()-3])}}var j=f.slots;for(var v in j)if(j.hasOwnProperty(v)){var h=j[v],k=n.findSlotIndex(v);for(i in h)if(h.hasOwnProperty(i))if(p=h[i],"color"==i){for(d=new t.ColorTimeline(p.length),d.slotIndex=k,o=0,u=0,s=p.length;s>u;u++){l=p[u];var q=l.color,z=t.SkeletonJson.toColor(q,0),A=t.SkeletonJson.toColor(q,1),B=t.SkeletonJson.toColor(q,2),C=t.SkeletonJson.toColor(q,3);d.setFrame(o,l.time,z,A,B,C),t.SkeletonJson.readCurve(d,o,l),o++}c.push(d),y=Math.max(y,d.frames[5*d.getFrameCount()-5])}else{if("attachment"!=i)throw"Invalid timeline type for a slot: "+i+" ("+v+")";for(d=new t.AttachmentTimeline(p.length),d.slotIndex=k,o=0,u=0,s=p.length;s>u;u++)l=p[u],d.setFrame(o++,l.time,l.name);c.push(d),y=Math.max(y,d.frames[d.getFrameCount()-1])}}n.animations.push(new t.Animation(e,c,y))}},t.SkeletonJson.readCurve=function(e,f,n){var o=n.curve;o&&("stepped"==o?e.curves.setStepped(f):o instanceof Array&&e.curves.setCurve(f,o[0],o[1],o[2],o[3]))},t.SkeletonJson.toColor=function(e,f){if(8!=e.length)throw"Color hexidecimal length must be 8, recieved: "+e;return parseInt(e.substring(2*f,2),16)/255},t.Atlas=function(e,f){this.textureLoader=f,this.pages=[],this.regions=[];var n=new t.AtlasReader(e),o=[];o.length=4;for(var d=null;;){var i=n.readLine();if(null==i)break;if(i=n.trim(i),i.length)if(d){var l=new t.AtlasRegion;l.name=i,l.page=d,l.rotate="true"==n.readValue(),n.readTuple(o);var p=parseInt(o[0],10),u=parseInt(o[1],10);n.readTuple(o);var s=parseInt(o[0],10),c=parseInt(o[1],10);l.u=p/d.width,l.v=u/d.height,l.rotate?(l.u2=(p+c)/d.width,l.v2=(u+s)/d.height):(l.u2=(p+s)/d.width,l.v2=(u+c)/d.height),l.x=p,l.y=u,l.width=Math.abs(s),l.height=Math.abs(c),4==n.readTuple(o)&&(l.splits=[parseInt(o[0],10),parseInt(o[1],10),parseInt(o[2],10),parseInt(o[3],10)],4==n.readTuple(o)&&(l.pads=[parseInt(o[0],10),parseInt(o[1],10),parseInt(o[2],10),parseInt(o[3],10)],n.readTuple(o))),l.originalWidth=parseInt(o[0],10),l.originalHeight=parseInt(o[1],10),n.readTuple(o),l.offsetX=parseInt(o[0],10),l.offsetY=parseInt(o[1],10),l.index=parseInt(n.readValue(),10),this.regions.push(l)}else{d=new t.AtlasPage,d.name=i,d.format=t.Atlas.Format[n.readValue()],n.readTuple(o),d.minFilter=t.Atlas.TextureFilter[o[0]],d.magFilter=t.Atlas.TextureFilter[o[1]];var y=n.readValue();d.uWrap=t.Atlas.TextureWrap.clampToEdge,d.vWrap=t.Atlas.TextureWrap.clampToEdge,"x"==y?d.uWrap=t.Atlas.TextureWrap.repeat:"y"==y?d.vWrap=t.Atlas.TextureWrap.repeat:"xy"==y&&(d.uWrap=d.vWrap=t.Atlas.TextureWrap.repeat),f.load(d,i),this.pages.push(d)}else d=null}},t.Atlas.prototype={findRegion:function(e){for(var f=this.regions,n=0,o=f.length;o>n;n++)if(f[n].name==e)return f[n];return null},dispose:function(){for(var e=this.pages,f=0,n=e.length;n>f;f++)this.textureLoader.unload(e[f].rendererObject)},updateUVs:function(e){for(var f=this.regions,n=0,o=f.length;o>n;n++){var d=f[n];d.page==e&&(d.u=d.x/e.width,d.v=d.y/e.height,d.rotate?(d.u2=(d.x+d.height)/e.width,d.v2=(d.y+d.width)/e.height):(d.u2=(d.x+d.width)/e.width,d.v2=(d.y+d.height)/e.height))}}},t.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},t.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},t.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},t.AtlasPage=function(){},t.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},t.AtlasRegion=function(){},t.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},t.AtlasReader=function(e){this.lines=e.split(/\r\n|\r|\n/)},t.AtlasReader.prototype={index:0,trim:function(e){return e.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var e=this.readLine(),f=e.indexOf(":");if(-1==f)throw"Invalid line: "+e;return this.trim(e.substring(f+1))},readTuple:function(e){var f=this.readLine(),n=f.indexOf(":");if(-1==n)throw"Invalid line: "+f;for(var o=0,d=n+1;3>o;o++){var i=f.indexOf(",",d);if(-1==i){if(!o)throw"Invalid line: "+f;break}e[o]=this.trim(f.substr(d,i-d)),d=i+1}return e[o]=this.trim(f.substring(d)),o+1}},t.AtlasAttachmentLoader=function(e){this.atlas=e},t.AtlasAttachmentLoader.prototype={newAttachment:function(e,f,n){switch(f){case t.AttachmentType.region:var o=this.atlas.findRegion(n);if(!o)throw"Region not found in atlas: "+n+" ("+f+")";var d=new t.RegionAttachment(n);return d.rendererObject=o,d.setUVs(o.u,o.v,o.u2,o.v2,o.rotate),d.regionOffsetX=o.offsetX,d.regionOffsetY=o.offsetY,d.regionWidth=o.width,d.regionHeight=o.height,d.regionOriginalWidth=o.originalWidth,d.regionOriginalHeight=o.originalHeight,d}throw"Unknown attachment type: "+f}},t.Bone.yDown=!0,n.AnimCache={},n.Spine=function(e){if(n.DisplayObjectContainer.call(this),this.spineData=n.AnimCache[e],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+e);this.skeleton=new t.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new t.AnimationStateData(this.spineData),this.state=new t.AnimationState(this.stateData),this.slotContainers=[];for(var f=0,o=this.skeleton.drawOrder.length;o>f;f++){var d=this.skeleton.drawOrder[f],i=d.attachment,l=new n.DisplayObjectContainer;if(this.slotContainers.push(l),this.addChild(l),i instanceof t.RegionAttachment){var p=i.rendererObject.name,u=this.createSprite(d,i.rendererObject);d.currentSprite=u,d.currentSpriteName=p,l.addChild(u)}}},n.Spine.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Spine.prototype.constructor=n.Spine,n.Spine.prototype.updateTransform=function(){this.lastTime=this.lastTime||Date.now();var e=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.state.update(e),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var f=this.skeleton.drawOrder,o=0,d=f.length;d>o;o++){var i=f[o],l=i.attachment,p=this.slotContainers[o];if(l instanceof t.RegionAttachment){if(l.rendererObject&&(!i.currentSpriteName||i.currentSpriteName!=l.name)){var u=l.rendererObject.name;if(void 0!==i.currentSprite&&(i.currentSprite.visible=!1),i.sprites=i.sprites||{},void 0!==i.sprites[u])i.sprites[u].visible=!0;else{var s=this.createSprite(i,l.rendererObject);p.addChild(s)}i.currentSprite=i.sprites[u],i.currentSpriteName=u}p.visible=!0;var c=i.bone;p.position.x=c.worldX+l.x*c.m00+l.y*c.m01,p.position.y=c.worldY+l.x*c.m10+l.y*c.m11,p.scale.x=c.worldScaleX,p.scale.y=c.worldScaleY,p.rotation=-(i.bone.worldRotation*Math.PI/180)}else p.visible=!1}n.DisplayObjectContainer.prototype.updateTransform.call(this)},n.Spine.prototype.createSprite=function(e,f){var o=n.TextureCache[f.name]?f.name:f.name+".png",d=new n.Sprite(n.Texture.fromFrame(o));return d.scale=f.scale,d.rotation=f.rotation,d.anchor.x=d.anchor.y=.5,e.sprites=e.sprites||{},e.sprites[f.name]=d,d},n.BaseTextureCache={},n.texturesToUpdate=[],n.texturesToDestroy=[],n.BaseTexture=function(e,f){if(n.EventTarget.call(this),this.width=100,this.height=100,this.scaleMode=f||n.BaseTexture.SCALE_MODE.DEFAULT,this.hasLoaded=!1,this.source=e,e){if(this.source instanceof Image||this.source instanceof HTMLImageElement)if(this.source.complete)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,n.texturesToUpdate.push(this);else{var o=this;this.source.onload=function(){o.hasLoaded=!0,o.width=o.source.width,o.height=o.source.height,n.texturesToUpdate.push(o),o.dispatchEvent({type:"loaded",content:o})}}else this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,n.texturesToUpdate.push(this);this.imageUrl=null,this._powerOf2=!1,this._glTextures=[]}},n.BaseTexture.prototype.constructor=n.BaseTexture,n.BaseTexture.prototype.destroy=function(){this.source instanceof Image&&(this.imageUrl in n.BaseTextureCache&&delete n.BaseTextureCache[this.imageUrl],this.imageUrl=null,this.source.src=null),this.source=null,n.texturesToDestroy.push(this)},n.BaseTexture.prototype.updateSourceImage=function(e){this.hasLoaded=!1,this.source.src=null,this.source.src=e},n.BaseTexture.fromImage=function(e,f,o){var d=n.BaseTextureCache[e];if(!d){var i=new Image;f&&(i.crossOrigin=""),i.src=e,d=new n.BaseTexture(i,o),d.imageUrl=e,n.BaseTextureCache[e]=d}return d},n.BaseTexture.SCALE_MODE={DEFAULT:0,LINEAR:0,NEAREST:1},n.TextureCache={},n.FrameCache={},n.Texture=function(e,f){if(n.EventTarget.call(this),f||(this.noFrame=!0,f=new n.Rectangle(0,0,1,1)),e instanceof n.Texture&&(e=e.baseTexture),this.baseTexture=e,this.frame=f,this.trim=new n.Point,this.scope=this,e.hasLoaded)this.noFrame&&(f=new n.Rectangle(0,0,e.width,e.height)),this.setFrame(f);else{var o=this;e.addEventListener("loaded",function(){o.onBaseTextureLoaded()})}},n.Texture.prototype.constructor=n.Texture,n.Texture.prototype.onBaseTextureLoaded=function(){var e=this.baseTexture;e.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new n.Rectangle(0,0,e.width,e.height)),this.setFrame(this.frame),this.scope.dispatchEvent({type:"update",content:this})},n.Texture.prototype.destroy=function(e){e&&this.baseTexture.destroy()},n.Texture.prototype.setFrame=function(e){if(this.frame=e,this.width=e.width,this.height=e.height,e.x+e.width>this.baseTexture.width||e.y+e.height>this.baseTexture.height)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.updateFrame=!0,n.Texture.frameUpdates.push(this)},n.Texture.prototype._updateWebGLuvs=function(){this._uvs||(this._uvs=new Float32Array(8));var e=this.frame,f=this.baseTexture.width,n=this.baseTexture.height;this._uvs[0]=e.x/f,this._uvs[1]=e.y/n,this._uvs[2]=(e.x+e.width)/f,this._uvs[3]=e.y/n,this._uvs[4]=(e.x+e.width)/f,this._uvs[5]=(e.y+e.height)/n,this._uvs[6]=e.x/f,this._uvs[7]=(e.y+e.height)/n},n.Texture.fromImage=function(e,f,o){var d=n.TextureCache[e];return d||(d=new n.Texture(n.BaseTexture.fromImage(e,f,o)),n.TextureCache[e]=d),d},n.Texture.fromFrame=function(e){var f=n.TextureCache[e];if(!f)throw new Error('The frameId "'+e+'" does not exist in the texture cache '+this);return f},n.Texture.fromCanvas=function(e,f){var o=new n.BaseTexture(e,f);return new n.Texture(o)},n.Texture.addTextureToCache=function(e,f){n.TextureCache[f]=e},n.Texture.removeTextureFromCache=function(e){var f=n.TextureCache[e];return n.TextureCache[e]=null,f},n.Texture.frameUpdates=[],n.Texture.SCALE_MODE=n.BaseTexture.SCALE_MODE,n.RenderTexture=function(e,f,o){if(n.EventTarget.call(this),this.width=e||100,this.height=f||100,this.indetityMatrix=n.mat3.create(),this.frame=new n.Rectangle(0,0,this.width,this.height),this.baseTexture=new n.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTextures=[],this.baseTexture.hasLoaded=!0,this.renderer=o||n.defaultRenderer,this.renderer.type===n.WEBGL_RENDERER){var d=this.renderer.gl;this.textureBuffer=new n.FilterTexture(d,this.width,this.height),this.baseTexture._glTextures[d.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new n.Point(this.width/2,-this.height/2)}else this.render=this.renderCanvas,this.textureBuffer=new n.CanvasBuffer(this.width,this.height),this.baseTexture.source=this.textureBuffer.canvas;n.Texture.frameUpdates.push(this)},n.RenderTexture.prototype=Object.create(n.Texture.prototype),n.RenderTexture.prototype.constructor=n.RenderTexture,n.RenderTexture.prototype.resize=function(e,f){if(this.width=e,this.height=f,this.frame.width=this.width,this.frame.height=this.height,this.renderer.type===n.WEBGL_RENDERER){this.projection.x=this.width/2,this.projection.y=-this.height/2;var o=this.gl;o.bindTexture(o.TEXTURE_2D,this.baseTexture._glTextures[o.id]),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,this.width,this.height,0,o.RGBA,o.UNSIGNED_BYTE,null)}else this.textureBuffer.resize(this.width,this.height);n.Texture.frameUpdates.push(this)},n.RenderTexture.prototype.renderWebGL=function(e,f,o){var d=this.renderer.gl;d.colorMask(!0,!0,!0,!0),d.viewport(0,0,this.width,this.height),d.bindFramebuffer(d.FRAMEBUFFER,this.textureBuffer.frameBuffer),o&&this.textureBuffer.clear();var i=e.children,t=e.worldTransform;e.worldTransform=n.mat3.create(),e.worldTransform[4]=-1,e.worldTransform[5]=-2*this.projection.y,f&&(e.worldTransform[2]=f.x,e.worldTransform[5]-=f.y);for(var l=0,p=i.length;p>l;l++)i[l].updateTransform();this.renderer.renderDisplayObject(e,this.projection),e.worldTransform=t},n.RenderTexture.prototype.renderCanvas=function(e,f,o){var d=e.children;e.worldTransform=n.mat3.create(),f&&(e.worldTransform[2]=f.x,e.worldTransform[5]=f.y);for(var i=0,t=d.length;t>i;i++)d[i].updateTransform();o&&this.textureBuffer.clear();var l=this.textureBuffer.context;this.renderer.renderDisplayObject(e,l),l.setTransform(1,0,0,1,0,0)},n.AssetLoader=function(e,f){n.EventTarget.call(this),this.assetURLs=e,this.crossorigin=f,this.loadersByType={jpg:n.ImageLoader,jpeg:n.ImageLoader,png:n.ImageLoader,gif:n.ImageLoader,json:n.JsonLoader,atlas:n.AtlasLoader,anim:n.SpineLoader,xml:n.BitmapFontLoader,fnt:n.BitmapFontLoader}},n.AssetLoader.prototype.constructor=n.AssetLoader,n.AssetLoader.prototype._getDataType=function(e){var f="data:",n=e.slice(0,f.length).toLowerCase();if(n===f){var o=e.slice(f.length),d=o.indexOf(",");if(-1===d)return null;var i=o.slice(0,d).split(";")[0];return i&&"text/plain"!==i.toLowerCase()?i.split("/").pop().toLowerCase():"txt"}return null},n.AssetLoader.prototype.load=function(){function e(){f.onAssetLoaded()}var f=this;this.loadCount=this.assetURLs.length;for(var n=0;n<this.assetURLs.length;n++){var o=this.assetURLs[n],d=this._getDataType(o);d||(d=o.split("?").shift().split(".").pop().toLowerCase());var i=this.loadersByType[d];if(!i)throw new Error(d+" is an unsupported file type");var t=new i(o,this.crossorigin);t.addEventListener("loaded",e),t.load()}},n.AssetLoader.prototype.onAssetLoaded=function(){this.loadCount--,this.dispatchEvent({type:"onProgress",content:this}),this.onProgress&&this.onProgress(),this.loadCount||(this.dispatchEvent({type:"onComplete",content:this}),this.onComplete&&this.onComplete())},n.JsonLoader=function(e,f){n.EventTarget.call(this),this.url=e,this.crossorigin=f,this.baseUrl=e.replace(/[^\/]*$/,""),this.loaded=!1},n.JsonLoader.prototype.constructor=n.JsonLoader,n.JsonLoader.prototype.load=function(){this.ajaxRequest=new n.AjaxRequest;var e=this;this.ajaxRequest.onreadystatechange=function(){e.onJSONLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},n.JsonLoader.prototype.onJSONLoaded=function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames){var e=this,f=this.baseUrl+this.json.meta.image,o=new n.ImageLoader(f,this.crossorigin),d=this.json.frames;this.texture=o.texture.baseTexture,o.addEventListener("loaded",function(){e.onLoaded()});for(var i in d){var l=d[i].frame;if(l&&(n.TextureCache[i]=new n.Texture(this.texture,{x:l.x,y:l.y,width:l.w,height:l.h}),d[i].trimmed)){var p=n.TextureCache[i];p.trimmed=!0;var u=d[i].sourceSize,s=d[i].spriteSourceSize;p.trim.x=s.x,p.trim.y=s.y,p.trim.realWidth=u.w,p.trim.realHeight=u.h}}o.load()}else if(this.json.bones){var c=new t.SkeletonJson,y=c.readSkeletonData(this.json);n.AnimCache[this.url]=y,this.onLoaded()}else this.onLoaded();else this.onError()},n.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},n.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},n.AtlasLoader=function(e,f){n.EventTarget.call(this),this.url=e,this.baseUrl=e.replace(/[^\/]*$/,""),this.crossorigin=f,this.loaded=!1},n.AtlasLoader.constructor=n.AtlasLoader,n.AtlasLoader.prototype.load=function(){this.ajaxRequest=new n.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onAtlasLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},n.AtlasLoader.prototype.onAtlasLoaded=function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.href.indexOf("http")){this.atlas={meta:{image:[]},frames:[]};var e=this.ajaxRequest.responseText.split(/\r?\n/),f=-3,o=0,d=null,i=!1,t=0,l=0,p=this.onLoaded.bind(this);for(t=0;t<e.length;t++)if(e[t]=e[t].replace(/^\s+|\s+$/g,""),""===e[t]&&(i=t+1),e[t].length>0){if(i===t)this.atlas.meta.image.push(e[t]),o=this.atlas.meta.image.length-1,this.atlas.frames.push({}),f=-3;else if(f>0)if(f%7===1)null!=d&&(this.atlas.frames[o][d.name]=d),d={name:e[t],frame:{}};else{var u=e[t].split(" ");if(f%7===3)d.frame.x=Number(u[1].replace(",","")),d.frame.y=Number(u[2]);else if(f%7===4)d.frame.w=Number(u[1].replace(",","")),d.frame.h=Number(u[2]);else if(f%7===5){var s={x:0,y:0,w:Number(u[1].replace(",","")),h:Number(u[2])};s.w>d.frame.w||s.h>d.frame.h?(d.trimmed=!0,d.realSize=s):d.trimmed=!1}}f++}if(null!=d&&(this.atlas.frames[o][d.name]=d),this.atlas.meta.image.length>0){for(this.images=[],l=0;l<this.atlas.meta.image.length;l++){var c=this.baseUrl+this.atlas.meta.image[l],y=this.atlas.frames[l];this.images.push(new n.ImageLoader(c,this.crossorigin));for(t in y){var a=y[t].frame;a&&(n.TextureCache[t]=new n.Texture(this.images[l].texture.baseTexture,{x:a.x,y:a.y,width:a.w,height:a.h}),y[t].trimmed&&(n.TextureCache[t].realSize=y[t].realSize,n.TextureCache[t].trim.x=0,n.TextureCache[t].trim.y=0))}}for(this.currentImageId=0,l=0;l<this.images.length;l++)this.images[l].addEventListener("loaded",p);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()},n.AtlasLoader.prototype.onLoaded=function(){this.images.length-1>this.currentImageId?(this.currentImageId++,this.images[this.currentImageId].load()):(this.loaded=!0,this.dispatchEvent({type:"loaded",content:this}))},n.AtlasLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},n.SpriteSheetLoader=function(e,f){n.EventTarget.call(this),this.url=e,this.crossorigin=f,this.baseUrl=e.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},n.SpriteSheetLoader.prototype.constructor=n.SpriteSheetLoader,n.SpriteSheetLoader.prototype.load=function(){var e=this,f=new n.JsonLoader(this.url,this.crossorigin);f.addEventListener("loaded",function(f){e.json=f.content.json,e.onLoaded()}),f.load()},n.SpriteSheetLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},n.ImageLoader=function(e,f){n.EventTarget.call(this),this.texture=n.Texture.fromImage(e,f),this.frames=[]},n.ImageLoader.prototype.constructor=n.ImageLoader,n.ImageLoader.prototype.load=function(){if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var e=this;this.texture.baseTexture.addEventListener("loaded",function(){e.onLoaded()})}},n.ImageLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},n.ImageLoader.prototype.loadFramedSpriteSheet=function(e,f,o){this.frames=[];for(var d=Math.floor(this.texture.width/e),i=Math.floor(this.texture.height/f),t=0,l=0;i>l;l++)for(var p=0;d>p;p++,t++){var u=new n.Texture(this.texture,{x:p*e,y:l*f,width:e,height:f});this.frames.push(u),o&&(n.TextureCache[o+"-"+t]=u)}if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var s=this;this.texture.baseTexture.addEventListener("loaded",function(){s.onLoaded()})}},n.BitmapFontLoader=function(e,f){n.EventTarget.call(this),this.url=e,this.crossorigin=f,this.baseUrl=e.replace(/[^\/]*$/,""),this.texture=null},n.BitmapFontLoader.prototype.constructor=n.BitmapFontLoader,n.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new XMLHttpRequest;var e=this;this.ajaxRequest.onreadystatechange=function(){e.onXMLLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},n.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))){var e=this.ajaxRequest.responseXML;if(!e||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser){var f=new DOMParser;e=f.parseFromString(this.ajaxRequest.responseText,"text/xml")}else{var o=document.createElement("div");o.innerHTML=this.ajaxRequest.responseText,e=o}var d=this.baseUrl+e.getElementsByTagName("page")[0].getAttribute("file"),i=new n.ImageLoader(d,this.crossorigin);this.texture=i.texture.baseTexture;var t={},l=e.getElementsByTagName("info")[0],p=e.getElementsByTagName("common")[0];t.font=l.getAttribute("face"),t.size=parseInt(l.getAttribute("size"),10),t.lineHeight=parseInt(p.getAttribute("lineHeight"),10),t.chars={};for(var u=e.getElementsByTagName("char"),s=0;s<u.length;s++){var c=parseInt(u[s].getAttribute("id"),10),y=new n.Rectangle(parseInt(u[s].getAttribute("x"),10),parseInt(u[s].getAttribute("y"),10),parseInt(u[s].getAttribute("width"),10),parseInt(u[s].getAttribute("height"),10));t.chars[c]={xOffset:parseInt(u[s].getAttribute("xoffset"),10),yOffset:parseInt(u[s].getAttribute("yoffset"),10),xAdvance:parseInt(u[s].getAttribute("xadvance"),10),kerning:{},texture:n.TextureCache[c]=new n.Texture(this.texture,y)}}var a=e.getElementsByTagName("kerning");for(s=0;s<a.length;s++){var r=parseInt(a[s].getAttribute("first"),10),w=parseInt(a[s].getAttribute("second"),10),b=parseInt(a[s].getAttribute("amount"),10);t.chars[w].kerning[r]=b}n.BitmapText.fonts[t.font]=t;var g=this;i.addEventListener("loaded",function(){g.onLoaded()}),i.load()}},n.BitmapFontLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},n.SpineLoader=function(e,f){n.EventTarget.call(this),this.url=e,this.crossorigin=f,this.loaded=!1},n.SpineLoader.prototype.constructor=n.SpineLoader,n.SpineLoader.prototype.load=function(){var e=this,f=new n.JsonLoader(this.url,this.crossorigin);f.addEventListener("loaded",function(f){e.json=f.content.json,e.onLoaded()}),f.load()},n.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},n.AbstractFilter=function(e,f){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=f||{},this.fragmentSrc=e||[]},n.AlphaMaskFilter=function(e){n.AbstractFilter.call(this),this.passes=[this],e.baseTexture._powerOf2=!0,this.uniforms={mask:{type:"sampler2D",value:e},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},e.baseTexture.hasLoaded?(this.uniforms.mask.value.x=e.width,this.uniforms.mask.value.y=e.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),e.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]},n.AlphaMaskFilter.prototype=Object.create(n.AbstractFilter.prototype),n.AlphaMaskFilter.prototype.constructor=n.AlphaMaskFilter,n.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height,this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(n.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(e){this.uniforms.mask.value=e}}),n.ColorMatrixFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]},n.ColorMatrixFilter.prototype=Object.create(n.AbstractFilter.prototype),n.ColorMatrixFilter.prototype.constructor=n.ColorMatrixFilter,Object.defineProperty(n.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(e){this.uniforms.matrix.value=e}}),n.GrayFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={gray:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);","}"]},n.GrayFilter.prototype=Object.create(n.AbstractFilter.prototype),n.GrayFilter.prototype.constructor=n.GrayFilter,Object.defineProperty(n.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(e){this.uniforms.gray.value=e}}),n.DisplacementFilter=function(e){n.AbstractFilter.call(this),this.passes=[this],e.baseTexture._powerOf2=!0,this.uniforms={displacementMap:{type:"sampler2D",
value:e},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},e.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=e.width,this.uniforms.mapDimensions.value.y=e.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),e.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","   vec2 cord = vTextureCoord;","}"]},n.DisplacementFilter.prototype=Object.create(n.AbstractFilter.prototype),n.DisplacementFilter.prototype.constructor=n.DisplacementFilter,n.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height,this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(n.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(e){this.uniforms.displacementMap.value=e}}),Object.defineProperty(n.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(e){this.uniforms.scale.value=e}}),Object.defineProperty(n.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(e){this.uniforms.offset.value=e}}),n.PixelateFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",value:new Float32Array([1e4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;","   gl_FragColor = texture2D(uSampler, color);","}"]},n.PixelateFilter.prototype=Object.create(n.AbstractFilter.prototype),n.PixelateFilter.prototype.constructor=n.PixelateFilter,Object.defineProperty(n.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(e){this.dirty=!0,this.uniforms.pixelSize.value=e}}),n.BlurXFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]},n.BlurXFilter.prototype=Object.create(n.AbstractFilter.prototype),n.BlurXFilter.prototype.constructor=n.BlurXFilter,Object.defineProperty(n.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(e){this.dirty=!0,this.uniforms.blur.value=1/7e3*e}}),n.BlurYFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]},n.BlurYFilter.prototype=Object.create(n.AbstractFilter.prototype),n.BlurYFilter.prototype.constructor=n.BlurYFilter,Object.defineProperty(n.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(e){this.uniforms.blur.value=1/7e3*e}}),n.BlurFilter=function(){this.blurXFilter=new n.BlurXFilter,this.blurYFilter=new n.BlurYFilter,this.passes=[this.blurXFilter,this.blurYFilter]},Object.defineProperty(n.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=this.blurYFilter.blur=e}}),Object.defineProperty(n.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=e}}),Object.defineProperty(n.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(e){this.blurYFilter.blur=e}}),n.InvertFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);","}"]},n.InvertFilter.prototype=Object.create(n.AbstractFilter.prototype),n.InvertFilter.prototype.constructor=n.InvertFilter,Object.defineProperty(n.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value},set:function(e){this.uniforms.invert.value=e}}),n.SepiaFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={sepia:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;","uniform sampler2D uSampler;","const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]},n.SepiaFilter.prototype=Object.create(n.AbstractFilter.prototype),n.SepiaFilter.prototype.constructor=n.SepiaFilter,Object.defineProperty(n.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},set:function(e){this.uniforms.sepia.value=e}}),n.TwistFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:.5,y:.5}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;","   float distance = length(coord);","   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]},n.TwistFilter.prototype=Object.create(n.AbstractFilter.prototype),n.TwistFilter.prototype.constructor=n.TwistFilter,Object.defineProperty(n.TwistFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(e){this.dirty=!0,this.uniforms.offset.value=e}}),Object.defineProperty(n.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(e){this.dirty=!0,this.uniforms.radius.value=e}}),Object.defineProperty(n.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(e){this.dirty=!0,this.uniforms.angle.value=e}}),n.ColorStepFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={step:{type:"1f",value:5}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]},n.ColorStepFilter.prototype=Object.create(n.AbstractFilter.prototype),n.ColorStepFilter.prototype.constructor=n.ColorStepFilter,Object.defineProperty(n.ColorStepFilter.prototype,"step",{get:function(){return this.uniforms.step.value},set:function(e){this.uniforms.step.value=e}}),n.DotScreenFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {","   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]},n.DotScreenFilter.prototype=Object.create(n.DotScreenFilter.prototype),n.DotScreenFilter.prototype.constructor=n.DotScreenFilter,Object.defineProperty(n.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(e){this.dirty=!0,this.uniforms.scale.value=e}}),Object.defineProperty(n.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(e){this.dirty=!0,this.uniforms.angle.value=e}}),n.CrossHatchFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]},n.CrossHatchFilter.prototype=Object.create(n.AbstractFilter.prototype),n.CrossHatchFilter.prototype.constructor=n.BlurYFilter,Object.defineProperty(n.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(e){this.uniforms.blur.value=1/7e3*e}}),n.RGBSplitFilter=function(){n.AbstractFilter.call(this),this.passes=[this],this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]},n.RGBSplitFilter.prototype=Object.create(n.AbstractFilter.prototype),n.RGBSplitFilter.prototype.constructor=n.RGBSplitFilter,Object.defineProperty(n.RGBSplitFilter.prototype,"angle",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(e){this.uniforms.blur.value=1/7e3*e}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.PIXI=n):"undefined"!=typeof define&&define.amd?define(n):f.PIXI=n}).call(this);var dat=dat||{};dat.gui=dat.gui||{},dat.utils=dat.utils||{},dat.controllers=dat.controllers||{},dat.dom=dat.dom||{},dat.color=dat.color||{},dat.utils.css=function(){return{load:function(e,f){f=f||document;var n=f.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,f.getElementsByTagName("head")[0].appendChild(n)},inject:function(e,f){f=f||document;var n=document.createElement("style");n.type="text/css",n.innerHTML=e,f.getElementsByTagName("head")[0].appendChild(n)}}}(),dat.utils.common=function(){var e=Array.prototype.forEach,f=Array.prototype.slice;return{BREAK:{},extend:function(e){return this.each(f.call(arguments,1),function(f){for(var n in f)this.isUndefined(f[n])||(e[n]=f[n])},this),e},defaults:function(e){return this.each(f.call(arguments,1),function(f){for(var n in f)this.isUndefined(e[n])&&(e[n]=f[n])},this),e},compose:function(){var e=f.call(arguments);return function(){for(var n=f.call(arguments),o=e.length-1;o>=0;o--)n=[e[o].apply(this,n)];return n[0]}},each:function(f,n,o){if(f)if(e&&f.forEach&&f.forEach===e)f.forEach(n,o);else if(f.length===f.length+0){for(var d=0,i=f.length;i>d;d++)if(d in f&&n.call(o,f[d],d)===this.BREAK)return}else for(var d in f)if(n.call(o,f[d],d)===this.BREAK)return},defer:function(e){setTimeout(e,0)},toArray:function(e){return e.toArray?e.toArray():f.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){return e!==e},isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}}}(),dat.controllers.Controller=function(e){var f=function(e,f){this.initialValue=e[f],this.domElement=document.createElement("div"),this.object=e,this.property=f,this.__onChange=void 0,this.__onFinishChange=void 0};return e.extend(f.prototype,{onChange:function(e){return this.__onChange=e,this},onFinishChange:function(e){return this.__onFinishChange=e,this},setValue:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}}),f}(dat.utils.common),dat.dom.dom=function(e){function f(f){if("0"===f||e.isUndefined(f))return 0;var n=f.match(d);return e.isNull(n)?0:parseFloat(n[1])}var n={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},o={};e.each(n,function(f,n){e.each(f,function(e){o[e]=n})});var d=/(\d+(\.\d+)?)px/,i={makeSelectable:function(e,f){void 0!==e&&void 0!==e.style&&(e.onselectstart=f?function(){return!1}:function(){},e.style.MozUserSelect=f?"auto":"none",e.style.KhtmlUserSelect=f?"auto":"none",e.unselectable=f?"on":"off")},makeFullscreen:function(f,n,o){e.isUndefined(n)&&(n=!0),e.isUndefined(o)&&(o=!0),f.style.position="absolute",n&&(f.style.left=0,f.style.right=0),o&&(f.style.top=0,f.style.bottom=0)},fakeEvent:function(f,n,d,i){d=d||{};var t=o[n];if(!t)throw new Error("Event type "+n+" not supported.");var l=document.createEvent(t);switch(t){case"MouseEvents":var p=d.x||d.clientX||0,u=d.y||d.clientY||0;l.initMouseEvent(n,d.bubbles||!1,d.cancelable||!0,window,d.clickCount||1,0,0,p,u,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var s=l.initKeyboardEvent||l.initKeyEvent;e.defaults(d,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),s(n,d.bubbles||!1,d.cancelable,window,d.ctrlKey,d.altKey,d.shiftKey,d.metaKey,d.keyCode,d.charCode);break;default:l.initEvent(n,d.bubbles||!1,d.cancelable||!0)}e.defaults(l,i),f.dispatchEvent(l)},bind:function(e,f,n,o){return o=o||!1,e.addEventListener?e.addEventListener(f,n,o):e.attachEvent&&e.attachEvent("on"+f,n),i},unbind:function(e,f,n,o){return o=o||!1,e.removeEventListener?e.removeEventListener(f,n,o):e.detachEvent&&e.detachEvent("on"+f,n),i},addClass:function(e,f){if(void 0===e.className)e.className=f;else if(e.className!==f){var n=e.className.split(/ +/);-1==n.indexOf(f)&&(n.push(f),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return i},removeClass:function(e,f){if(f)if(void 0===e.className);else if(e.className===f)e.removeAttribute("class");else{var n=e.className.split(/ +/),o=n.indexOf(f);-1!=o&&(n.splice(o,1),e.className=n.join(" "))}else e.className=void 0;return i},hasClass:function(e,f){return new RegExp("(?:^|\\s+)"+f+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var n=getComputedStyle(e);return f(n["border-left-width"])+f(n["border-right-width"])+f(n["padding-left"])+f(n["padding-right"])+f(n.width)},getHeight:function(e){var n=getComputedStyle(e);return f(n["border-top-width"])+f(n["border-bottom-width"])+f(n["padding-top"])+f(n["padding-bottom"])+f(n.height)},getOffset:function(e){var f={left:0,top:0};if(e.offsetParent)do f.left+=e.offsetLeft,f.top+=e.offsetTop;while(e=e.offsetParent);return f},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}};return i}(dat.utils.common),dat.controllers.OptionController=function(e,f,n){var o=function(e,d,i){o.superclass.call(this,e,d);var t=this;if(this.__select=document.createElement("select"),n.isArray(i)){var l={};n.each(i,function(e){l[e]=e}),i=l}n.each(i,function(e,f){var n=document.createElement("option");n.innerHTML=f,n.setAttribute("value",e),t.__select.appendChild(n)}),this.updateDisplay(),f.bind(this.__select,"change",function(){var e=this.options[this.selectedIndex].value;t.setValue(e)}),this.domElement.appendChild(this.__select)};return o.superclass=e,n.extend(o.prototype,e.prototype,{setValue:function(e){var f=o.superclass.prototype.setValue.call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),f},updateDisplay:function(){return this.__select.value=this.getValue(),o.superclass.prototype.updateDisplay.call(this)}}),o}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.NumberController=function(e,f){function n(e){return e=e.toString(),e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var o=function(e,d,i){o.superclass.call(this,e,d),i=i||{},this.__min=i.min,this.__max=i.max,this.__step=i.step,f.isUndefined(this.__step)?0==this.initialValue?this.__impliedStep=1:this.__impliedStep=Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__impliedStep=this.__step,this.__precision=n(this.__impliedStep)};return o.superclass=e,f.extend(o.prototype,e.prototype,{setValue:function(e){return void 0!==this.__min&&e<this.__min?e=this.__min:void 0!==this.__max&&e>this.__max&&(e=this.__max),void 0!==this.__step&&e%this.__step!=0&&(e=Math.round(e/this.__step)*this.__step),o.superclass.prototype.setValue.call(this,e)},min:function(e){return this.__min=e,this},max:function(e){return this.__max=e,this},step:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=n(e),this}}),o}(dat.controllers.Controller,dat.utils.common),dat.controllers.NumberControllerBox=function(e,f,n){function o(e,f){var n=Math.pow(10,f);return Math.round(e*n)/n}var d=function(e,o,i){function t(){var e=parseFloat(y.__input.value);n.isNaN(e)||y.setValue(e)}function l(){t(),y.__onFinishChange&&y.__onFinishChange.call(y,y.getValue())}function p(e){f.bind(window,"mousemove",u),f.bind(window,"mouseup",s),c=e.clientY}function u(e){var f=c-e.clientY;y.setValue(y.getValue()+f*y.__impliedStep),c=e.clientY}function s(){f.unbind(window,"mousemove",u),f.unbind(window,"mouseup",s)}this.__truncationSuspended=!1,d.superclass.call(this,e,o,i);var c,y=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),f.bind(this.__input,"change",t),f.bind(this.__input,"blur",l),f.bind(this.__input,"mousedown",p),f.bind(this.__input,"keydown",function(e){13===e.keyCode&&(y.__truncationSuspended=!0,this.blur(),y.__truncationSuspended=!1)}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return d.superclass=e,n.extend(d.prototype,e.prototype,{updateDisplay:function(){return this.__input.value=this.__truncationSuspended?this.getValue():o(this.getValue(),this.__precision),d.superclass.prototype.updateDisplay.call(this)}}),d}(dat.controllers.NumberController,dat.dom.dom,dat.utils.common),dat.controllers.NumberControllerSlider=function(e,f,n,o,d){function i(e,f,n,o,d){return o+(d-o)*((e-f)/(n-f))}var t=function(e,n,o,d,l){function p(e){f.bind(window,"mousemove",u),f.bind(window,"mouseup",s),u(e)}function u(e){e.preventDefault();var n=f.getOffset(c.__background),o=f.getWidth(c.__background);return c.setValue(i(e.clientX,n.left,n.left+o,c.__min,c.__max)),!1}function s(){f.unbind(window,"mousemove",u),f.unbind(window,"mouseup",s),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}t.superclass.call(this,e,n,{min:o,max:d,step:l});var c=this;this.__background=document.createElement("div"),this.__foreground=document.createElement("div"),f.bind(this.__background,"mousedown",p),f.addClass(this.__background,"slider"),f.addClass(this.__foreground,"slider-fg"),this.updateDisplay(),this.__background.appendChild(this.__foreground),this.domElement.appendChild(this.__background)};return t.superclass=e,t.useDefaultStyles=function(){n.inject(d)},o.extend(t.prototype,e.prototype,{updateDisplay:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",t.superclass.prototype.updateDisplay.call(this)}}),t}(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,"/**\n * dat-gui JavaScript Controller Library\n * http://code.google.com/p/dat-gui\n *\n * Copyright 2011 Data Arts Team, Google Creative Lab\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n */\n\n.slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}"),dat.controllers.FunctionController=function(e,f,n){var o=function(e,n,d){o.superclass.call(this,e,n);var i=this;this.__button=document.createElement("div"),this.__button.innerHTML=void 0===d?"Fire":d,f.bind(this.__button,"click",function(e){return e.preventDefault(),i.fire(),!1}),f.addClass(this.__button,"button"),this.domElement.appendChild(this.__button)};return o.superclass=e,n.extend(o.prototype,e.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.getValue().call(this.object)}}),o}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.BooleanController=function(e,f,n){var o=function(e,n){function d(){i.setValue(!i.__prev)}o.superclass.call(this,e,n);var i=this;this.__prev=this.getValue(),this.__checkbox=document.createElement("input"),this.__checkbox.setAttribute("type","checkbox"),f.bind(this.__checkbox,"change",d,!1),this.domElement.appendChild(this.__checkbox),this.updateDisplay()};return o.superclass=e,n.extend(o.prototype,e.prototype,{setValue:function(e){var f=o.superclass.prototype.setValue.call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),f},updateDisplay:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1,o.superclass.prototype.updateDisplay.call(this)}}),o}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.color.toString=function(e){return function(f){if(1==f.a||e.isUndefined(f.a)){for(var n=f.hex.toString(16);n.length<6;)n="0"+n;return"#"+n}return"rgba("+Math.round(f.r)+","+Math.round(f.g)+","+Math.round(f.b)+","+f.a+")"}}(dat.utils.common),dat.color.interpret=function(e,f){var n,o,d=function(){o=!1;var e=arguments.length>1?f.toArray(arguments):arguments[0];return f.each(i,function(d){return d.litmus(e)?(f.each(d.conversions,function(d,i){return n=d.read(e),o===!1&&n!==!1?(o=n,n.conversionName=i,n.conversion=d,f.BREAK):void 0}),f.BREAK):void 0}),o},i=[{litmus:f.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var f=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null===f?!1:{space:"HEX",hex:parseInt("0x"+f[1].toString()+f[1].toString()+f[2].toString()+f[2].toString()+f[3].toString()+f[3].toString())}},write:e},SIX_CHAR_HEX:{read:function(e){var f=e.match(/^#([A-F0-9]{6})$/i);return null===f?!1:{space:"HEX",hex:parseInt("0x"+f[1].toString())}},write:e},CSS_RGB:{read:function(e){var f=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null===f?!1:{space:"RGB",r:parseFloat(f[1]),g:parseFloat(f[2]),b:parseFloat(f[3])}},write:e},CSS_RGBA:{read:function(e){var f=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null===f?!1:{space:"RGB",r:parseFloat(f[1]),g:parseFloat(f[2]),b:parseFloat(f[3]),a:parseFloat(f[4])}},write:e}}},{litmus:f.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:f.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3!=e.length?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4!=e.length?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:f.isObject,conversions:{RGBA_OBJ:{read:function(e){return f.isNumber(e.r)&&f.isNumber(e.g)&&f.isNumber(e.b)&&f.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return f.isNumber(e.r)&&f.isNumber(e.g)&&f.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return f.isNumber(e.h)&&f.isNumber(e.s)&&f.isNumber(e.v)&&f.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return f.isNumber(e.h)&&f.isNumber(e.s)&&f.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}];return d}(dat.color.toString,dat.utils.common),dat.GUI=dat.gui.GUI=function(e,f,n,o,d,i,t,l,p,u,s,c,y,a,r){function w(e,f,n,i){if(void 0===f[n])throw new Error("Object "+f+' has no property "'+n+'"');var t;if(i.color)t=new s(f,n);else{var l=[f,n].concat(i.factoryArgs);t=o.apply(e,l)}i.before instanceof d&&(i.before=i.before.__li),m(e,t),a.addClass(t.domElement,"c");var p=document.createElement("span");a.addClass(p,"property-name"),p.innerHTML=t.property;var u=document.createElement("div");u.appendChild(p),u.appendChild(t.domElement);var c=b(e,u,i.before);return a.addClass(c,M.CLASS_CONTROLLER_ROW),a.addClass(c,typeof t.getValue()),g(e,c,t),e.__controllers.push(t),t}function b(e,f,n){var o=document.createElement("li");return f&&o.appendChild(f),n?e.__ul.insertBefore(o,params.before):e.__ul.appendChild(o),e.onResize(),o}function g(e,f,n){if(n.__li=f,n.__gui=e,r.extend(n,{options:function(f){return arguments.length>1?(n.remove(),w(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[r.toArray(arguments)]})):r.isArray(f)||r.isObject(f)?(n.remove(),w(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[f]})):void 0},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof p){var o=new l(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});r.each(["updateDisplay","onChange","onFinishChange"],function(e){var f=n[e],d=o[e];n[e]=o[e]=function(){var e=Array.prototype.slice.call(arguments);return f.apply(n,e),d.apply(o,e)}}),a.addClass(f,"has-slider"),n.domElement.insertBefore(o.domElement,n.domElement.firstElementChild)}else if(n instanceof l){var d=function(f){return r.isNumber(n.__min)&&r.isNumber(n.__max)?(n.remove(),w(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]})):f};n.min=r.compose(d,n.min),n.max=r.compose(d,n.max)}else n instanceof i?(a.bind(f,"click",function(){a.fakeEvent(n.__checkbox,"click")}),a.bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof t?(a.bind(f,"click",function(){a.fakeEvent(n.__button,"click")}),a.bind(f,"mouseover",function(){a.addClass(n.__button,"hover")}),a.bind(f,"mouseout",function(){a.removeClass(n.__button,"hover")})):n instanceof s&&(a.addClass(f,"color"),n.updateDisplay=r.compose(function(e){return f.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=r.compose(function(f){return e.getRoot().__preset_select&&n.isModified()&&A(e.getRoot(),!0),f},n.setValue)}function m(e,f){var n=e.getRoot(),o=n.__rememberedObjects.indexOf(f.object);if(-1!=o){var d=n.__rememberedObjectIndecesToControllers[o];if(void 0===d&&(d={},n.__rememberedObjectIndecesToControllers[o]=d),d[f.property]=f,n.load&&n.load.remembered){var i,t=n.load.remembered;if(t[e.preset])i=t[e.preset];else{if(!t[H])return;i=t[H]}if(i[o]&&void 0!==i[o][f.property]){var l=i[o][f.property];f.initialValue=l,f.setValue(l)}}}}function x(e,f){return document.location.href+"."+f;
}function j(e){function f(){u.style.display=e.useLocalStorage?"block":"none"}var n=e.__save_row=document.createElement("li");a.addClass(e.domElement,"has-save"),e.__ul.insertBefore(n,e.__ul.firstChild),a.addClass(n,"save-row");var o=document.createElement("span");o.innerHTML="&nbsp;",a.addClass(o,"button gears");var d=document.createElement("span");d.innerHTML="Save",a.addClass(d,"button"),a.addClass(d,"save");var i=document.createElement("span");i.innerHTML="New",a.addClass(i,"button"),a.addClass(i,"save-as");var t=document.createElement("span");t.innerHTML="Revert",a.addClass(t,"button"),a.addClass(t,"revert");var l=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?r.each(e.load.remembered,function(f,n){q(e,n,n==e.preset)}):q(e,H,!1),a.bind(l,"change",function(){for(var f=0;f<e.__preset_select.length;f++)e.__preset_select[f].innerHTML=e.__preset_select[f].value;e.preset=this.value}),n.appendChild(l),n.appendChild(o),n.appendChild(d),n.appendChild(i),n.appendChild(t),I){var p=document.getElementById("dg-save-locally"),u=document.getElementById("dg-local-explain");p.style.display="block";var s=document.getElementById("dg-local-storage");"true"===localStorage.getItem(x(e,"isLocal"))&&s.setAttribute("checked","checked"),f(),a.bind(s,"change",function(){e.useLocalStorage=!e.useLocalStorage,f()})}var c=document.getElementById("dg-new-constructor");a.bind(c,"keydown",function(e){!e.metaKey||67!==e.which&&67!=e.keyCode||C.hide()}),a.bind(o,"click",function(){c.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),C.show(),c.focus(),c.select()}),a.bind(d,"click",function(){e.save()}),a.bind(i,"click",function(){var f=prompt("Enter a new preset name.");f&&e.saveAs(f)}),a.bind(t,"click",function(){e.revert()})}function v(e){function f(f){return f.preventDefault(),d=f.clientX,a.addClass(e.__closeButton,M.CLASS_DRAG),a.bind(window,"mousemove",n),a.bind(window,"mouseup",o),!1}function n(f){return f.preventDefault(),e.width+=d-f.clientX,e.onResize(),d=f.clientX,!1}function o(){a.removeClass(e.__closeButton,M.CLASS_DRAG),a.unbind(window,"mousemove",n),a.unbind(window,"mouseup",o)}e.__resize_handle=document.createElement("div"),r.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var d;a.bind(e.__resize_handle,"mousedown",f),a.bind(e.__closeButton,"mousedown",f),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function h(e,f){e.domElement.style.width=f+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=f+"px"),e.__closeButton&&(e.__closeButton.style.width=f+"px")}function k(e,f){var n={};return r.each(e.__rememberedObjects,function(o,d){var i={},t=e.__rememberedObjectIndecesToControllers[d];r.each(t,function(e,n){i[n]=f?e.initialValue:e.getValue()}),n[d]=i}),n}function q(e,f,n){var o=document.createElement("option");o.innerHTML=f,o.value=f,e.__preset_select.appendChild(o),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function z(e){for(var f=0;f<e.__preset_select.length;f++)e.__preset_select[f].value==e.preset&&(e.__preset_select.selectedIndex=f)}function A(e,f){var n=e.__preset_select[e.__preset_select.selectedIndex];f?n.innerHTML=n.value+"*":n.innerHTML=n.value}function B(e){0!=e.length&&c(function(){B(e)}),r.each(e,function(e){e.updateDisplay()})}e.inject(n);var C,D,E="dg",F=72,G=20,H="Default",I=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}(),J=!0,K=!1,L=[],M=function(e){function f(){var e=n.getRoot();e.width+=1,r.defer(function(){e.width-=1})}var n=this;this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),a.addClass(this.domElement,E),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],e=e||{},e=r.defaults(e,{autoPlace:!0,width:M.DEFAULT_WIDTH}),e=r.defaults(e,{resizable:e.autoPlace,hideable:e.autoPlace}),r.isUndefined(e.load)?e.load={preset:H}:e.preset&&(e.load.preset=e.preset),r.isUndefined(e.parent)&&e.hideable&&L.push(this),e.resizable=r.isUndefined(e.parent)&&e.resizable,e.autoPlace&&r.isUndefined(e.scrollable)&&(e.scrollable=!0);var o,d=I&&"true"===localStorage.getItem(x(this,"isLocal"));if(Object.defineProperties(this,{parent:{get:function(){return e.parent}},scrollable:{get:function(){return e.scrollable}},autoPlace:{get:function(){return e.autoPlace}},preset:{get:function(){return n.parent?n.getRoot().preset:e.load.preset},set:function(f){n.parent?n.getRoot().preset=f:e.load.preset=f,z(this),n.revert()}},width:{get:function(){return e.width},set:function(f){e.width=f,h(n,f)}},name:{get:function(){return e.name},set:function(f){e.name=f,t&&(t.innerHTML=e.name)}},closed:{get:function(){return e.closed},set:function(f){e.closed=f,e.closed?a.addClass(n.__ul,M.CLASS_CLOSED):a.removeClass(n.__ul,M.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=f?M.TEXT_OPEN:M.TEXT_CLOSED)}},load:{get:function(){return e.load}},useLocalStorage:{get:function(){return d},set:function(e){I&&(d=e,e?a.bind(window,"unload",o):a.unbind(window,"unload",o),localStorage.setItem(x(n,"isLocal"),e))}}}),r.isUndefined(e.parent)){if(e.closed=!1,a.addClass(this.domElement,M.CLASS_MAIN),a.makeSelectable(this.domElement,!1),I&&d){n.useLocalStorage=!0;var i=localStorage.getItem(x(this,"gui"));i&&(e.load=JSON.parse(i))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=M.TEXT_CLOSED,a.addClass(this.__closeButton,M.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),a.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{void 0===e.closed&&(e.closed=!0);var t=document.createTextNode(e.name);a.addClass(t,"controller-name");var l=b(n,t),p=function(e){return e.preventDefault(),n.closed=!n.closed,!1};a.addClass(this.__ul,M.CLASS_CLOSED),a.addClass(l,"title"),a.bind(l,"click",p),e.closed||(this.closed=!1)}e.autoPlace&&(r.isUndefined(e.parent)&&(J&&(D=document.createElement("div"),a.addClass(D,E),a.addClass(D,M.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(D),J=!1),D.appendChild(this.domElement),a.addClass(this.domElement,M.CLASS_AUTO_PLACE)),this.parent||h(n,e.width)),a.bind(window,"resize",function(){n.onResize()}),a.bind(this.__ul,"webkitTransitionEnd",function(){n.onResize()}),a.bind(this.__ul,"transitionend",function(){n.onResize()}),a.bind(this.__ul,"oTransitionEnd",function(){n.onResize()}),this.onResize(),e.resizable&&v(this),o=function(){I&&"true"===localStorage.getItem(x(n,"isLocal"))&&localStorage.setItem(x(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=o;n.getRoot();e.parent||f()};return M.toggleHide=function(){K=!K,r.each(L,function(e){e.domElement.style.zIndex=K?-999:999,e.domElement.style.opacity=K?0:1})},M.CLASS_AUTO_PLACE="a",M.CLASS_AUTO_PLACE_CONTAINER="ac",M.CLASS_MAIN="main",M.CLASS_CONTROLLER_ROW="cr",M.CLASS_TOO_TALL="taller-than-window",M.CLASS_CLOSED="closed",M.CLASS_CLOSE_BUTTON="close-button",M.CLASS_DRAG="drag",M.DEFAULT_WIDTH=245,M.TEXT_CLOSED="Close Controls",M.TEXT_OPEN="Open Controls",a.bind(window,"keydown",function(e){"text"===document.activeElement.type||e.which!==F&&e.keyCode!=F||M.toggleHide()},!1),r.extend(M.prototype,{add:function(e,f){return w(this,e,f,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,f){return w(this,e,f,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.slice(this.__controllers.indexOf(e),1);var f=this;r.defer(function(){f.onResize()})},destroy:function(){this.autoPlace&&D.removeChild(this.domElement)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var f={name:e,parent:this};f.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(f.closed=this.load.folders[e].closed,f.load=this.load.folders[e]);var n=new M(f);this.__folders[e]=n;var o=b(this,n.domElement);return a.addClass(o,"folder"),n},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var f=a.getOffset(e.__ul).top,n=0;r.each(e.__ul.childNodes,function(f){e.autoPlace&&f===e.__save_row||(n+=a.getHeight(f))}),window.innerHeight-f-G<n?(a.addClass(e.domElement,M.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-f-G+"px"):(a.removeClass(e.domElement,M.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&r.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},remember:function(){if(r.isUndefined(C)&&(C=new y,C.domElement.innerHTML=f),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;r.each(Array.prototype.slice.call(arguments),function(f){0==e.__rememberedObjects.length&&j(e),-1==e.__rememberedObjects.indexOf(f)&&e.__rememberedObjects.push(f)}),this.autoPlace&&h(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=k(this)),e.folders={},r.each(this.__folders,function(f,n){e.folders[n]=f.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=k(this),A(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[H]=k(this,!0)),this.load.remembered[e]=k(this),this.preset=e,q(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){r.each(this.__controllers,function(f){this.getRoot().load.remembered?m(e||this.getRoot(),f):f.setValue(f.initialValue)},this),r.each(this.__folders,function(e){e.revert(e)}),e||A(this.getRoot(),!1)},listen:function(e){var f=0==this.__listening.length;this.__listening.push(e),f&&B(this.__listening)}}),M}(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',".dg {\n  /** Clear list styles */\n  /* Auto-place container */\n  /* Auto-placed GUI's */\n  /* Line items that don't contain folders. */\n  /** Folder names */\n  /** Hides closed items */\n  /** Controller row */\n  /** Name-half (left) */\n  /** Controller-half (right) */\n  /** Controller placement */\n  /** Shorter number boxes when slider is present. */\n  /** Ensure the entire boolean and function row shows a hand */ }\n  .dg ul {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n    width: 100%;\n    clear: both; }\n  .dg.ac {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 0;\n    z-index: 0; }\n  .dg:not(.ac) .main {\n    /** Exclude mains in ac so that we don't hide close button */\n    overflow: hidden; }\n  .dg.main {\n    -webkit-transition: opacity 0.1s linear;\n    -o-transition: opacity 0.1s linear;\n    -moz-transition: opacity 0.1s linear;\n    transition: opacity 0.1s linear; }\n    .dg.main.taller-than-window {\n      overflow-y: auto; }\n      .dg.main.taller-than-window .close-button {\n        opacity: 1;\n        /* TODO, these are style notes */\n        margin-top: -1px;\n        border-top: 1px solid #2c2c2c; }\n    .dg.main ul.closed .close-button {\n      opacity: 1 !important; }\n    .dg.main:hover .close-button,\n    .dg.main .close-button.drag {\n      opacity: 1; }\n    .dg.main .close-button {\n      /*opacity: 0;*/\n      -webkit-transition: opacity 0.1s linear;\n      -o-transition: opacity 0.1s linear;\n      -moz-transition: opacity 0.1s linear;\n      transition: opacity 0.1s linear;\n      border: 0;\n      position: absolute;\n      line-height: 19px;\n      height: 20px;\n      /* TODO, these are style notes */\n      cursor: pointer;\n      text-align: center;\n      background-color: #000; }\n      .dg.main .close-button:hover {\n        background-color: #111; }\n  .dg.a {\n    float: right;\n    margin-right: 15px;\n    overflow-x: hidden; }\n    .dg.a.has-save > ul {\n      margin-top: 27px; }\n      .dg.a.has-save > ul.closed {\n        margin-top: 0; }\n    .dg.a .save-row {\n      position: fixed;\n      top: 0;\n      z-index: 1002; }\n  .dg li {\n    -webkit-transition: height 0.1s ease-out;\n    -o-transition: height 0.1s ease-out;\n    -moz-transition: height 0.1s ease-out;\n    transition: height 0.1s ease-out; }\n  .dg li:not(.folder) {\n    cursor: auto;\n    height: 27px;\n    line-height: 27px;\n    overflow: hidden;\n    padding: 0 4px 0 5px; }\n  .dg li.folder {\n    padding: 0;\n    border-left: 4px solid rgba(0, 0, 0, 0); }\n  .dg li.title {\n    cursor: pointer;\n    margin-left: -4px; }\n  .dg .closed li:not(.title),\n  .dg .closed ul li,\n  .dg .closed ul li > * {\n    height: 0;\n    overflow: hidden;\n    border: 0; }\n  .dg .cr {\n    clear: both;\n    padding-left: 3px;\n    height: 27px; }\n  .dg .property-name {\n    cursor: default;\n    float: left;\n    clear: left;\n    width: 40%;\n    overflow: hidden;\n    text-overflow: ellipsis; }\n  .dg .c {\n    float: left;\n    width: 60%; }\n  .dg .c input[type=text] {\n    border: 0;\n    margin-top: 4px;\n    padding: 3px;\n    width: 100%;\n    float: right; }\n  .dg .has-slider input[type=text] {\n    width: 30%;\n    /*display: none;*/\n    margin-left: 0; }\n  .dg .slider {\n    float: left;\n    width: 66%;\n    margin-left: -5px;\n    margin-right: 0;\n    height: 19px;\n    margin-top: 4px; }\n  .dg .slider-fg {\n    height: 100%; }\n  .dg .c input[type=checkbox] {\n    margin-top: 9px; }\n  .dg .c select {\n    margin-top: 5px; }\n  .dg .cr.function,\n  .dg .cr.function .property-name,\n  .dg .cr.function *,\n  .dg .cr.boolean,\n  .dg .cr.boolean * {\n    cursor: pointer; }\n  .dg .selector {\n    display: none;\n    position: absolute;\n    margin-left: -9px;\n    margin-top: 23px;\n    z-index: 10; }\n  .dg .c:hover .selector,\n  .dg .selector.drag {\n    display: block; }\n  .dg li.save-row {\n    padding: 0; }\n    .dg li.save-row .button {\n      display: inline-block;\n      padding: 0px 6px; }\n  .dg.dialogue {\n    background-color: #222;\n    width: 460px;\n    padding: 15px;\n    font-size: 13px;\n    line-height: 15px; }\n\n/* TODO Separate style and structure */\n#dg-new-constructor {\n  padding: 10px;\n  color: #222;\n  font-family: Monaco, monospace;\n  font-size: 10px;\n  border: 0;\n  resize: none;\n  box-shadow: inset 1px 1px 1px #888;\n  word-wrap: break-word;\n  margin: 12px 0;\n  display: block;\n  width: 440px;\n  overflow-y: scroll;\n  height: 100px;\n  position: relative; }\n\n#dg-local-explain {\n  display: none;\n  font-size: 11px;\n  line-height: 17px;\n  border-radius: 3px;\n  background-color: #333;\n  padding: 8px;\n  margin-top: 10px; }\n  #dg-local-explain code {\n    font-size: 10px; }\n\n#dat-gui-save-locally {\n  display: none; }\n\n/** Main type */\n.dg {\n  color: #eee;\n  font: 11px 'Lucida Grande', sans-serif;\n  text-shadow: 0 -1px 0 #111;\n  /** Auto place */\n  /* Controller row, <li> */\n  /** Controllers */ }\n  .dg.main {\n    /** Scrollbar */ }\n    .dg.main::-webkit-scrollbar {\n      width: 5px;\n      background: #1a1a1a; }\n    .dg.main::-webkit-scrollbar-corner {\n      height: 0;\n      display: none; }\n    .dg.main::-webkit-scrollbar-thumb {\n      border-radius: 5px;\n      background: #676767; }\n  .dg li:not(.folder) {\n    background: #1a1a1a;\n    border-bottom: 1px solid #2c2c2c; }\n  .dg li.save-row {\n    line-height: 25px;\n    background: #dad5cb;\n    border: 0; }\n    .dg li.save-row select {\n      margin-left: 5px;\n      width: 108px; }\n    .dg li.save-row .button {\n      margin-left: 5px;\n      margin-top: 1px;\n      border-radius: 2px;\n      font-size: 9px;\n      line-height: 7px;\n      padding: 4px 4px 5px 4px;\n      background: #c5bdad;\n      color: #fff;\n      text-shadow: 0 1px 0 #b0a58f;\n      box-shadow: 0 -1px 0 #b0a58f;\n      cursor: pointer; }\n      .dg li.save-row .button.gears {\n        background: #c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;\n        height: 7px;\n        width: 8px; }\n      .dg li.save-row .button:hover {\n        background-color: #bab19e;\n        box-shadow: 0 -1px 0 #b0a58f; }\n  .dg li.folder {\n    border-bottom: 0; }\n  .dg li.title {\n    padding-left: 16px;\n    background: black url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;\n    cursor: pointer;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.2); }\n  .dg .closed li.title {\n    background-image: url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==); }\n  .dg .cr.boolean {\n    border-left: 3px solid #806787; }\n  .dg .cr.function {\n    border-left: 3px solid #e61d5f; }\n  .dg .cr.number {\n    border-left: 3px solid #2fa1d6; }\n    .dg .cr.number input[type=text] {\n      color: #2fa1d6; }\n  .dg .cr.string {\n    border-left: 3px solid #1ed36f; }\n    .dg .cr.string input[type=text] {\n      color: #1ed36f; }\n  .dg .cr.function:hover, .dg .cr.boolean:hover {\n    background: #111; }\n  .dg .c input[type=text] {\n    background: #303030;\n    outline: none; }\n    .dg .c input[type=text]:hover {\n      background: #3c3c3c; }\n    .dg .c input[type=text]:focus {\n      background: #494949;\n      color: #fff; }\n  .dg .c .slider {\n    background: #303030;\n    cursor: ew-resize; }\n  .dg .c .slider-fg {\n    background: #2fa1d6; }\n  .dg .c .slider:hover {\n    background: #3c3c3c; }\n    .dg .c .slider:hover .slider-fg {\n      background: #44abda; }\n",dat.controllers.factory=function(e,f,n,o,d,i,t){return function(l,p){var u=l[p];return t.isArray(arguments[2])||t.isObject(arguments[2])?new e(l,p,arguments[2]):t.isNumber(u)?t.isNumber(arguments[2])&&t.isNumber(arguments[3])?new n(l,p,arguments[2],arguments[3]):new f(l,p,{min:arguments[2],max:arguments[3]}):t.isString(u)?new o(l,p):t.isFunction(u)?new d(l,p,""):t.isBoolean(u)?new i(l,p):void 0}}(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=function(e,f,n){var o=function(e,n){function d(){t.setValue(t.__input.value)}function i(){t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())}o.superclass.call(this,e,n);var t=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),f.bind(this.__input,"keyup",d),f.bind(this.__input,"change",d),f.bind(this.__input,"blur",i),f.bind(this.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return o.superclass=e,n.extend(o.prototype,e.prototype,{updateDisplay:function(){return f.isActive(this.__input)||(this.__input.value=this.getValue()),o.superclass.prototype.updateDisplay.call(this)}}),o}(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,dat.controllers.ColorController=function(e,f,n,o,d){function i(e,f,n,o){e.style.background="",d.each(p,function(d){e.style.cssText+="background: "+d+"linear-gradient("+f+", "+n+" 0%, "+o+" 100%); "})}function t(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var l=function(e,p){function u(e){a(e),f.bind(window,"mousemove",a),f.bind(window,"mouseup",s)}function s(){f.unbind(window,"mousemove",a),f.unbind(window,"mouseup",s)}function c(){var e=o(this.value);e!==!1?(w.__color.__state=e,w.setValue(w.__color.toOriginal())):this.value=w.__color.toString()}function y(){f.unbind(window,"mousemove",r),f.unbind(window,"mouseup",y)}function a(e){e.preventDefault();var n=f.getWidth(w.__saturation_field),o=f.getOffset(w.__saturation_field),d=(e.clientX-o.left+document.body.scrollLeft)/n,i=1-(e.clientY-o.top+document.body.scrollTop)/n;return i>1?i=1:0>i&&(i=0),d>1?d=1:0>d&&(d=0),w.__color.v=i,w.__color.s=d,w.setValue(w.__color.toOriginal()),!1}function r(e){e.preventDefault();var n=f.getHeight(w.__hue_field),o=f.getOffset(w.__hue_field),d=1-(e.clientY-o.top+document.body.scrollTop)/n;return d>1?d=1:0>d&&(d=0),w.__color.h=360*d,w.setValue(w.__color.toOriginal()),!1}l.superclass.call(this,e,p),this.__color=new n(this.getValue()),this.__temp=new n(0);var w=this;this.domElement=document.createElement("div"),f.makeSelectable(this.domElement,!1),this.__selector=document.createElement("div"),this.__selector.className="selector",this.__saturation_field=document.createElement("div"),this.__saturation_field.className="saturation-field",this.__field_knob=document.createElement("div"),this.__field_knob.className="field-knob",this.__field_knob_border="2px solid ",this.__hue_knob=document.createElement("div"),this.__hue_knob.className="hue-knob",this.__hue_field=document.createElement("div"),this.__hue_field.className="hue-field",this.__input=document.createElement("input"),this.__input.type="text",this.__input_textShadow="0 1px 1px ",f.bind(this.__input,"keydown",function(e){13===e.keyCode&&c.call(this)}),f.bind(this.__input,"blur",c),f.bind(this.__selector,"mousedown",function(e){f.addClass(this,"drag").bind(window,"mouseup",function(e){f.removeClass(w.__selector,"drag")})});var b=document.createElement("div");d.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),d.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),d.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),d.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),d.extend(b.style,{width:"100%",height:"100%",background:"none"}),i(b,"top","rgba(0,0,0,0)","#000"),d.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"}),t(this.__hue_field),d.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"}),f.bind(this.__saturation_field,"mousedown",u),f.bind(this.__field_knob,"mousedown",u),f.bind(this.__hue_field,"mousedown",function(e){r(e),f.bind(window,"mousemove",r),f.bind(window,"mouseup",y)}),this.__saturation_field.appendChild(b),this.__selector.appendChild(this.__field_knob),this.__selector.appendChild(this.__saturation_field),this.__selector.appendChild(this.__hue_field),this.__hue_field.appendChild(this.__hue_knob),this.domElement.appendChild(this.__input),this.domElement.appendChild(this.__selector),this.updateDisplay()};l.superclass=e,d.extend(l.prototype,e.prototype,{updateDisplay:function(){var e=o(this.getValue());if(e!==!1){var f=!1;d.each(n.COMPONENTS,function(n){return d.isUndefined(e[n])||d.isUndefined(this.__color.__state[n])||e[n]===this.__color.__state[n]?void 0:(f=!0,{})},this),f&&d.extend(this.__color.__state,e)}d.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var t=this.__color.v<.5||this.__color.s>.5?255:0,l=255-t;d.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+t+","+t+","+t+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,i(this.__saturation_field,"left","#fff",this.__temp.toString()),d.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+t+","+t+","+t+")",textShadow:this.__input_textShadow+"rgba("+l+","+l+","+l+",.7)"})}});var p=["-moz-","-o-","-webkit-","-ms-",""];return l}(dat.controllers.Controller,dat.dom.dom,dat.color.Color=function(e,f,n,o){function d(e,f,n){Object.defineProperty(e,f,{get:function(){return"RGB"===this.__state.space?this.__state[f]:(t(this,f,n),this.__state[f])},set:function(e){"RGB"!==this.__state.space&&(t(this,f,n),this.__state.space="RGB"),this.__state[f]=e}})}function i(e,f){Object.defineProperty(e,f,{get:function(){return"HSV"===this.__state.space?this.__state[f]:(l(this),this.__state[f])},set:function(e){"HSV"!==this.__state.space&&(l(this),this.__state.space="HSV"),this.__state[f]=e}})}function t(e,n,d){if("HEX"===e.__state.space)e.__state[n]=f.component_from_hex(e.__state.hex,d);else{if("HSV"!==e.__state.space)throw"Corrupted color state";o.extend(e.__state,f.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}}function l(e){var n=f.rgb_to_hsv(e.r,e.g,e.b);o.extend(e.__state,{s:n.s,v:n.v}),o.isNaN(n.h)?o.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=n.h}var p=function(){if(this.__state=e.apply(this,arguments),this.__state===!1)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};return p.COMPONENTS=["r","g","b","h","s","v","hex","a"],o.extend(p.prototype,{toString:function(){return n(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),d(p.prototype,"r",2),d(p.prototype,"g",1),d(p.prototype,"b",0),i(p.prototype,"h"),i(p.prototype,"s"),i(p.prototype,"v"),Object.defineProperty(p.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(p.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=f.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}}),p}(dat.color.interpret,dat.color.math=function(){var e;return{hsv_to_rgb:function(e,f,n){var o=Math.floor(e/60)%6,d=e/60-Math.floor(e/60),i=n*(1-f),t=n*(1-d*f),l=n*(1-(1-d)*f),p=[[n,l,i],[t,n,i],[i,n,l],[i,t,n],[l,i,n],[n,i,t]][o];return{r:255*p[0],g:255*p[1],b:255*p[2]}},rgb_to_hsv:function(e,f,n){var o,d,i=Math.min(e,f,n),t=Math.max(e,f,n),l=t-i;return 0==t?{h:NaN,s:0,v:0}:(d=l/t,o=e==t?(f-n)/l:f==t?2+(n-e)/l:4+(e-f)/l,o/=6,0>o&&(o+=1),{h:360*o,s:d,v:t/255})},rgb_to_hex:function(e,f,n){var o=this.hex_with_component(0,2,e);return o=this.hex_with_component(o,1,f),o=this.hex_with_component(o,0,n)},component_from_hex:function(e,f){return e>>8*f&255},hex_with_component:function(f,n,o){return o<<(e=8*n)|f&~(255<<e)}}}(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,f){window.setTimeout(e,1e3/60)}}(),dat.dom.CenteredDiv=function(e,f){var n=function(){this.backgroundElement=document.createElement("div"),f.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"}),e.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),f.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var n=this;e.bind(this.backgroundElement,"click",function(){n.hide()})};return n.prototype.show=function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),f.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})},n.prototype.hide=function(){var f=this,n=function(){f.domElement.style.display="none",f.backgroundElement.style.display="none",e.unbind(f.domElement,"webkitTransitionEnd",n),e.unbind(f.domElement,"transitionend",n),e.unbind(f.domElement,"oTransitionEnd",n)};e.bind(this.domElement,"webkitTransitionEnd",n),e.bind(this.domElement,"transitionend",n),e.bind(this.domElement,"oTransitionEnd",n),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},n.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-e.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-e.getHeight(this.domElement)/2+"px"},n}(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common),function(e){function f(n,o){e.EventEmitter.call(this),o=o||{},window.app=this;var d=this;n.setup?n={"default":n}:"function"==typeof n&&(n={"default":{setup:n}}),this.scenes=n,this.state=f.DEFAULT,this.bodies=[],this.springs=[],this.timeStep=1/60,this.relaxation=e.Equation.DEFAULT_RELAXATION,this.stiffness=e.Equation.DEFAULT_STIFFNESS,this.mouseConstraint=null,this.nullBody=new e.Body,this.pickPrecision=5,this.useInterpolatedPositions=!0,this.drawPoints=[],this.drawPointsChangeEvent={type:"drawPointsChange"},this.drawCircleCenter=e.vec2.create(),this.drawCirclePoint=e.vec2.create(),this.drawCircleChangeEvent={type:"drawCircleChange"},this.drawRectangleChangeEvent={type:"drawRectangleChange"},this.drawRectStart=e.vec2.create(),this.drawRectEnd=e.vec2.create(),this.stateChangeEvent={type:"stateChange",state:null},this.mousePosition=e.vec2.create(),this.newShapeCollisionMask=1,this.newShapeCollisionGroup=1,this.drawConstraints=!1,this.stats_sum=0,this.stats_N=100,this.stats_Nsummed=0,this.stats_average=-1,this.addedGlobals=[],this.settings={tool:f.DEFAULT,fullscreen:function(){var e=document.body,f=e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen;f&&f.call(e)},"paused [p]":!1,"manualStep [s]":function(){d.world.step(d.world.lastTimeStep)},fps:60,maxSubSteps:3,gravityX:0,gravityY:-10,sleepMode:e.World.NO_SLEEPING,"drawContacts [c]":!1,"drawAABBs [t]":!1,drawConstraints:!1,iterations:10,stiffness:1e6,
relaxation:4,tolerance:1e-4},this.init(),this.resizeToFit(),this.render(),this.createStats(),this.addLogo(),this.centerCamera(0,0),window.onresize=function(){d.resizeToFit()},this.setUpKeyboard(),this.setupGUI(),"undefined"==typeof o.hideGUI&&(o.hideGUI="auto"),("auto"===o.hideGUI&&window.innerWidth<600||o.hideGUI===!0)&&this.gui.close(),this.printConsoleMessage(),this.setSceneByIndex(0),this.startRenderingLoop()}var n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},o=["-ms-user-select: none","-moz-user-select: -moz-none","-khtml-user-select: none","-webkit-user-select: none","user-select: none"];e.Renderer=f,f.prototype=new e.EventEmitter,f.DEFAULT=1,f.PANNING=2,f.DRAGGING=3,f.DRAWPOLYGON=4,f.DRAWINGPOLYGON=5,f.DRAWCIRCLE=6,f.DRAWINGCIRCLE=7,f.DRAWRECTANGLE=8,f.DRAWINGRECTANGLE=9,f.toolStateMap={"pick/pan [q]":f.DEFAULT,"polygon [d]":f.DRAWPOLYGON,"circle [a]":f.DRAWCIRCLE,"rectangle [f]":f.DRAWRECTANGLE},f.stateToolMap={};for(var d in f.toolStateMap)f.stateToolMap[f.toolStateMap[d]]=d;f.keydownEvent={type:"keydown",originalEvent:null,keyCode:0},f.keyupEvent={type:"keyup",originalEvent:null,keyCode:0},Object.defineProperty(f.prototype,"drawContacts",{get:function(){return this.settings["drawContacts [c]"]},set:function(e){this.settings["drawContacts [c]"]=e,this.updateGUI()}}),Object.defineProperty(f.prototype,"drawAABBs",{get:function(){return this.settings["drawAABBs [t]"]},set:function(e){this.settings["drawAABBs [t]"]=e,this.updateGUI()}}),Object.defineProperty(f.prototype,"paused",{get:function(){return this.settings["paused [p]"]},set:function(e){this.resetCallTime=!0,this.settings["paused [p]"]=e,this.updateGUI()}}),f.prototype.getDevicePixelRatio=function(){return window.devicePixelRatio||1},f.prototype.printConsoleMessage=function(){console.log(["=== p2.js v"+e.version+" ===","Welcome to the p2.js debugging environment!","Did you know you can interact with the physics here in the console? Try executing the following:","","  world.gravity[1] = 10;",""].join("\n"))},f.prototype.resizeToFit=function(){var e=this.getDevicePixelRatio(),f=this.elementContainer.getBoundingClientRect(),n=f.width*e,o=f.height*e;this.resize(n,o)},f.prototype.setupGUI=function(){function n(){isNaN(t.gravityX)||isNaN(t.gravityY)||e.vec2.set(d.world.gravity,t.gravityX,t.gravityY)}if("undefined"!=typeof dat){var d=this,i=this.gui=new dat.GUI;i.domElement.setAttribute("style",o.join(";"));var t=this.settings;i.add(t,"tool",f.toolStateMap).onChange(function(e){d.setState(parseInt(e))}),i.add(t,"fullscreen");var l=i.addFolder("World");l.open(),l.add(t,"paused [p]").onChange(function(e){d.paused=e}),l.add(t,"manualStep [s]"),l.add(t,"fps",10,600).step(10).onChange(function(e){d.timeStep=1/e}),l.add(t,"maxSubSteps",0,10).step(1);var p=100;l.add(t,"gravityX",-p,p).onChange(n),l.add(t,"gravityY",-p,p).onChange(n),l.add(t,"sleepMode",{NO_SLEEPING:e.World.NO_SLEEPING,BODY_SLEEPING:e.World.BODY_SLEEPING,ISLAND_SLEEPING:e.World.ISLAND_SLEEPING}).onChange(function(e){d.world.sleepMode=parseInt(e)});var u=i.addFolder("Rendering");u.open(),u.add(t,"drawContacts [c]").onChange(function(e){d.drawContacts=e}),u.add(t,"drawAABBs [t]").onChange(function(e){d.drawAABBs=e});var s=i.addFolder("Solver");s.open(),s.add(t,"iterations",1,100).step(1).onChange(function(e){d.world.solver.iterations=e}),s.add(t,"stiffness",10).onChange(function(e){d.setEquationParameters()}),s.add(t,"relaxation",0,20).step(.1).onChange(function(e){d.setEquationParameters()}),s.add(t,"tolerance",0,10).step(.01).onChange(function(e){d.world.solver.tolerance=e});var c=i.addFolder("Scenes");c.open();var y=1;for(var a in this.scenes){var r=a+" ["+y++ +"]";this.settings[r]=function(){d.setScene(d.scenes[a])},c.add(t,r)}}},f.prototype.updateGUI=function(){function e(f){for(var n in f.__controllers)f.__controllers[n].updateDisplay();for(var o in f.__folders)e(f.__folders[o])}this.gui&&e(this.gui)},f.prototype.setWorld=function(e){this.world=e,window.world=e;var f=this;e.on("postStep",function(e){f.updateStats()}).on("addBody",function(e){f.addVisual(e.body)}).on("removeBody",function(e){f.removeVisual(e.body)}).on("addSpring",function(e){f.addVisual(e.spring)}).on("removeSpring",function(e){f.removeVisual(e.spring)})},f.prototype.setScene=function(e){"string"==typeof e&&(e=this.scenes[e]),this.removeAllVisuals(),this.currentScene&&this.currentScene.teardown&&this.currentScene.teardown(),this.world&&this.world.clear();for(var f=0;f<this.addedGlobals.length;f++)delete window[this.addedGlobals];var n=Object.keys(window);if(this.currentScene=e,this.world=null,e.setup.call(this),!this.world)throw new Error("The .setup function in the scene definition must run this.setWorld(world);");for(var o=Object.keys(window),d=[],f=0;f<o.length;f++)-1===n.indexOf(o[f])&&"world"!==o[f]&&d.push(o[f]);d.length&&(d.sort(),console.log(["The following variables were exposed globally from this physics scene.","","  "+d.join(", "),""].join("\n"))),this.addedGlobals=d;var i=this.settings;i.iterations=this.world.solver.iterations,i.tolerance=this.world.solver.tolerance,i.gravityX=this.world.gravity[0],i.gravityY=this.world.gravity[1],i.sleepMode=this.world.sleepMode,this.updateGUI()},f.prototype.setSceneByIndex=function(e){var f=0;for(var n in this.scenes){if(f===e){this.setScene(this.scenes[n]);break}f++}},f.elementClass="p2-canvas",f.containerClass="p2-container",f.prototype.setUpKeyboard=function(){var e=this;this.elementContainer.onkeydown=function(n){if(n.keyCode){var o=e.state,d=String.fromCharCode(n.keyCode);switch(d){case"P":e.paused=!e.paused;break;case"S":e.world.step(e.world.lastTimeStep);break;case"R":e.setScene(e.currentScene);break;case"C":e.drawContacts=!e.drawContacts,e.drawConstraints=!e.drawConstraints;break;case"T":e.drawAABBs=!e.drawAABBs;break;case"D":e.setState(o===f.DRAWPOLYGON?f.DEFAULT:o=f.DRAWPOLYGON);break;case"A":e.setState(o===f.DRAWCIRCLE?f.DEFAULT:o=f.DRAWCIRCLE);break;case"F":e.setState(o===f.DRAWRECTANGLE?f.DEFAULT:o=f.DRAWRECTANGLE);break;case"Q":e.setState(f.DEFAULT);break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":e.setSceneByIndex(parseInt(d)-1);break;default:f.keydownEvent.keyCode=n.keyCode,f.keydownEvent.originalEvent=n,e.emit(f.keydownEvent)}e.updateGUI()}},this.elementContainer.onkeyup=function(n){if(n.keyCode)switch(String.fromCharCode(n.keyCode)){default:f.keyupEvent.keyCode=n.keyCode,f.keyupEvent.originalEvent=n,e.emit(f.keyupEvent)}}},f.prototype.startRenderingLoop=function(){function e(){if(!f.paused){var d=Date.now()/1e3,i=d-o;f.resetCallTime&&(i=0,f.resetCallTime=!1),o=d,i=Math.min(i,.5),f.world.step(f.timeStep,i,f.settings.maxSubSteps)}f.render(),n(e)}var f=this,o=Date.now()/1e3;n(e)},f.prototype.setState=function(e){this.state=e,this.stateChangeEvent.state=e,this.emit(this.stateChangeEvent),f.stateToolMap[e]&&(this.settings.tool=e,this.updateGUI())},f.prototype.handleMouseDown=function(n){switch(this.state){case f.DEFAULT:for(var o,d=this.world.hitTest(n,this.world.bodies,this.pickPrecision);d.length>0&&(o=d.shift(),o.type===e.Body.STATIC);)o=null;if(o){o.wakeUp(),this.setState(f.DRAGGING);var i=e.vec2.create();o.toLocalFrame(i,n),this.world.addBody(this.nullBody),this.mouseConstraint=new e.RevoluteConstraint(this.nullBody,o,{localPivotA:n,localPivotB:i,maxForce:1e3*o.mass}),this.world.addConstraint(this.mouseConstraint)}else this.setState(f.PANNING);break;case f.DRAWPOLYGON:this.setState(f.DRAWINGPOLYGON),this.drawPoints=[];var t=e.vec2.create();e.vec2.copy(t,n),this.drawPoints.push(t),this.emit(this.drawPointsChangeEvent);break;case f.DRAWCIRCLE:this.setState(f.DRAWINGCIRCLE),e.vec2.copy(this.drawCircleCenter,n),e.vec2.copy(this.drawCirclePoint,n),this.emit(this.drawCircleChangeEvent);break;case f.DRAWRECTANGLE:this.setState(f.DRAWINGRECTANGLE),e.vec2.copy(this.drawRectStart,n),e.vec2.copy(this.drawRectEnd,n),this.emit(this.drawRectangleChangeEvent)}},f.prototype.handleMouseMove=function(n){e.vec2.copy(this.mousePosition,n);var o=.4;switch(this.state){case f.DEFAULT:case f.DRAGGING:this.mouseConstraint&&(e.vec2.copy(this.mouseConstraint.pivotA,n),this.mouseConstraint.bodyA.wakeUp(),this.mouseConstraint.bodyB.wakeUp());break;case f.DRAWINGPOLYGON:var d=e.vec2.distance(n,this.drawPoints[this.drawPoints.length-1]);if(d>o*o){var i=[0,0];e.vec2.copy(i,n),this.drawPoints.push(i),this.emit(this.drawPointsChangeEvent)}break;case f.DRAWINGCIRCLE:e.vec2.copy(this.drawCirclePoint,n),this.emit(this.drawCircleChangeEvent);break;case f.DRAWINGRECTANGLE:e.vec2.copy(this.drawRectEnd,n),this.emit(this.drawRectangleChangeEvent)}},f.prototype.handleMouseUp=function(n){var o;switch(this.state){case f.DEFAULT:break;case f.DRAGGING:this.world.removeConstraint(this.mouseConstraint),this.mouseConstraint=null,this.world.removeBody(this.nullBody),this.setState(f.DEFAULT);break;case f.PANNING:this.setState(f.DEFAULT);break;case f.DRAWINGPOLYGON:this.setState(f.DRAWPOLYGON),this.drawPoints.length>3&&(o=new e.Body({mass:1}),o.fromPolygon(this.drawPoints,{removeCollinearPoints:.1})&&this.world.addBody(o)),this.drawPoints=[],this.emit(this.drawPointsChangeEvent);break;case f.DRAWINGCIRCLE:this.setState(f.DRAWCIRCLE);var d=e.vec2.distance(this.drawCircleCenter,this.drawCirclePoint);if(d>0){o=new e.Body({mass:1,position:this.drawCircleCenter});var i=new e.Circle({radius:d});o.addShape(i),this.world.addBody(o)}e.vec2.copy(this.drawCircleCenter,this.drawCirclePoint),this.emit(this.drawCircleChangeEvent);break;case f.DRAWINGRECTANGLE:this.setState(f.DRAWRECTANGLE);for(var t=this.drawRectStart,l=this.drawRectEnd,p=0;2>p;p++)if(t[p]>l[p]){var u=l[p];l[p]=t[p],t[p]=u}var s=Math.abs(t[0]-l[0]),c=Math.abs(t[1]-l[1]);if(s>0&&c>0){o=new e.Body({mass:1,position:[this.drawRectStart[0]+.5*s,this.drawRectStart[1]+.5*c]});var y=new e.Box({width:s,height:c});o.addShape(y),this.world.addBody(o)}e.vec2.copy(this.drawRectEnd,this.drawRectStart),this.emit(this.drawRectangleChangeEvent)}if(o){o.wakeUp();for(var p=0;p<o.shapes.length;p++){var a=o.shapes[p];a.collisionMask=this.newShapeCollisionMask,a.collisionGroup=this.newShapeCollisionGroup}}},f.prototype.updateStats=function(){this.stats_sum+=this.world.lastStepTime,this.stats_Nsummed++,this.stats_Nsummed===this.stats_N&&(this.stats_average=this.stats_sum/this.stats_N,this.stats_sum=0,this.stats_Nsummed=0)},f.prototype.addVisual=function(f){f instanceof e.LinearSpring?(this.springs.push(f),this.addRenderable(f)):f instanceof e.Body&&f.shapes.length&&(this.bodies.push(f),this.addRenderable(f))},f.prototype.removeAllVisuals=function(){for(var e=this.bodies,f=this.springs;e.length;)this.removeVisual(e[e.length-1]);for(;f.length;)this.removeVisual(f[f.length-1])},f.prototype.removeVisual=function(f){if(this.removeRenderable(f),f instanceof e.LinearSpring){var n=this.springs.indexOf(f);-1!==n&&this.springs.splice(n,1)}else if(f instanceof e.Body){var n=this.bodies.indexOf(f);-1!==n&&this.bodies.splice(n,1)}else console.error("Visual type not recognized...")},f.prototype.createStats=function(){},f.prototype.addLogo=function(){var e=["position:absolute","left:10px","top:15px","text-align:center","font: 13px Helvetica, arial, freesans, clean, sans-serif"].concat(o),f=document.createElement("div");f.innerHTML=["<div style='"+e.join(";")+"' user-select='none'>","<h1 style='margin:0px'><a href='http://github.com/schteppe/p2.js' style='color:black; text-decoration:none;'>p2.js</a></h1>","<p style='margin:5px'>Physics Engine</p>",'<a style="color:black; text-decoration:none;" href="https://twitter.com/share" class="twitter-share-button" data-via="schteppe" data-count="none" data-hashtags="p2js">Tweet</a>',"</div>"].join(""),this.elementContainer.appendChild(f),!function(e,f,n){var o,d=e.getElementsByTagName(f)[0],i=/^http:/.test(e.location)?"http":"https";e.getElementById(n)||(o=e.createElement(f),o.id=n,o.src=i+"://platform.twitter.com/widgets.js",d.parentNode.insertBefore(o,d))}(document,"script","twitter-wjs")},f.zoomInEvent={type:"zoomin"},f.zoomOutEvent={type:"zoomout"},f.prototype.setEquationParameters=function(){this.world.setGlobalStiffness(this.settings.stiffness),this.world.setGlobalRelaxation(this.settings.relaxation)}}(p2),function(e){function f(f,n){n=n||{};var o=this,d={lineWidth:.01,scrollFactor:.1,width:1280,height:720,useDeviceAspect:!1,sleepOpacity:.2};for(var t in n)d[t]=n[t];d.useDeviceAspect&&(d.height=window.innerHeight/window.innerWidth*d.width),this.lineWidth=d.lineWidth,this.scrollFactor=d.scrollFactor,this.sleepOpacity=d.sleepOpacity,this.sprites=[],this.springSprites=[],this.debugPolygons=!1,this.islandColors={},i.call(this,f,n);for(var t in d)this.settings[t]=d[t];this.pickPrecision=.1,this.on("drawPointsChange",function(e){var f=o.drawShapeGraphics,n=o.drawPoints;f.clear();for(var d=[],i=0;i<n.length;i++){var t=n[i];d.push([t[0],t[1]])}o.drawPath(f,d,16711680,!1,o.lineWidth,!1)}),this.on("drawCircleChange",function(f){var n=o.drawShapeGraphics;n.clear();var d=o.drawCircleCenter,i=e.vec2.distance(d,o.drawCirclePoint);o.drawCircle(n,d[0],d[1],0,i,!1,o.lineWidth)}),this.on("drawRectangleChange",function(e){var f=o.drawShapeGraphics;f.clear();var n=o.drawRectStart,d=o.drawRectEnd,i=n[0]-d[0],t=n[1]-d[1];o.drawRectangle(f,n[0]-i/2,n[1]-t/2,0,i,t,!1,!1,o.lineWidth,!1)})}function n(e){var f=e.toString(16);return 1===f.length?"0"+f:f}function o(e,f,o){return n(e)+n(f)+n(o)}function d(){var e=[255,255,255],f=Math.floor(256*Math.random()),n=Math.floor(256*Math.random()),d=Math.floor(256*Math.random());return f=Math.floor((f+3*e[0])/4),n=Math.floor((n+3*e[1])/4),d=Math.floor((d+3*e[2])/4),o(f,n,d)}e.WebGLRenderer=f;var i=e.Renderer;f.prototype=Object.create(i.prototype),f.prototype.stagePositionToPhysics=function(f,n){var o=n[0],d=n[1];return e.vec2.set(f,o,d),f};var t=e.vec2.create(),l=e.vec2.create();f.prototype.init=function(){function f(e){e=window.event||e;var f,n=e,d=n.detail,i=n.wheelDelta,t=225,l=t-1;d=d?i&&(f=i/d)?d/f:-d/1.35:i/120,d=1>d?-1>d?(-Math.pow(d,2)-l)/t:d:(Math.pow(d,2)+l)/t;var p=Math.min(Math.max(d/2,-1),1),u=p>=0;"undefined"!=typeof a&&o.zoom(a,r,u,void 0,void 0,p)}var n=(this.w,this.h,this.settings),o=this,d=(this.renderer=PIXI.autoDetectRenderer(n.width,n.height,null,null,!0),this.stage=new PIXI.DisplayObjectContainer),p=this.container=new PIXI.Stage(16777215,!0),u=this.element=this.renderer.view;u.tabIndex=1,u.classList.add(i.elementClass),u.setAttribute("style","width:100%;");var s=this.elementContainer=document.createElement("div");s.classList.add(i.containerClass),s.setAttribute("style","width:100%; height:100%"),s.appendChild(u),document.body.appendChild(s),u.focus(),u.oncontextmenu=function(e){return!1},this.container.addChild(d),this.drawShapeGraphics=new PIXI.Graphics,d.addChild(this.drawShapeGraphics),this.contactGraphics=new PIXI.Graphics,d.addChild(this.contactGraphics),this.aabbGraphics=new PIXI.Graphics,d.addChild(this.aabbGraphics),this.pickGraphics=new PIXI.Graphics,d.addChild(this.pickGraphics),d.scale.x=200,d.scale.y=-200;var c,y,a,r,w,b,g=!1,m=e.vec2.create(),x=e.vec2.create(),j=e.vec2.create(),v=0,h=1,k=1,q=0;p.mousedown=p.touchstart=function(f){if(a=f.global.x,r=f.global.y,f.originalEvent.touches&&(q=f.originalEvent.touches.length),f.originalEvent.touches&&2===f.originalEvent.touches.length){var n=o.container.interactionManager.touchs[0],i=o.container.interactionManager.touchs[1],p=n.getLocalPosition(d);e.vec2.set(j,p.x,p.y),o.stagePositionToPhysics(m,j);var p=i.getLocalPosition(d);e.vec2.set(j,p.x,p.y),o.stagePositionToPhysics(x,j),v=e.vec2.distance(m,x);d.scale.x,d.scale.y}else{c=f.global.x,y=f.global.y,w=d.position.x,b=d.position.y,g=!0,o.lastMousePos=f.global;var p=f.getLocalPosition(d);e.vec2.set(t,p.x,p.y),o.stagePositionToPhysics(l,t),o.handleMouseDown(l)}},p.mousemove=p.touchmove=function(f){if(f.originalEvent.touches&&(q!==f.originalEvent.touches.length&&(c=f.global.x,y=f.global.y,w=d.position.x,b=d.position.y),q=f.originalEvent.touches.length),a=f.global.x,r=f.global.y,f.originalEvent.touches&&2===f.originalEvent.touches.length){var n=o.container.interactionManager.touchs[0],p=o.container.interactionManager.touchs[1],u=n.getLocalPosition(d);e.vec2.set(j,u.x,u.y),o.stagePositionToPhysics(m,j);var u=p.getLocalPosition(d);e.vec2.set(j,u.x,u.y),o.stagePositionToPhysics(x,j);var s=e.vec2.distance(m,x);return e.vec2.add(m,m,x),e.vec2.scale(m,m,.5),void o.zoom(.5*(n.global.x+p.global.x),.5*(n.global.y+p.global.y),null,s/v*h,s/v*k)}g&&o.state===i.PANNING&&(d.position.x=f.global.x-c+w,d.position.y=f.global.y-y+b),o.lastMousePos=f.global;var u=f.getLocalPosition(d);e.vec2.set(t,u.x,u.y),o.stagePositionToPhysics(l,t),o.handleMouseMove(l)},p.mouseup=p.touchend=function(f){f.originalEvent.touches&&(q=f.originalEvent.touches.length),g=!1,a=f.global.x,r=f.global.y,o.lastMousePos=f.global;var n=f.getLocalPosition(d);e.vec2.set(t,n.x,n.y),o.stagePositionToPhysics(l,t),o.handleMouseUp(l)},this.element.ontouchmove=function(e){e.preventDefault()},u.addEventListener?(u.addEventListener("mousewheel",f,!1),u.addEventListener("DOMMouseScroll",f,!1)):u.attachEvent("onmousewheel",f),this.centerCamera(0,0)},f.prototype.zoom=function(e,f,n,o,d,i){var t=this.scrollFactor,l=this.stage;"undefined"==typeof o?(n||(t*=-1),t*=Math.abs(i),l.scale.x*=1+t,l.scale.y*=1+t,l.position.x+=t*(l.position.x-e),l.position.y+=t*(l.position.y-f)):(l.scale.x*=o,l.scale.y*=d,l.position.x+=(o-1)*(l.position.x-e),l.position.y+=(d-1)*(l.position.y-f)),l.updateTransform()},f.prototype.centerCamera=function(e,f){this.stage.position.x=this.renderer.width/2-this.stage.scale.x*e,this.stage.position.y=this.renderer.height/2-this.stage.scale.y*f,this.stage.updateTransform()},f.prototype.frame=function(e,f,n,o){var d=this.renderer.width/this.renderer.height;n/o>d?(this.stage.scale.x=this.renderer.width/n,this.stage.scale.y=-this.stage.scale.x):(this.stage.scale.y=-this.renderer.height/o,this.stage.scale.x=-this.stage.scale.y),this.centerCamera(e,f)},f.prototype.drawCircle=function(e,f,n,o,d,i,t,l){t="number"==typeof t?t:1,i="number"==typeof i?i:16777215,e.lineStyle(t,0,1),e.beginFill(i,l?this.sleepOpacity:1),e.drawCircle(f,n,d),e.endFill(),e.moveTo(f,n),e.lineTo(f+d*Math.cos(o),n+d*Math.sin(o))},f.drawSpring=function(e,f,n,o){o="number"==typeof o?o:1,n="undefined"==typeof n?16777215:n,e.lineStyle(o,n,1),10*o>f&&(f=10*o);var d=12,i=f/d;e.moveTo(-f/2,0);for(var t=1;d>t;t++){var l=-f/2+i*t,p=0;1>=t||t>=d-1||(t%2===0?p-=.1*f:p+=.1*f),e.lineTo(l,p)}e.lineTo(f/2,0)},f.drawPlane=function(e,f,n,o,d,i,t,l,p){i="number"==typeof i?i:1,o="undefined"==typeof o?16777215:o,e.lineStyle(i,d,1),e.lineStyle(0,0,0),e.beginFill(o);var u=p;e.moveTo(-u,0),e.lineTo(u,0),e.lineTo(u,-u),e.lineTo(-u,-u),e.endFill(),e.lineStyle(i,d),e.moveTo(-u,0),e.lineTo(u,0)},f.drawLine=function(f,n,o,d,i,t){t="number"==typeof t?t:1,i="undefined"==typeof i?0:i,f.lineStyle(t,i,1);var l=e.vec2.fromValues(-d/2,0),p=e.vec2.fromValues(d/2,0);e.vec2.rotate(l,l,o),e.vec2.rotate(p,p,o),e.vec2.add(l,l,n),e.vec2.add(p,p,n),f.moveTo(l[0],l[1]),f.lineTo(p[0],p[1])},f.prototype.drawCapsule=function(f,n,o,d,i,t,l,p,u,s){u="number"==typeof u?u:1,l="undefined"==typeof l?0:l,f.lineStyle(u,l,1);var c=e.vec2,y=(Math.cos(d),Math.sin(d),i/2);f.beginFill(p,s?this.sleepOpacity:1);var a=c.fromValues(n,o),r=c.fromValues(-y,0),w=c.fromValues(y,0);c.rotate(r,r,d),c.rotate(w,w,d),c.add(r,r,a),c.add(w,w,a),f.drawCircle(r[0],r[1],t),f.drawCircle(w[0],w[1],t),f.endFill();var b=c.create(),g=c.create();c.set(r,-y,t),c.set(w,y,t),c.set(b,y,-t),c.set(g,-y,-t),c.rotate(r,r,d),c.rotate(w,w,d),c.rotate(b,b,d),c.rotate(g,g,d),c.add(r,r,a),c.add(w,w,a),c.add(b,b,a),c.add(g,g,a),f.lineStyle(u,l,0),f.beginFill(p,s?this.sleepOpacity:1),f.moveTo(r[0],r[1]),f.lineTo(w[0],w[1]),f.lineTo(b[0],b[1]),f.lineTo(g[0],g[1]),f.endFill();for(var m=0;2>m;m++){f.lineStyle(u,l,1);var x=0===m?1:-1;c.set(r,-y,x*t),c.set(w,y,x*t),c.rotate(r,r,d),c.rotate(w,w,d),c.add(r,r,a),c.add(w,w,a),f.moveTo(r[0],r[1]),f.lineTo(w[0],w[1])}},f.prototype.drawRectangle=function(f,n,o,d,i,t,l,p,u,s){for(var c=[[i/2,t/2],[-i/2,t/2],[-i/2,-t/2],[i/2,-t/2]],y=0;y<c.length;y++){var a=c[y];e.vec2.rotate(a,a,d),e.vec2.add(a,a,[n,o])}this.drawPath(f,c,l,p,u,s)},f.prototype.drawConvex=function(e,f,n,o,d,i,t,l,p){if(i="number"==typeof i?i:1,o="undefined"==typeof o?0:o,t){for(var u=[16711680,65280,255],s=0;s!==f.length+1;s++){var c=f[s%f.length],y=f[(s+1)%f.length],a=c[0],r=c[1],w=y[0],b=y[1];e.lineStyle(i,u[s%u.length],1),e.moveTo(a,r),e.lineTo(w,b),e.drawCircle(a,r,2*i)}e.lineStyle(i,16711680,1),e.drawCircle(l[0],l[1],2*i)}else{e.lineStyle(i,o,1),e.beginFill(d,p?this.sleepOpacity:1);for(var s=0;s!==f.length;s++){var g=f[s],m=g[0],x=g[1];0===s?e.moveTo(m,x):e.lineTo(m,x)}e.endFill(),f.length>2&&(e.moveTo(f[f.length-1][0],f[f.length-1][1]),e.lineTo(f[0][0],f[0][1]))}},f.prototype.drawPath=function(e,f,n,o,d,i){d="number"==typeof d?d:1,n="undefined"==typeof n?0:n,e.lineStyle(d,n,1),"number"==typeof o&&e.beginFill(o,i?this.sleepOpacity:1);for(var t=null,l=null,p=0;p<f.length;p++){var u=f[p],s=u[0],c=u[1];if(s!==t||c!==l){if(0===p)e.moveTo(s,c);else{var y=t,a=l,r=s,w=c,b=f[(p+1)%f.length][0],g=f[(p+1)%f.length][1],m=(r-y)*(g-a)-(b-y)*(w-a);0!==m&&e.lineTo(s,c)}t=s,l=c}}"number"==typeof o&&e.endFill(),f.length>2&&"number"==typeof o&&(e.moveTo(f[f.length-1][0],f[f.length-1][1]),e.lineTo(f[0][0],f[0][1]))},f.prototype.updateSpriteTransform=function(e,f){this.useInterpolatedPositions&&!this.paused?(e.position.x=f.interpolatedPosition[0],e.position.y=f.interpolatedPosition[1],e.rotation=f.interpolatedAngle):(e.position.x=f.position[0],e.position.y=f.position[1],e.rotation=f.angle)};var p=e.vec2.fromValues(1,0),u=e.vec2.fromValues(0,0),s=e.vec2.fromValues(0,0),c=e.vec2.fromValues(0,0);f.prototype.render=function(){for(var f=(this.renderer.width,this.renderer.height,this.springSprites),n=(this.sprites,0);n!==this.bodies.length;n++)this.updateSpriteTransform(this.sprites[n],this.bodies[n]);for(var n=0;n!==this.bodies.length;n++){var o=this.bodies[n],d=o.sleepState===e.Body.SLEEPING,i=this.sprites[n],t=this.getIslandColor(o);(i.drawnSleeping!==d||i.drawnColor!==t)&&(i.clear(),this.drawRenderable(o,i,t,i.drawnLineColor))}for(var n=0;n!==this.springs.length;n++){var l=this.springs[n],i=f[n],y=l.bodyA,a=l.bodyB;if(this.useInterpolatedPositions&&!this.paused?(e.vec2.toGlobalFrame(s,l.localAnchorA,y.interpolatedPosition,y.interpolatedAngle),e.vec2.toGlobalFrame(c,l.localAnchorB,a.interpolatedPosition,a.interpolatedAngle)):(l.getWorldAnchorA(s),l.getWorldAnchorB(c)),i.scale.y=1,s[1]<c[1]){var r=s;s=c,c=r,i.scale.y=-1}var w=s[0],b=s[1],g=c[0],m=c[1];i.position.x=(w+g)/2,i.position.y=(b+m)/2,u[0]=w-g,u[1]=b-m,i.rotation=Math.acos(e.vec2.dot(p,u)/e.vec2.length(u)),i.scale.x=e.vec2.length(u)/l.restLength}if(this.drawContacts){this.contactGraphics.clear(),this.stage.removeChild(this.contactGraphics),this.stage.addChild(this.contactGraphics);var x=this.contactGraphics;x.lineStyle(this.lineWidth,0,1);for(var n=0;n!==this.world.narrowphase.contactEquations.length;n++){var j=this.world.narrowphase.contactEquations[n],v=j.bodyA,h=j.bodyB,k=j.contactPointA,q=j.contactPointB,z=v.position[0],A=v.position[1],B=h.position[0],C=h.position[1];x.moveTo(z,A),x.lineTo(z+k[0],A+k[1]),x.moveTo(B,C),x.lineTo(B+q[0],C+q[1])}this.contactGraphics.cleared=!1}else this.contactGraphics.cleared||(this.contactGraphics.clear(),this.contactGraphics.cleared=!0);if(this.drawAABBs){this.aabbGraphics.clear(),this.stage.removeChild(this.aabbGraphics),this.stage.addChild(this.aabbGraphics);var x=this.aabbGraphics;x.lineStyle(this.lineWidth,0,1);for(var n=0;n!==this.world.bodies.length;n++){var D=this.world.bodies[n].getAABB();x.drawRect(D.lowerBound[0],D.lowerBound[1],D.upperBound[0]-D.lowerBound[0],D.upperBound[1]-D.lowerBound[1])}this.aabbGraphics.cleared=!1}else this.aabbGraphics.cleared||(this.aabbGraphics.clear(),this.aabbGraphics.cleared=!0);if(this.mouseConstraint){var x=this.pickGraphics;x.clear(),this.stage.removeChild(x),this.stage.addChild(x),x.lineStyle(this.lineWidth,0,1);var E=this.mouseConstraint,F=e.vec2.create();E.bodyB.toWorldFrame(F,E.pivotB),x.moveTo(E.pivotA[0],E.pivotA[1]),x.lineTo(F[0],F[1]),x.cleared=!1}else this.pickGraphics.cleared||(this.pickGraphics.clear(),this.pickGraphics.cleared=!0);this.followBody&&app.centerCamera(this.followBody.interpolatedPosition[0],this.followBody.interpolatedPosition[1]),this.renderer.render(this.container)},f.prototype.drawRenderable=function(n,o,d,i){var t=this.lineWidth;if(o.drawnSleeping=!1,o.drawnColor=d,o.drawnLineColor=i,n instanceof e.Body&&n.shapes.length){var l=n.sleepState===e.Body.SLEEPING;if(o.drawnSleeping=l,n.concavePath&&!this.debugPolygons){for(var p=[],u=0;u!==n.concavePath.length;u++){var s=n.concavePath[u];p.push([s[0],s[1]])}this.drawPath(o,p,i,d,t,l)}else for(var c=0;c<n.shapes.length;c++){var y=n.shapes[c],a=y.position,r=y.angle;if(y instanceof e.Circle)this.drawCircle(o,a[0],a[1],r,y.radius,d,t,l);else if(y instanceof e.Particle)this.drawCircle(o,a[0],a[1],r,2*t,i,0);else if(y instanceof e.Plane)f.drawPlane(o,-10,10,d,i,t,10*t,10*t,100);else if(y instanceof e.Line)f.drawLine(o,a,r,y.length,i,t);else if(y instanceof e.Box)this.drawRectangle(o,a[0],a[1],r,y.width,y.height,i,d,t,l);else if(y instanceof e.Capsule)this.drawCapsule(o,a[0],a[1],r,y.length,y.radius,i,d,t,l);else if(y instanceof e.Convex){for(var w=[],b=e.vec2.create(),u=0;u!==y.vertices.length;u++){var s=y.vertices[u];e.vec2.rotate(b,s,r),w.push([b[0]+a[0],b[1]+a[1]])}this.drawConvex(o,w,y.triangles,i,d,t,this.debugPolygons,a,l)}else if(y instanceof e.Heightfield){for(var p=[[0,-100]],u=0;u!==y.heights.length;u++){var s=y.heights[u];p.push([u*y.elementWidth,s])}p.push([y.heights.length*y.elementWidth,-100]),this.drawPath(o,p,i,d,t,l)}}}else if(n instanceof e.Spring){var g=n.restLength;f.drawSpring(o,g,0,t)}},f.prototype.getIslandColor=function(e){var f=this.islandColors;return-1===e.islandId?color=14540253:f[e.islandId]?color=f[e.islandId]:color=f[e.islandId]=parseInt(d(),16),color},f.prototype.addRenderable=function(f){var n=(this.lineWidth,0),o=new PIXI.Graphics;if(f instanceof e.Body&&f.shapes.length){var d=this.getIslandColor(f);this.drawRenderable(f,o,d,n),this.sprites.push(o),this.stage.addChild(o)}else f instanceof e.Spring&&(this.drawRenderable(f,o,0,n),this.springSprites.push(o),this.stage.addChild(o))},f.prototype.removeRenderable=function(f){if(f instanceof e.Body){var n=this.bodies.indexOf(f);-1!==n&&(this.stage.removeChild(this.sprites[n]),this.sprites.splice(n,1))}else if(f instanceof e.Spring){var n=this.springs.indexOf(f);-1!==n&&(this.stage.removeChild(this.springSprites[n]),this.springSprites.splice(n,1))}},f.prototype.resize=function(e,f){var n=this.renderer;n.view;n.resize(e,f)}}(p2);